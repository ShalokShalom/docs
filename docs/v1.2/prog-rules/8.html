<!doctype html>
<html>

    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Lisp Flavored Erlang</title>
    <link rel="stylesheet" href="/v1.2/css/styles.css" />
    <link rel="stylesheet" href="/v1.2/css/pygment_trac.css" />
    <link rel="shortcut icon" href="/v1.2/images/favicon.ico" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="/js/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/v1.2/css/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  </head>


  <body>
      <div id="header">
        <input type="checkbox" id="navbar-checkbox" class="navbar-checkbox">
        <label for="navbar-checkbox" class="navbar-handle">&#9776;</label>
        <nav>
          <ul>
            <li class="fork"><img src="https://github.com/lfe/docs/raw/master/images/logos/LispFlavoredErlang-xtiny.png" align="top" /></li>
            <li class="title"><a href="http://lfe.io/#resources">Download</a></li>
            <li class="title"><a href="/v1.2/community.html">Community</a></li>
            <li class="title"><a href="/v1.2/contributing.html">Contributing</a></li>
            <li class="title"><a href="http://lfe.gitbooks.io/quick-start/content/index.html">Quick Start</a></li>
            <li class="title"><a href="/v1.2/">Home</a></li>
          </ul>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">


<div id="sidebar-primary" class="sidebar">
  <div class="widget">
    <h3 class="widget-title">Programming Rules and Conventions</h3>
    <ol>
      <li><a class="spec" href="/v1.2/prog-rules/1.html">Introduction</a></li>
      <li><a class="spec" href="/v1.2/prog-rules/2.html">Structure and LFE Terminology</a></li>
      <li><a class="spec" href="/v1.2/prog-rules/3.html">SW Engineering Principles</a></li>
      <li><a class="spec" href="/v1.2/prog-rules/4.html">Error Handling</a></li>
      <li><a class="spec" href="/v1.2/prog-rules/5.html">Processes, Servers and Messages</a></li>
      <li><a class="spec" href="/v1.2/prog-rules/6.html">Various LFE Specific Conventions</a></li>
      <li><a class="spec" href="/v1.2/prog-rules/7.html">Specific Lexical and Stylistic Conventions</a></li>
      <li><a class="spec" href="/v1.2/prog-rules/8.html">Documenting Code</a></li>
      <li><a class="spec" href="/v1.2/prog-rules/9.html">Common Mistakes</a></li>
      <li><a class="spec" href="/v1.2/prog-rules/10.html">Required Documents</a></li>
    </ol>
  </div>
</div>

<div id="content">
  <article>
    <h1>LFE Programming Rules and Conventions</h1>

<h2>8 Documenting Code</h2>

<h3>8.1 Attribute code</h3>

<p>You must always correctly attribute all code. There are two ways to do this:</p>

<ol>
<li><p>In a git commit&#39;s comment section, complete with names and email
public addresses of original authors or URLs for source code.</p></li>
<li><p>In the comments section at the beginning of the LFE file where the code
has been copied to.</p></li>
</ol>

<p>Say where all ideas contributing to the module came from - if your code was
derived from some other code say where you got this code from and who wrote
it.</p>

<p>Never steal code - stealing code is taking code from some other module
editing it and forgetting to say who wrote the original.</p>

<h3>8.2 Provide references in the code to the specifications</h3>

<p>Provide cross references in the code to any documents relevant to the
understanding of the code. For example, if the code implements some
communication protocol or hardware interface give an exact reference with
document and page number to the documents that were used to write the code.</p>

<h3>8.3 Document all the errors</h3>

<p>All errors should be listed together with an English description of what
they mean in a separate document (see
<a href="http://lfe.github.io/prog-rules/10.html">Chapter 10</a>, &quot;Error
Messages&quot;).</p>

<p>By errors we mean errors which have been detected by the system.</p>

<p>At a point in your program where you detect a logical error call the error
logger thus:</p>
<div class="highlight"><pre><code class="language-cl" data-lang="cl"><span class="p">(</span><span class="nv">error-logger:error-msg</span> <span class="nb">format</span> <span class="o">#(</span><span class="nv">descriptor</span> <span class="nv">arg1</span> <span class="nv">arg2</span> <span class="o">....</span><span class="p">))</span>
</code></pre></div>
<p>And make sure that the line <code>#(descriptor arg1 ...)</code> is added to the error
message documents.</p>

<h3>8.4 Document all the principle data structures in messages</h3>

<p>Use tagged tuples as the principle data structure when sending messages
between different parts of the system.</p>

<p>The record features of Erlang (introduced in Erlang versions 4.3 and
thereafter) can be used to ensure cross module consistency of data
structures.</p>

<p>An English description of all these data structure should be documented (see
<a href="http://lfe.github.io/prog-rules/10.html">Chapter 10</a>,
&quot;Message Descriptions&quot; on page 32.).</p>

<h3>8.5 Comments</h3>

<p>Comments should be clear and concise and avoid unnecessary wordiness. Make
sure that comments are kept up to date with the code. Check that comments
add to the understanding of the code. Comments should be written in English.</p>

<p>Comments about the module and important comments that apply to large
sections of code in in module should be without indentation and start with
four semicolon characters: <code>;;;;</code> (see this chapter, &quot;File Header,
description&quot; and the Style Guide
<a href="/v1.2/style-guide/4.html">Documentation</a> chapter, &quot;Comment
Semicolons&quot;).</p>

<p>Comments about a function shall be without indentation and start with three
semicolon characters: <code>;;;</code> (see this chapter, &quot;Comment each function&quot;).</p>

<p>Comments within LFE code shall start with two semicolon characters: <code>;;</code>.
If a line only contains a comment, it shall be indented as Erlang code. This
kind of comment shall be placed above the statement it refers to. If the
comment can be placed at the same line as the statement, this is also
acceptable.</p>

<p>Comments that are placed at the end of a line of code should only have a
single semi-colon character: <code>;</code>.</p>
<div class="highlight"><pre><code class="language-cl" data-lang="cl"><span class="c1">;;;; Great module description</span>
<span class="c1">;;;; ...</span>
<span class="p">(</span><span class="nv">defmodule</span> <span class="nv">great-module</span>
  <span class="p">(</span><span class="nb">export</span>
    <span class="p">(</span><span class="nv">some-useful-function</span> <span class="mi">1</span><span class="p">)))</span>

<span class="o">...</span>

<span class="c1">;;; Comment about function</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">some-useful-function</span> <span class="p">(</span><span class="nv">useful-argument</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">another-function</span> <span class="nv">useful-argument</span><span class="p">)</span>           <span class="c1">; Comment at end of line</span>
  <span class="p">(</span><span class="nv">yet-another-fucntion</span><span class="p">)</span>                       <span class="c1">; Another one for this line</span>
  <span class="c1">;; Comment about the next chunk of code at the same level of indentation</span>
  <span class="o">...</span><span class="p">)</span>

<span class="o">...</span>
</code></pre></div>
<h3>8.6 Comment each function</h3>

<p>Functions should be commented. You may know exactly what your function does
the week after you write it, but six months later when you or someone else
is trying to understand the code, the comments can save countless hours
and expense.</p>

<p>There are two styles you can use to comment functions in LFE:</p>

<ol>
<li>the Common Lisp style of using a docstring, or</li>
<li>the Erlang style of commenting the code before the fucntion.</li>
</ol>

<p>The important things to document are:</p>

<ul>
<li>The purpose of the function.</li>
<li>The domain of valid inputs to the function. That is, data structures of
the arguments to the functions together with their meaning.</li>
<li>The domain of the output of the function. That is, all possible data
structures of the return value together with their meaning.</li>
<li>If the function implements a complicated algorithm, describe it.</li>
<li>The possible causes of failure and exit signals which may be generated by
<code>exit/1</code>, <code>throw/1</code> or any non-obvious run time errors. Note the
difference between failure and returning an error.</li>
<li>Any side effect of the function.</li>
</ul>

<p>Example 1:</p>
<div class="highlight"><pre><code class="language-cl" data-lang="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">get-server-statistics</span>
  <span class="s">&quot;Get various information from a process.</span>

<span class="s">  This function returns a list of key/value pairs or a list of</span>
<span class="s">  error/reason.&quot;</span>
  <span class="p">((</span><span class="nv">option</span> <span class="nv">pid</span><span class="p">)</span> <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">is_pid</span> <span class="nv">pid</span><span class="p">))</span>
    <span class="o">...</span><span class="p">)</span>
  <span class="o">...</span><span class="p">)</span>
</code></pre></div>
<p>Example 2:</p>
<div class="highlight"><pre><code class="language-cl" data-lang="cl"><span class="c1">;;; Function: get-server-statistics/2</span>
<span class="c1">;;; Purpose: Get various information from a process.</span>
<span class="c1">;;; Args: Option is normal|all.</span>
<span class="c1">;;; Returns: A list of (list key value)</span>
<span class="c1">;;;     or (list &#39;error reason) (if the process is dead)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">get-server-statistics</span>
  <span class="p">((</span><span class="nv">option</span> <span class="nv">pid</span><span class="p">)</span> <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">is_pid</span> <span class="nv">pid</span><span class="p">))</span>
    <span class="o">...</span><span class="p">)</span>
  <span class="o">...</span><span class="p">)</span>
</code></pre></div>
<h3>8.7 Data structures</h3>
<div class="highlight"><pre><code class="language-cl" data-lang="cl"><span class="c1">;;; Data Type: person</span>
<span class="c1">;;; where:</span>
<span class="c1">;;;    name: A string (default is undefined).</span>
<span class="c1">;;;    age: An integer (default is undefined).</span>
<span class="c1">;;;    phone: A list of integers (default is a list).</span>
<span class="c1">;;;    dict: A dictionary containing various information about the</span>
<span class="c1">;;;          person. This is a list of key/value tuples (default</span>
<span class="c1">;;;          is the empty list).</span>
<span class="c1">;;;    A {Key, Value} list</span>
<span class="p">(</span><span class="nv">defrecord</span> <span class="nv">person</span>
  <span class="nv">name</span>
  <span class="nv">age</span>
  <span class="p">(</span><span class="nv">phone</span> <span class="p">(</span><span class="nb">list</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">dict</span> <span class="p">(</span><span class="nb">list</span><span class="p">)))</span>
</code></pre></div>
<h3>8.8 File headers, copyright</h3>

<p>Each file of source code must start with copyright information, for example:</p>
<div class="highlight"><pre><code class="language-cl" data-lang="cl"><span class="c1">;;;; Copyright Ericsson Telecom AB 1996</span>
<span class="c1">;;;;</span>
<span class="c1">;;;; All rights reserved. No part of this computer programs(s) may be</span>
<span class="c1">;;;; used, reproduced,stored in any retrieval system, or transmitted,</span>
<span class="c1">;;;; in any form or by any means, electronic, mechanical, photocopying,</span>
<span class="c1">;;;; recording, or otherwise without prior written permission of</span>
<span class="c1">;;;; Ericsson Telecom AB.</span>
</code></pre></div>
<h3>8.9 File headers, revision history</h3>

<p>Revision history should be tracked in a DVCS, not in the file headers.</p>

<h3>8.10 File Header, description</h3>

<p>Each file must start with a short description of the module contained in the
file and a brief description.</p>
<div class="highlight"><pre><code class="language-cl" data-lang="cl"><span class="c1">;;;; Description module foobar-data-manipulation</span>
<span class="c1">;;;;</span>
<span class="c1">;;;; Foobars are the basic elements in the Baz signalling system. The</span>
<span class="c1">;;;; functions below are for manipulating that data of foobars and for</span>
<span class="c1">;;;; etc etc etc</span>
</code></pre></div>
<p><strong>If you know of any weakness, bugs, badly tested features, make a note of
them in a special comment, don&#39;t try to hide them.</strong> If any part of the
module is incomplete, add a special comment. Add comments about anything
which will be of help to future maintainers of the module.If the product of
which the module you are writing is a success, it may still be changed and
improved in ten years time by someone you may never meet.</p>

<h3>8.11 Do not comment out old code - remove it</h3>

<p>Add a comment in the revision history to that effect. Remember the source
code control system will help you!</p>

<h3>8.12 Use a source code control system</h3>

<p>All non trivial projects must use a source code control system such as git,
mercurial, etc., to keep track of all modules.</p>

  </article>


  <div class="pagination loop-pagination">

      <a href="7.html" class="previous page-numbers spec">&larr; Previous</a> |

      <a class="page-numbers spec" href="">Top</a> |
      <a class="page-numbers spec" href="/v1.2/">Home</a>

      | <a href="9.html" class="next page-numbers spec">Next &rarr;</a>

  </div>



</div><!-- #content -->

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-38274766-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>

