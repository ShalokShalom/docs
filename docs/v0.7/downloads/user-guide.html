<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE ncx PUBLIC
    "-//NISO//DTD ncx 2005-1//EN"
    "http://www.daisy.org/z3986/2005/ncx-2005-1.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
    <link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" />
    <title>LFE User Guide</title>
    <meta name="DC.language" content="eng" />
    <meta name="DC.creator" content="Duncan McGreggor, Robert Virding" />
    <meta name="DC.title" content="LFE User Guide" />
    <base href="http://lfe.github.io/" />
  </head>
  <body>
  <a name='1_introduction' />
<h1 id='1_introduction'>1 Introduction</h1>
<a name='11_lisp_flavored_erlang' />
<h2 id='11_lisp_flavored_erlang'>1.1 Lisp Flavored Erlang</h2>
<a name='111_about' />
<h3 id='111_about'>1.1.1 About</h3>

<p>Lisp Flavored Erlang or LFE is a Lisp syntax front-end to the Erlang compiler. LFE is a Lisp-2, like Common Lisp, and comes with a REPL (shell). LFE coexists seamlessly with vanilla Erlang and OTP. As such, code written in LFE can freely be used together with modules written in vanilla Erlang and applications in Erlang/OTP.</p>
<a name='112_background' />
<h3 id='112_background'>1.1.2 Background</h3>

<p>This work started life as a beautification of what Robert Virding had already created when he originally documented LFE. There are a few exemplar open source projects which have produced extraordinary documentation: both highly informative as well as being exceedingly easy on the eyes. We wanted LFE to aspire to those standards. In addition to helping with project adoption, creating an attractive and well-documented online resource for LFE makes it much nicer for the folks who already use the project.</p>

<p>The Github Pages feature provided us a means whereby an appealing open source project site could be created easily. These efforts were rewarded almost immediately by visitors and users who began spreading the word, further catalyzing our commitment to producing an improved user experience.</p>

<p>While attempting to add more verbose descriptions and enhance the prose around the original docs, there arose a strong desire to improve the organization of the topics covered as well. In this effort, we turned to the excellent Erlang books that have been published to date, and began drawing inspiration from these. It soon became clear that what was really needed was an LFE version of some combination of those wonderful efforts. With that, the LFE User Guide was fully set upon its course.</p>
<a name='113_motivation_for_the_uninitiated' />
<h3 id='113_motivation_for_the_uninitiated'>1.1.3 Motivation for the Uninitiated</h3>

<p>If you have ever found yourself greatly admiring the Erlang language but thirsting for an alternative to the standard syntax, and you do not fear the elegance of parentheses (<a href='http://xkcd.com/297/'>for a more
civilized age</a>), you might want to spend some time writing code in LFE. It could be just what you&#8217;re looking for.</p>

<p>LFE has borrowings from Common Lisp and Scheme, so should provide a familiar face for those who have spent time hacking on projects powered by SBCL, Allegro, LispWorks, Chicken Scheme, Gambit, or Racket.</p>

<p>Similarly, those who have come to Lisp via the Java VM-powered Clojure will find much to love in the Erlang VM-powered LFE. LFE was released just one year after Clojure, but has 100% compatibility with the features in Erlang that inspired Clojure, some of which the Clojure community is still working on. You can get those without waiting when you use LFE!</p>
<a name='12_getting_started' />
<h2 id='12_getting_started'>1.2 Getting Started</h2>

<p>The user guide assumes the following background knowledge:</p>

<ul>
<li>basic familiarity with Lisp or Lisp dialects</li>

<li>a passing knowledge of Erlang</li>

<li>a working installation of Erlang and LFE</li>
</ul>

<p>For those that would like additional information on any of these, we recommend the resources below.</p>

<p>Online:</p>

<ul>
<li>The LFE <a href='/quick-start/1.html'>Quick Start</a></li>

<li><a href='http://learnyousomeerlang.com/content'>Learn You Some Erlang for Great Good</a> (<a href='https://github.com/igstan/learn-you-some-erlang-kindle/downloads'>.mobi</a>)</li>

<li><a href='http://www.gigamonkeys.com/book/'>Practical Common Lisp</a></li>

<li><a href='http://www.paulgraham.com/onlisp.html'>On Lisp</a></li>

<li><a href='http://mitpress.mit.edu/sicp/'>Structure and Interpretation of Computer Programs</a></li>
</ul>

<p>Books:</p>

<ul>
<li><a href='http://pragprog.com/book/jaerlang/programming-erlang'>Programming Erlang: Software for a Concurrent World</a></li>

<li><a href='http://shop.oreilly.com/product/9780596518189.do'>Erlang Programming: A Concurrent Approach to Software Development</a></li>

<li><a href='http://shop.oreilly.com/product/0636920025818.do'>Introducing Erlang</a></li>

<li><a href='http://norvig.com/paip.html'>Paradigms of Artificial Intelligence Programming: Case Studies in Common Lisp</a></li>
</ul>

<p>The LFE <a href='/quick-start/1.html'>Quick Start</a> is an important resource, as it covers dependencies, building LFE, installation, using the REPL, running scripts, and using modules/libraries (OTP and third-party).</p>
<a name='13_more_about_lfe' />
<h2 id='13_more_about_lfe'>1.3 More About LFE</h2>
<a name='131_what_lfe_isnt' />
<h3 id='131_what_lfe_isnt'>1.3.1 What LFE Isn&#8217;t</h3>

<p>Just to clear the air and set some expectations, here&#8217;s what you&#8217;re <em>not</em> going to find in LFE:</p>

<ul>
<li>An implementation of Scheme</li>

<li>An implementation of Common Lisp</li>

<li>An implementation of Clojure</li>
</ul>

<p>As such, you will not find the following:</p>

<ul>
<li>A Scheme-like single namespace</li>

<li>CL packages or munged names faking packages</li>

<li>Access to Java libraries</li>
</ul>
<a name='132_what_lfe_is!' />
<h3 id='132_what_lfe_is'>1.3.2 What LFE Is!</h3>

<p>Here&#8217;s what you <em>can</em> expect of LFE:</p>

<ul>
<li>A proper Lisp-2, based on the features and limitations of the Erlang VM</li>

<li>Compatibility with vanilla Erlang and OTP</li>

<li>It runs on the standard Erlang VM</li>
</ul>

<p>Furthermore, as a result of Erlang&#8217;s influence (and LFE&#8217;s compatibility with it), the following hold:</p>

<ul>
<li>there is no global data</li>

<li>data is not mutable</li>

<li>only the standard Erlang data types are used</li>

<li>you get pattern matching and guards</li>

<li>you have access to Erlang functions and modules</li>

<li>LFE has a compiler/interpreter</li>

<li>functions with declared arity and fixed number of arguments</li>

<li>Lisp macros</li>
</ul>
<a name='14_what_to_expect_from_this_guide' />
<h2 id='14_what_to_expect_from_this_guide'>1.4 What to Expect from this Guide</h2>

<p>The intent of this guide is to follow the same general pattern that the best Erlang books do, covering the topics listed in the User Guide table of contents from an LFE perspective.</p>

<p>Some of the Guide&#8217;s sections will be covered in dedicated tutorials or other in-depth documents; in those cases, we provide links to that material. If your favorite topic is not covered above, let us know! We&#8217;ll try to find a place for it :-)</p>
<a name='15_the_lfe_repl' />
<h2 id='15_the_lfe_repl'>1.5 The LFE REPL</h2>
<a name='151_using_the_repl' />
<h3 id='151_using_the_repl'>1.5.1 Using the REPL</h3>

<p>We covered basic REPL usage in the <a href='/quick-start/2.html'>quick start</a>. That&#8217;s the best place to go for an introduction to using the LFE REPL. Regardless (and for your convenience), we also provide some information about the REPL in the document you are currently reading :-)</p>
<a name='1511_starting_the_repl' />
<h4 id='1511_starting_the_repl'>1.5.1.1 Starting the REPL</h4>

<p>If you <em>don&#8217;t</em> have LFE installed system-wide, you need to tell it (Erlang, really) where the LFE <code>.beam</code> files are. Here are the three ways to start up LFE in this case:</p>

<pre><code>$ ./bin/lfe -pa ./ebin</code></pre>

<p>or:</p>

<pre><code>$ erl -user lfe_boot -pa /path/to/lfe/ebin</code></pre>

<p>or:</p>

<pre><code>$ erl -pa /path/to/lfe/ebin</code></pre>

<p>followed by this from the Erlang shell:</p>
<div class='highlight'><pre><code class='erlang'><span class='mi'>14</span><span class='o'>&gt;</span> <span class='nn'>lfe_shell</span><span class='p'>:</span><span class='nf'>start</span><span class='p'>().</span>
<span class='nv'>LFE</span> <span class='nv'>Shell</span> <span class='nv'>V5</span><span class='p'>.</span><span class='mi'>9</span><span class='p'>.</span><span class='mi'>3</span><span class='p'>.</span><span class='mi'>1</span> <span class='p'>(</span><span class='n'>abort</span> <span class='n'>with</span> <span class='err'>^</span><span class='nv'>G</span><span class='p'>)</span>
<span class='o'>&lt;</span><span class='mi'>0</span><span class='p'>.</span><span class='mi'>33</span><span class='p'>.</span><span class='mi'>0</span><span class='o'>&gt;</span>

<span class='o'>&gt;</span>
</code></pre></div>
<p>If you do have LFE installed system-wide, then starting the shell can be done in the ways listed below.</p>

<p>Using the <code>lfe</code> command. Be sure to change directory to where you have saved (or cloned) the LFE source code. Then:</p>

<pre><code>$ ./bin/lfe</code></pre>

<p>You can also start the LFE REPL by passing options directly to <code>erl</code>. Again, assuming that you have LFE installed system-wide, from any directory you may do this:</p>

<pre><code>$ erl -user lfe_boot</code></pre>

<p>Also, if you happen to be running an Erlang shell already, you can start the LFE REPL with the following:</p>
<div class='highlight'><pre><code class='erlang'><span class='mi'>14</span><span class='o'>&gt;</span> <span class='nn'>lfe_shell</span><span class='p'>:</span><span class='nf'>start</span><span class='p'>().</span>
<span class='nv'>LFE</span> <span class='nv'>Shell</span> <span class='nv'>V5</span><span class='p'>.</span><span class='mi'>9</span><span class='p'>.</span><span class='mi'>3</span><span class='p'>.</span><span class='mi'>1</span> <span class='p'>(</span><span class='n'>abort</span> <span class='n'>with</span> <span class='err'>^</span><span class='nv'>G</span><span class='p'>)</span>
<span class='o'>&lt;</span><span class='mi'>0</span><span class='p'>.</span><span class='mi'>33</span><span class='p'>.</span><span class='mi'>0</span><span class='o'>&gt;</span>

<span class='o'>&gt;</span>
</code></pre></div><a name='1512_running_commands' />
<h4 id='1512_running_commands'>1.5.1.2 Running Commands</h4>

<p>Once you&#8217;re in the REPL, it&#8217;s just a matter of entering code:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>+</span> <span class='mf'>1.5</span> <span class='mi'>3</span> <span class='mi'>4</span> <span class='mi'>5</span> <span class='mi'>6</span> <span class='mi'>7</span><span class='p'>)</span>
<span class='mi'>28</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Note that you can&#8217;t define modules, macros, functions or records from the REPL; you&#8217;ll have to put those in a module file and compile or <code>slurp</code> the file from the REPL. You can, however, use <code>lambda</code> from the REPL:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nb'>exp</span>
    <span class='p'>(</span><span class='k'>lambda</span> <span class='p'>(</span><span class='nv'>x</span> <span class='nv'>y</span><span class='p'>)</span>
      <span class='p'>(</span><span class='nv'>trunc</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>math</span> <span class='nv'>pow</span> <span class='nv'>x</span> <span class='nv'>y</span><span class='p'>))))</span>
<span class='err'>#</span><span class='nv'>Fun&lt;lfe_eval.15.53503600&gt;</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Then, using the <code>lambda</code> you have just defined is as easy as this:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>funcall</span> <span class='nb'>exp</span> <span class='mi'>2</span> <span class='mi'>6</span><span class='p'>)</span>
<span class='mi'>64</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Or, if you want to get nuts:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>lists</span> <span class='nb'>map</span>
    <span class='p'>(</span><span class='k'>lambda</span> <span class='p'>(</span><span class='nv'>z</span><span class='p'>)</span>
      <span class='p'>(</span><span class='nb'>funcall</span> <span class='nb'>exp</span> <span class='p'>(</span><span class='nb'>car</span> <span class='nv'>z</span><span class='p'>)</span> <span class='p'>(</span><span class='nb'>cadr</span> <span class='nv'>z</span><span class='p'>)))</span>
    <span class='p'>(</span><span class='nb'>list</span> <span class='p'>(</span><span class='nb'>list</span> <span class='mf'>1.5</span><span class='p'>)</span> <span class='p'>(</span><span class='nb'>list</span> <span class='mi'>3</span> <span class='mi'>4</span><span class='p'>)</span> <span class='p'>(</span><span class='nb'>list</span> <span class='mi'>5</span> <span class='mi'>6</span><span class='p'>)))</span>
<span class='p'>(</span><span class='mi'>1</span> <span class='mi'>81</span> <span class='mi'>15625</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div><a name='1513_quitting_the_repl' />
<h4 id='1513_quitting_the_repl'>1.5.1.3 Quitting the REPL</h4>

<p>Just as there are multiple ways in which you can start the REPL, there are a couple ways you can leave it. You can jump into the JCL from the LFE prompt by hitting ^g and then entering <code>q</code>:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='nv'>^g</span>
<span class='nv'>User</span> <span class='nv'>switch</span> <span class='nv'>command</span>
 <span class='nv'>--&gt;</span> <span class='nv'>q</span>
<span class='nv'>$</span>
</code></pre></div>
<p>or you can call the Erlang shell&#8217;s quit function:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>c</span> <span class='nv'>q</span><span class='p'>)</span>
<span class='nv'>ok</span>
<span class='nb'>&gt;</span>
<span class='nv'>$</span>
</code></pre></div><a name='152_special_functions' />
<h3 id='152_special_functions'>1.5.2 Special Functions</h3>

<p>There are some functions specially defined in LFE for use from the REPL. These are listed below with information about their use.</p>

<ul>
<li>
<p><code>(c File [Options])</code> - Compile and load an LFE file. Assumes default extension <code>.lfe</code>.</p>
</li>

<li>
<p><code>(l Module ...)</code> - Load modules.</p>
</li>

<li>
<p><code>(m Module ...)</code> - Print out module information, if no modules are given then print information about all modules.</p>
</li>

<li>
<p><code>(ec File [Options])</code> - Compile and load an Erlang file.</p>
</li>

<li>
<p><code>(slurp File)</code> - Slurp in a source LFE file and makes all functions and macros defined in the file available in the shell. Only one file can be slurped at a time and slurping a new file removes all data about the previous one.</p>
</li>

<li>
<p><code>(unslurp)</code> - Remove all function and macro definitions except the default ones.</p>
</li>

<li>
<p><code>(set Pattern Expr)</code> - Evaluate Expr and match the result with Pattern binding variables in it. These variables can then be used in the shell and also rebound in another set.</p>
</li>

<li>
<p><code>(: c Command Arg ...)</code> - All the commands in the Erlang shell&#8217;s <a href='http://www.erlang.org/doc/man/c.html'>Command Interface Module</a> can be reached in this way.</p>
</li>
</ul>
<a name='153_special_variables' />
<h3 id='153_special_variables'>1.5.3 Special Variables</h3>

<p>LFE also provides some convenience variables similar to what Lisp has defined for <a href='http://www.lispworks.com/documentation/HyperSpec/Body/v_pl_plp.htm'> +, ++, +++</a>, <a href='http://www.lispworks.com/documentation/HyperSpec/Body/v__stst_.htm'>*, **, ***</a>, and <a href='http://www.lispworks.com/documentation/HyperSpec/Body/v__.htm'>-</a>. Additionally, LFE also provides the <code>$ENV</code> variable.</p>

<ul>
<li><code>+/++/+++</code> - The three previous expressions input.</li>

<li><code>*/**/***</code> - The values of the previous 3 expressions.</li>

<li><code>-</code> - The current expression input.</li>

<li><code>$ENV</code> - The current environment (accessible in the REPL as well as in macros).</li>
</ul>

<p>These probably warrant some examples.</p>

<p>Let&#8217;s say you had just entered the following in the REPL:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>+</span> <span class='mf'>1.5</span><span class='p'>)</span>
<span class='mi'>3</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>c</span> <span class='nv'>memory</span><span class='p'>)</span>
<span class='p'>(</span><span class='o'>#(</span><span class='nv'>total</span> <span class='mi'>10026672</span><span class='p'>)</span>
 <span class='o'>#(</span><span class='nv'>processes</span> <span class='mi'>1656528</span><span class='p'>)</span>
 <span class='o'>#(</span><span class='nv'>processes_used</span> <span class='mi'>1656528</span><span class='p'>)</span>
 <span class='o'>#(</span><span class='nv'>system</span> <span class='mi'>8370144</span><span class='p'>)</span>
 <span class='o'>#(</span><span class='nb'>atom</span> <span class='mi'>153321</span><span class='p'>)</span>
 <span class='o'>#(</span><span class='nv'>atom_used</span> <span class='mi'>147399</span><span class='p'>)</span>
 <span class='o'>#(</span><span class='nv'>binary</span> <span class='mi'>1338560</span><span class='p'>)</span>
 <span class='o'>#(</span><span class='nv'>code</span> <span class='mi'>3255239</span><span class='p'>)</span>
 <span class='o'>#(</span><span class='nv'>ets</span> <span class='mi'>290544</span><span class='p'>))</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>my-func</span> <span class='p'>(</span><span class='k'>lambda</span> <span class='p'>()</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;Hello, Zaphod!&quot;</span><span class='p'>)))</span>
<span class='err'>#</span><span class='nv'>Fun&lt;lfe_eval.21.53503600&gt;</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Then you can get the previous expressions you input with the following commands:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='nv'>+++</span>
<span class='p'>(</span><span class='nb'>+</span> <span class='mf'>1.5</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='nv'>+++</span>
<span class='p'>(</span><span class='err'>:</span> <span class='nv'>c</span> <span class='nv'>memory</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='nv'>+++</span>
<span class='p'>(</span><span class='nb'>set</span> <span class='nv'>my-func</span> <span class='p'>(</span><span class='k'>lambda</span> <span class='p'>()</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;Hello, Zaphod!&quot;</span><span class='p'>)))</span>
<span class='nb'>&gt;</span> <span class='nv'>++</span>
<span class='nv'>+++</span>
<span class='nb'>&gt;</span> <span class='nb'>+</span>
<span class='nv'>++</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Most of us will actually use the arrow keys, thanks to the <code>readline</code> library. However, the classic, pre-<code>readline</code> approach is still available, should you choose to use it.</p>

<p>Similarly, you can get the results returned by using the variabels from the second bullet item. If you&#8217;re following along in the REPL, go ahead and re-enter the commands we typed above to reset the last three items in your command history. Then do the following:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='vg'>***</span>
<span class='mi'>3</span>
<span class='nb'>&gt;</span> <span class='vg'>***</span>
<span class='p'>(</span><span class='o'>#(</span><span class='nv'>total</span> <span class='mi'>9976496</span><span class='p'>)</span>
 <span class='o'>#(</span><span class='nv'>processes</span> <span class='mi'>1606688</span><span class='p'>)</span>
 <span class='o'>#(</span><span class='nv'>processes_used</span> <span class='mi'>1606688</span><span class='p'>)</span>
 <span class='o'>#(</span><span class='nv'>system</span> <span class='mi'>8369808</span><span class='p'>)</span>
 <span class='o'>#(</span><span class='nb'>atom</span> <span class='mi'>153321</span><span class='p'>)</span>
 <span class='o'>#(</span><span class='nv'>atom_used</span> <span class='mi'>147399</span><span class='p'>)</span>
 <span class='o'>#(</span><span class='nv'>binary</span> <span class='mi'>1338096</span><span class='p'>)</span>
 <span class='o'>#(</span><span class='nv'>code</span> <span class='mi'>3255239</span><span class='p'>)</span>
 <span class='o'>#(</span><span class='nv'>ets</span> <span class='mi'>290544</span><span class='p'>))</span>
<span class='nb'>&gt;</span> <span class='vg'>***</span>
<span class='err'>#</span><span class='nv'>Fun&lt;lfe_eval.21.53503600&gt;</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>funcall</span> <span class='nb'>*</span><span class='p'>)</span>
<span class='nv'>Hello,</span> <span class='nv'>Zaphod!</span>
<span class='nv'>ok</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>There&#8217;s another, called the &#8220;dash&#8221; varibale. It is bound to the actual expression that is currently being evaluated. Here&#8217;s an example of this being used:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;Evaluating the expression &#39;~p&#39; ...~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nb'>-</span><span class='p'>))</span>
<span class='nv'>Evaluating</span> <span class='k'>the</span> <span class='nv'>expression</span> <span class='ss'>&#39;[</span><span class='o'>&#39;</span><span class='err'>:</span><span class='ss'>&#39;,io,format,</span>
                            <span class='nv'>[quote,</span><span class='s'>&quot;Evaluating the expression &#39;~p&#39; ...~n&quot;</span><span class='nv'>],</span>
                            <span class='nv'>[list,</span><span class='ss'>&#39;-&#39;]]</span><span class='o'>&#39;</span> <span class='o'>...</span>
<span class='nv'>ok</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>We&#8217;ve saved one of the more archane special variables to last: <code>$ENV</code>. When you first start up a shell, the <code>$ENV</code> variable holds pristine state data:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='nv'>$ENV</span>
<span class='p'>(</span><span class='o'>#(</span><span class='nv'>variable</span> <span class='vg'>***</span> <span class='p'>())</span>
 <span class='o'>#(</span><span class='nv'>variable</span> <span class='nv'>**</span> <span class='p'>())</span>
 <span class='o'>#(</span><span class='nv'>variable</span> <span class='nb'>*</span> <span class='p'>())</span>
 <span class='o'>#(</span><span class='nv'>variable</span> <span class='nb'>-</span> <span class='p'>())</span>
 <span class='o'>#(</span><span class='nv'>variable</span> <span class='nv'>+++</span> <span class='p'>())</span>
 <span class='o'>#(</span><span class='nv'>variable</span> <span class='nv'>++</span> <span class='p'>())</span>
 <span class='o'>#(</span><span class='nv'>variable</span> <span class='nb'>+</span> <span class='p'>()))</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>We can define a few variables and then check them out with another display of the environment:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='nv'>$ENV</span>
<span class='p'>(</span><span class='o'>#(</span><span class='nv'>variable</span> <span class='nv'>my-func</span> <span class='err'>#</span><span class='nv'>Fun&lt;lfe_eval.10.53503600&gt;</span><span class='p'>)</span>
 <span class='o'>#(</span><span class='nv'>variable</span> <span class='nv'>asnwer</span> <span class='mi'>42</span><span class='p'>)</span>
 <span class='o'>#(</span><span class='nv'>variable</span> <span class='vg'>***</span> <span class='mi'>42</span><span class='p'>)</span>
 <span class='o'>#(</span><span class='nv'>variable</span>
<span class='o'>...</span>
</code></pre></div>
<p>If you <code>slurp</code> a file in the REPL, your environment will be updated with all the definitions in that file:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>slurp</span> <span class='o'>&#39;</span><span class='s'>&quot;examples/core-macros.lfe&quot;</span><span class='p'>)</span>
<span class='o'>#(</span><span class='nv'>ok</span> <span class='nv'>-no-mod-</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='nv'>$ENV</span>
<span class='p'>(</span><span class='o'>#(</span><span class='k'>function</span>
   <span class='nv'>bq-expand</span>
   <span class='mi'>2</span>
   <span class='o'>#(</span><span class='nv'>letrec</span>
     <span class='p'>(</span><span class='k'>lambda</span> <span class='p'>(</span><span class='nb'>exp</span> <span class='nv'>n</span><span class='p'>)</span>
<span class='o'>...</span>
</code></pre></div>
<p>There is, as you might have guessed, much more to that ellided output (for that particular example, nearly all the rest of it is macro definitions).</p>

<p>Making use of <code>$ENV</code> can be very helpful when debugging include files, loading Erlang header files, or when creating macros. Furthermore, when spending a great deal of time in the REPL prototyping code for a project, it can be quite useful to refresh one&#8217;s memory as to what functions and variables are currently available in <code>$ENV</code>.</p>

<p>Looking at the output for <code>$ENV</code> can be a bit overwhelming, however. As you might imagine, there is an easy answer to this: filter it! The following makes use of the Erlang <code>lists</code> module as well as patterns in an anonymous function, both of which will be covered in more detail later:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>filter-env</span>
    <span class='p'>(</span><span class='k'>lambda</span> <span class='p'>(</span><span class='nv'>env</span><span class='p'>)</span>
      <span class='p'>(</span><span class='err'>:</span> <span class='nv'>lists</span> <span class='nv'>foreach</span>
        <span class='p'>(</span><span class='nv'>match-lambda</span>
          <span class='p'>(((</span><span class='nv'>tuple</span> <span class='ss'>&#39;function</span> <span class='nv'>func-name</span> <span class='nv'>arity</span> <span class='nv'>_</span><span class='p'>))</span>
           <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;function: ~p/~p~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>func-name</span> <span class='nv'>arity</span><span class='p'>)))</span>
          <span class='p'>(((</span><span class='nv'>tuple</span> <span class='ss'>&#39;macro</span> <span class='nv'>macro-name</span> <span class='nv'>_</span><span class='p'>))</span>
           <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;macro: ~p~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>macro-name</span><span class='p'>)))</span>
          <span class='p'>(((</span><span class='nv'>tuple</span> <span class='ss'>&#39;variable</span> <span class='nv'>var-name</span> <span class='nv'>value</span><span class='p'>))</span>
           <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;variable: ~p~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>var-name</span><span class='p'>)))</span>
          <span class='p'>((</span><span class='nv'>_</span><span class='p'>)))</span>
        <span class='nv'>env</span><span class='p'>)))</span>
<span class='err'>#</span><span class='nv'>Fun&lt;lfe_eval.21.53503600&gt;</span>
</code></pre></div>
<p>Now, as one hacks away in the REPL, <code>slurp</code>ing away at various modules, getting a list of what&#8217;s defined in the current environment is a piece of cake:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>filter-env</span> <span class='nv'>$ENV</span><span class='p'>)</span>
<span class='nv'>variable:</span> <span class='ss'>&#39;my-var-4</span><span class='o'>&#39;</span>
<span class='nv'>variable:</span> <span class='ss'>&#39;my-var-3</span><span class='o'>&#39;</span>
<span class='nv'>variable:</span> <span class='ss'>&#39;my-var-2</span><span class='o'>&#39;</span>
<span class='nv'>variable:</span> <span class='ss'>&#39;my-var-1</span><span class='o'>&#39;</span>
<span class='nv'>variable:</span> <span class='nv'>filter</span>
<span class='nv'>function:</span> <span class='ss'>&#39;bq-expand&#39;/2</span>
<span class='nv'>macro:</span> <span class='nv'>backquote</span>
<span class='nv'>macro:</span> <span class='ss'>&#39;orelse</span><span class='o'>&#39;</span>
<span class='nv'>macro:</span> <span class='ss'>&#39;andalso</span><span class='o'>&#39;</span>
<span class='nv'>macro:</span> <span class='ss'>&#39;cond</span><span class='o'>&#39;</span>
<span class='nv'>macro:</span> <span class='ss'>&#39;flet*</span><span class='o'>&#39;</span>
<span class='nv'>macro:</span> <span class='ss'>&#39;let*</span><span class='o'>&#39;</span>
<span class='nv'>macro:</span> <span class='ss'>&#39;list*</span><span class='o'>&#39;</span>
<span class='nv'>macro:</span> <span class='ss'>&#39;?</span><span class='o'>&#39;</span>
<span class='nv'>macro:</span> <span class='o'>&#39;</span><span class='err'>:</span><span class='o'>&#39;</span>
<span class='nv'>macro:</span> <span class='ss'>&#39;++</span><span class='o'>&#39;</span>
<span class='nv'>macro:</span> <span class='nb'>cddr</span>
<span class='nv'>macro:</span> <span class='nb'>cdar</span>
<span class='nv'>macro:</span> <span class='nb'>cadr</span>
<span class='nv'>macro:</span> <span class='nb'>caar</span>
<span class='nv'>variable:</span> <span class='ss'>&#39;***</span><span class='o'>&#39;</span>
<span class='nv'>variable:</span> <span class='ss'>&#39;**</span><span class='o'>&#39;</span>
<span class='nv'>variable:</span> <span class='ss'>&#39;*</span><span class='o'>&#39;</span>
<span class='nv'>variable:</span> <span class='ss'>&#39;-</span><span class='o'>&#39;</span>
<span class='nv'>variable:</span> <span class='ss'>&#39;+++</span><span class='o'>&#39;</span>
<span class='nv'>variable:</span> <span class='ss'>&#39;++</span><span class='o'>&#39;</span>
<span class='nv'>variable:</span> <span class='ss'>&#39;+</span><span class='o'>&#39;</span>
<span class='nv'>ok</span>
<span class='nb'>&gt;</span>
</code></pre></div><a name='154_getting_out_of_trouble' />
<h3 id='154_getting_out_of_trouble'>1.5.4 Getting Out of Trouble</h3>

<p>Every once in a while you may find that you do something which causes the REPL to crash, presenting you with something that looks like this:</p>

<pre><code>&gt;
  =ERROR REPORT==== 17-Feb-2013::15:39:33 ===
  ...</code></pre>

<p>You don&#8217;t have to quit and restart the REPL, if you don&#8217;t want to! There are a couple of steps that you can take instead.</p>
<a name='1541_interrupting_a_shell_process' />
<h4 id='1541_interrupting_a_shell_process'>1.5.4.1 Interrupting a Shell Process</h4>

<p>When you get an error as seen above, type <code>^g</code>. This will put you into JCL (Job Control Language) mode. At the JCL prompt, type <code>?</code> to see a list of options:</p>

<pre><code>User switch command
 --&gt; ?
  c [nn]            - connect to job
  i [nn]            - interrupt job
  k [nn]            - kill job
  j                 - list all jobs
  s [shell]         - start local shell
  r [node [shell]]  - start remote shell
  q        - quit erlang
  ? | h             - this message</code></pre>

<p>Let&#8217;s see what&#8217;s running:</p>

<pre><code>--&gt; j
  1* {lfe_shell,start,[]}</code></pre>

<p>Our shell process is still alive, though not responding. Let&#8217;s interrupt it and then connect to it again:</p>

<pre><code>--&gt; i 1
--&gt; c 1
exception error: function_clause
 in (: lists sublist #(error interrupted) 1)
 in (lfe_scan string 4)
 in (lfe_io scan_and_parse 3)

&gt;</code></pre>

<p>Once we interrupted the job, our error messages were printed to the REPL and we were placed back at the LFE prompt.</p>
<a name='1542_starting_a_new_shell' />
<h4 id='1542_starting_a_new_shell'>1.5.4.2 Starting a New Shell</h4>

<p>Sometimes, though, there is no shell process any more. Here&#8217;s how to start up a new shell process if the one that you&#8217;re using dies:</p>

<pre><code>--&gt; s lfe_shell
--&gt; j
      2* {lfe_shell,start,[]}
--&gt; c 2
LFE Shell V5.9.3.1 (abort with ^G)
&gt;</code></pre>

<p>And you&#8217;re back up!</p>
<a name='16_loading_files' />
<h2 id='16_loading_files'>1.6 Loading Files</h2>
<a name='161_loading_files_in_the_repl' />
<h3 id='161_loading_files_in_the_repl'>1.6.1 Loading Files in the REPL</h3>

<p>There are several ways in which one may load files in LFE.</p>
<a name='1611_slurp' />
<h4 id='1611_'>1.6.1.1 <code>slurp</code></h4>

<p>As mentioned in the section on <a href='/user-guide/intro/2.html'>LFE's REPL</a>, <code>slurp</code>ing a file makes all functions and macros defined in the file available in the shell. One does not need to reference the module (and, in fact, attempting to do so will result in an error. Also, note that only one file can be slurped at a time; slurping a new one removes all data about the previous file.</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>slurp</span> <span class='o'>&#39;</span><span class='s'>&quot;my-module.lfe&quot;</span><span class='p'>)</span>
<span class='o'>#(</span><span class='nv'>ok</span> <span class='nv'>my-module</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div><a name='1612_c' />
<h4 id='1612_'>1.6.1.2 <code>c</code></h4>

<p>Compiling a module from the REPL is what you need if you wish to work with multiple modules simultaneously:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>c</span> <span class='o'>&#39;</span><span class='s'>&quot;my-module&quot;</span><span class='p'>)</span>
<span class='o'>#(</span><span class='nv'>module</span> <span class='nv'>my-module</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div><a name='1613_ec' />
<h4 id='1613_'>1.6.1.3 <code>ec</code></h4>

<p>You can also load Erlang files in LFE:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>ec</span> <span class='o'>&#39;</span><span class='s'>&quot;../lfe/src/lfe_macro.erl&quot;</span><span class='p'>)</span>
<span class='o'>#(</span><span class='nv'>ok</span> <span class='nv'>lfe_macro</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div><a name='1614_l' />
<h4 id='1614_'>1.6.1.4 <code>l</code></h4>

<p>If a module is in your Erlang/LFE path, you can load that too:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>l</span> <span class='ss'>&#39;mochiweb</span><span class='p'>)</span>
<span class='p'>(</span><span class='o'>#(</span><span class='nv'>module</span> <span class='nv'>mochiweb</span><span class='p'>))</span>
<span class='nb'>&gt;</span>
</code></pre></div><a name='162_loading_files_in_modules' />
<h3 id='162_loading_files_in_modules'>1.6.2 Loading Files in Modules</h3>

<p>Code may be included wholesale into LFE modules by either using <code>include-file</code> or <code>include-lib</code>.</p>
<a name='1621_include-file' />
<h4 id='1621_'>1.6.2.1 <code>include-file</code></h4>

<p>If you have records or data that you would like to be available to more than one module, you can put those in a dedicated file and pull them in to your modules. For example, let&#8217;s say I had defined the following constants in the file <code>include/consts.lfe</code>:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>defmacro</span> <span class='vg'>*base-cool-factor*</span> <span class='nv'>_</span> <span class='o'>`</span><span class='mf'>0.8</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>defmacro</span> <span class='vg'>*earth-adjustment*</span> <span class='nv'>_</span> <span class='o'>`</span><span class='mf'>0.3</span><span class='p'>)</span>
</code></pre></div>
<p>Then, in the following two files I could easily use those constants by including them:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nv'>defmodule</span> <span class='nv'>zaphod</span>
  <span class='p'>(</span><span class='nb'>export</span> <span class='nv'>all</span><span class='p'>)</span>

<span class='p'>(</span><span class='nv'>include-file</span> <span class='s'>&quot;include/consts.lfe&quot;</span><span class='p'>)</span>

<span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>get-coolness</span> <span class='p'>()</span>
  <span class='p'>(</span><span class='k'>let</span> <span class='p'>((</span><span class='nv'>zaphod-cool-factor</span> <span class='mf'>0.9</span><span class='p'>))</span>
    <span class='p'>(</span><span class='nb'>*</span> <span class='p'>(</span><span class='vg'>*base-cool-factor*</span><span class='p'>)</span> <span class='nv'>zaphod-cool-factor</span><span class='p'>)))</span>
</code></pre></div><div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nv'>defmodule</span> <span class='nv'>arthur</span>
  <span class='p'>(</span><span class='nb'>export</span> <span class='nv'>all</span><span class='p'>)</span>

<span class='p'>(</span><span class='nv'>include-file</span> <span class='s'>&quot;include/consts.lfe&quot;</span><span class='p'>)</span>

<span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>get-coolness</span> <span class='p'>()</span>
  <span class='p'>(</span><span class='k'>let</span> <span class='p'>((</span><span class='nv'>arthur-cool-factor</span> <span class='mf'>0.1</span><span class='p'>))</span>
    <span class='p'>(</span><span class='nb'>*</span> <span class='p'>(</span><span class='vg'>*base-cool-factor*</span><span class='p'>)</span> <span class='p'>(</span><span class='vg'>*earth-adjustment*</span><span class='p'>)</span> <span class='nv'>arthur-cool-factor</span><span class='p'>)))</span>
</code></pre></div><a name='1622_include-lib' />
<h4 id='1622_'>1.6.2.2 <code>include-lib</code></h4>

<p>TBD</p>
<div class='highlight'><pre><code class='cl'>
</code></pre></div><a name='2_diving_in' />
<h1 id='2_diving_in'>2 Diving In</h1>
<a name='21_numbers_and_operators' />
<h2 id='21_numbers_and_operators'>2.1 Numbers and Operators</h2>
<a name='211_integers_and_floats' />
<h3 id='211_integers_and_floats'>2.1.1 Integers and Floats</h3>

<p>Let&#8217;s start with something simple :-) To follow along, fire up your LFE REPL. Numbers are simple in LFE, just like Erlang:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='mi'>1</span>
<span class='mi'>1</span>
<span class='nb'>&gt;</span> <span class='mi'>2</span>
<span class='mi'>2</span>
<span class='nb'>&gt;</span> <span class='mi'>3</span>
<span class='mi'>3</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Of course, it might be more interesting to look at something like different bases:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='m'>#b101010</span>
<span class='mi'>42</span>
<span class='nb'>&gt;</span> <span class='mo'>#o52</span>
<span class='mi'>42</span>
<span class='nb'>&gt;</span> <span class='mh'>#x2a</span>
<span class='mi'>42</span>
<span class='nb'>&gt;</span> <span class='m'>#36r16</span>
<span class='mi'>42</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>LFE supports representing binary (<code>#b</code>), octal (<code>#o</code>), decimal (<code>#d</code>), hexidecimal (<code>#x</code>), as well as aribtrary bases from 1 through 36 (<code>#XrY</code>).</p>

<p>With some help from calling an Erlang function, we can work the bases in reverse, too:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>erlang</span> <span class='nv'>integer_to_list</span> <span class='mi'>123</span> <span class='mi'>2</span><span class='p'>)</span>
<span class='s'>&quot;1111011&quot;</span>
</code></pre></div>
<p>Note that the first argument is the number you want to convert and the second is the base you want to use (see <a href='http://erldocs.com/R15B/erts/erlang.html#integer_to_list/2'>here</a> for more details).</p>
<a name='212_arithmatic_operators' />
<h3 id='212_arithmatic_operators'>2.1.2 Arithmatic Operators</h3>

<p>But numbers by themselves aren&#8217;t going to do us much good if we can&#8217;t operate on them. The usual apply:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>+</span> <span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span> <span class='mi'>4</span> <span class='mi'>5</span> <span class='mi'>6</span><span class='p'>)</span>
<span class='mi'>21</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>-</span> <span class='mi'>6</span> <span class='mi'>21</span><span class='p'>)</span>
<span class='mi'>15</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>/</span> <span class='mi'>36</span> <span class='mi'>7</span><span class='p'>)</span>
<span class='mf'>5.142857142857143</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>+</span> <span class='m'>#b101010</span> <span class='mo'>#o52</span> <span class='mh'>#x2a</span> <span class='m'>#36r16</span><span class='p'>)</span>
<span class='mi'>168</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>*</span> <span class='mi'>42</span> <span class='mi'>4</span><span class='p'>)</span>
<span class='mi'>168</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>erlang</span> <span class='nv'>integer_to_list</span> <span class='p'>(</span><span class='nb'>+</span> <span class='m'>#b1001</span> <span class='m'>#b100</span> <span class='m'>#b10</span><span class='p'>)</span> <span class='mi'>2</span><span class='p'>)</span>
<span class='s'>&quot;1111&quot;</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>div</span> <span class='mi'>11</span> <span class='mi'>2</span><span class='p'>)</span>
<span class='mi'>5</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>rem</span> <span class='mi'>11</span> <span class='mi'>2</span><span class='p'>)</span>
<span class='mi'>1</span>
<span class='nb'>&gt;</span> <span class='o'>`</span><span class='p'>(</span><span class='o'>,</span><span class='p'>(</span><span class='nv'>div</span> <span class='mi'>11</span> <span class='mi'>2</span><span class='p'>)</span> <span class='o'>,</span><span class='p'>(</span><span class='nb'>rem</span> <span class='mi'>11</span> <span class='mi'>2</span><span class='p'>))</span>
<span class='p'>(</span><span class='mi'>5</span> <span class='mi'>1</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div><a name='213_logical_operators' />
<h3 id='213_logical_operators'>2.1.3 Logical Operators</h3>

<p>The usual suspects are used as follows:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>&lt;</span> <span class='mi'>1</span> <span class='mi'>2</span><span class='p'>)</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>&gt;</span> <span class='mi'>1</span> <span class='mi'>2</span><span class='p'>)</span>
<span class='nv'>false</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>&gt;=</span> <span class='mi'>2</span> <span class='mi'>2</span><span class='p'>)</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>=&lt;</span> <span class='mi'>3</span> <span class='mi'>2</span><span class='p'>)</span>
<span class='nv'>false</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>&gt;=</span> <span class='mi'>3</span> <span class='mi'>2</span><span class='p'>)</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>==</span> <span class='mi'>1</span> <span class='mi'>1</span><span class='p'>)</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>==</span> <span class='mi'>1</span> <span class='mf'>1.0</span><span class='p'>)</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>/=</span> <span class='mi'>1</span> <span class='mi'>1</span><span class='p'>)</span>
<span class='nv'>false</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>/=</span> <span class='mi'>2</span> <span class='mi'>1</span><span class='p'>)</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Note the rather awkward different between &#8220;less than&#8221; and &#8220;greater than&#8221;: it&#8217;s easy to forget that the angle brackets go at different ends for each.</p>

<p>Then there are the operators which also check against type for exact (non-)equality: <div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>=:=</span> <span class='mi'>1</span> <span class='mf'>1.0</span><span class='p'>)</span>
<span class='nv'>false</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>=:=</span> <span class='mf'>1.0</span> <span class='mf'>1.0</span><span class='p'>)</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>=/=</span> <span class='mf'>1.0</span> <span class='mf'>1.0</span><span class='p'>)</span>
<span class='nv'>false</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>=/=</span> <span class='mi'>1</span> <span class='mf'>1.0</span><span class='p'>)</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span>
</code></pre></div></p>
<a name='214_boolean_operators' />
<h3 id='214_boolean_operators'>2.1.4 Boolean Operators</h3>

<p>How about some logic?</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>and</span> <span class='ss'>&#39;true</span> <span class='ss'>&#39;false</span><span class='p'>)</span>
<span class='nv'>false</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>and</span> <span class='ss'>&#39;true</span> <span class='ss'>&#39;true</span><span class='p'>)</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>or</span> <span class='ss'>&#39;true</span> <span class='ss'>&#39;true</span><span class='p'>)</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>or</span> <span class='ss'>&#39;true</span> <span class='ss'>&#39;false</span><span class='p'>)</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>or</span> <span class='ss'>&#39;false</span> <span class='ss'>&#39;false</span><span class='p'>)</span>
<span class='nv'>false</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>not</span> <span class='ss'>&#39;false</span><span class='p'>)</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>not</span> <span class='ss'>&#39;true</span><span class='p'>)</span>
<span class='nv'>false</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>xor</span> <span class='ss'>&#39;true</span> <span class='ss'>&#39;true</span><span class='p'>)</span>
<span class='nv'>false</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>xor</span> <span class='ss'>&#39;false</span> <span class='ss'>&#39;false</span><span class='p'>)</span>
<span class='nv'>false</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>xor</span> <span class='ss'>&#39;true</span> <span class='ss'>&#39;false</span><span class='p'>)</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>There are also two boolean operators that you can use if you want to make a decision based on the truth value of the first term without having to compute the second term (useful if you have no need to do the second computation when the first term is false):</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>andalso</span> <span class='ss'>&#39;false</span> <span class='mi'>1</span><span class='p'>)</span>
<span class='nv'>false</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>andalso</span> <span class='ss'>&#39;true</span> <span class='mi'>1</span><span class='p'>)</span>
<span class='mi'>1</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>orelse</span> <span class='ss'>&#39;true</span> <span class='mi'>1</span><span class='p'>)</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>orelse</span> <span class='ss'>&#39;false</span> <span class='mi'>1</span><span class='p'>)</span>
<span class='mi'>1</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>In the case of <code>andalso</code> if the first argument is <code>false</code> the second one will not be evaluated; <code>false</code> will be returned. In the case of <code>orelse</code> if the first argument is <code>true</code> then <code>true</code> will be returned without evaluating the second argument.</p>

<p>Contrast this to regular <code>or</code> and <code>and</code>:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>and</span> <span class='ss'>&#39;false</span> <span class='mi'>1</span><span class='p'>)</span>
<span class='nv'>exception</span> <span class='nv'>error:</span> <span class='nv'>badarg</span>
  <span class='nv'>in</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>erlang</span> <span class='nb'>and</span> <span class='nv'>false</span> <span class='mi'>1</span><span class='p'>)</span>

<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>and</span> <span class='ss'>&#39;true</span> <span class='mi'>1</span><span class='p'>)</span>
<span class='nv'>exception</span> <span class='nv'>error:</span> <span class='nv'>badarg</span>
  <span class='nv'>in</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>erlang</span> <span class='nb'>and</span> <span class='nv'>true</span> <span class='mi'>1</span><span class='p'>)</span>

<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>or</span> <span class='ss'>&#39;false</span> <span class='mi'>1</span><span class='p'>)</span>
<span class='nv'>exception</span> <span class='nv'>error:</span> <span class='nv'>badarg</span>
  <span class='nv'>in</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>erlang</span> <span class='nb'>or</span> <span class='nv'>false</span> <span class='mi'>1</span><span class='p'>)</span>

<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>or</span> <span class='ss'>&#39;true</span> <span class='mi'>1</span><span class='p'>)</span>
<span class='nv'>exception</span> <span class='nv'>error:</span> <span class='nv'>badarg</span>
  <span class='nv'>in</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>erlang</span> <span class='nb'>or</span> <span class='nv'>true</span> <span class='mi'>1</span><span class='p'>)</span>

<span class='nb'>&gt;</span>
</code></pre></div><a name='215_bitwise_operators' />
<h3 id='215_bitwise_operators'>2.1.5 Bitwise Operators</h3>

<p>As one would expect, Erlang has the usual bitwise operators as well. Binary representation is used below for clarity of demonstration. Let&#8217;s define a utility function that will save a little typing:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>dec-to-bin</span> <span class='p'>(</span><span class='k'>lambda</span> <span class='p'>(</span><span class='nv'>x</span><span class='p'>)</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>erlang</span> <span class='nv'>integer_to_list</span> <span class='nv'>x</span> <span class='mi'>2</span><span class='p'>)))</span>
<span class='err'>#</span><span class='nv'>Fun&lt;lfe_eval.10.53503600&gt;</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>With that defined so that we can use it, let&#8217;s take a look at some of these operators:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>dec-to-bin</span> <span class='p'>(</span><span class='nv'>band</span> <span class='m'>#b10001</span> <span class='m'>#b1001</span><span class='p'>))</span>
<span class='s'>&quot;1&quot;</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>dec-to-bin</span> <span class='p'>(</span><span class='nv'>bor</span> <span class='m'>#b10001</span> <span class='m'>#b1001</span><span class='p'>))</span>
<span class='s'>&quot;11001&quot;</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>dec-to-bin</span> <span class='p'>(</span><span class='nv'>bxor</span> <span class='m'>#b10001</span> <span class='m'>#b1001</span><span class='p'>))</span>
<span class='s'>&quot;11000&quot;</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>dec-to-bin</span> <span class='p'>(</span><span class='nv'>bnot</span> <span class='m'>#b10001</span><span class='p'>))</span>
<span class='s'>&quot;-10010&quot;</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>dec-to-bin</span> <span class='p'>(</span><span class='nv'>bnot</span> <span class='p'>(</span><span class='nv'>bnot</span> <span class='m'>#b10001</span><span class='p'>)))</span>
<span class='s'>&quot;10001&quot;</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>dec-to-bin</span> <span class='p'>(</span><span class='nv'>bsl</span> <span class='m'>#b10001</span> <span class='mi'>1</span><span class='p'>))</span>
<span class='s'>&quot;100010&quot;</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>dec-to-bin</span> <span class='p'>(</span><span class='nv'>bsr</span> <span class='m'>#b10001</span> <span class='mi'>1</span><span class='p'>))</span>
<span class='s'>&quot;1000&quot;</span>
<span class='nb'>&gt;</span>
</code></pre></div><a name='22_atoms_and_strings' />
<h2 id='22_atoms_and_strings'>2.2 Atoms and Strings</h2>
<a name='221_atoms' />
<h3 id='221_atoms'>2.2.1 Atoms</h3>

<p>Atoms are a data type in Erlang that is used to represent non-numerical constants. In LFE, the typographical limitations of Erlang don&#8217;t apply, since they&#8217;re always quoted in LFE ;-)</p>

<p>Atoms have a value: the same as their text:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='ss'>&#39;strag</span>
<span class='nv'>strag</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>We saw this in the section on Boolean operators with the atoms of <code>true</code> and <code>false</code>. Since there are no Boolean types in Erlang or LFE, the atoms <code>true</code> and <code>false</code> are used instead.</p>

<p>Here are some more examples of atoms:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='ss'>&#39;Vogon</span>
<span class='nv'>Vogon</span>
<span class='nb'>&gt;</span> <span class='ss'>&#39;_Gargle_Blaster</span>
<span class='nv'>_Gargle_Blaster</span>
<span class='nb'>&gt;</span> <span class='ss'>&#39;+</span>
<span class='nb'>+</span>
<span class='nb'>&gt;</span> <span class='ss'>&#39;*</span>
<span class='nb'>*</span>
<span class='nb'>&gt;</span> <span class='ss'>&#39;|and now with hyperspace bypasses|</span>
<span class='nv'>|and now with hyperspace bypasses|</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Though very simple, atoms have a huge impact on our everyday use of Erlang and LFE, primarily in the area of pattern matching. Hold that thought, though; we&#8217;re not quite ready for it yet!</p>

<p>Furthermore, atoms are stored differently in Erlang than strings. They take up less space and are more efficient to compare than strings.</p>
<a name='222_strings' />
<h3 id='222_strings'>2.2.2 Strings</h3>

<p>Now we come to the oddball of Erlang: the string. In truth, there is no such thing. Strings in Erlang are just lists of integers:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='o'>&#39;</span><span class='s'>&quot;Don&#39;t Panic.&quot;</span>
<span class='s'>&quot;Don&#39;t Panic.&quot;</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='mi'>68</span> <span class='mi'>111</span> <span class='mi'>110</span> <span class='mi'>39</span> <span class='mi'>116</span> <span class='mi'>32</span> <span class='mi'>80</span> <span class='mi'>97</span> <span class='mi'>110</span> <span class='mi'>105</span> <span class='mi'>99</span> <span class='mi'>46</span><span class='p'>)</span>
<span class='s'>&quot;Don&#39;t Panic.&quot;</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Because Erlang (and thus LFE) strings consume 8 bytes per character on 32-bit systems and 16 bytes on 64-bit systems, they are not very efficient. As such, if you need to work with long strings in LFE, you probably want to use <code>(binary ...)</code>, but that&#8217;s in the next section :-)</p>
<a name='23_binary_and_bitstrings' />
<h2 id='23_binary_and_bitstrings'>2.3 Binary and Bitstrings</h2>
<a name='231_lists_and_binary' />
<h3 id='231_lists_and_'>2.3.1 Lists and <code>binary</code></h3>

<p>A full discussion of the binary type is a huge topic that probably deserves one or more dedicated tutorials, especially given the close connection with pattern matching and the efficient parsing of binary data. However, for now, we&#8217;re just going to look at one particular area: working with strings as binary data.</p>

<p>In the previous section, we had mentioned using <code>(binary ...)</code> to more efficiently represent large strings. Here&#8217;s an example (pretending, for now, that our example is using a very large string ;-)):</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>binary</span> <span class='s'>&quot;There&#39;s a frood who really knows where his towel is.&quot;</span><span class='p'>)</span>
<span class='err'>#</span><span class='nv'>B</span><span class='p'>(</span><span class='mi'>84</span> <span class='mi'>104</span> <span class='mi'>101</span> <span class='mi'>114</span> <span class='mi'>101</span> <span class='mi'>39</span> <span class='mi'>115</span> <span class='mi'>32</span> <span class='mi'>97</span> <span class='mi'>32</span> <span class='mi'>102</span> <span class='mi'>114</span> <span class='mi'>111</span> <span class='mi'>111</span> <span class='mi'>100</span> <span class='mi'>32</span> <span class='mi'>119</span> <span class='mi'>104</span> <span class='mi'>111</span> <span class='o'>...</span><span class='p'>)</span>
</code></pre></div>
<p>Or you could use the Erlang function, if you wanted:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>erlang</span> <span class='nv'>list_to_binary</span> <span class='o'>&#39;</span><span class='s'>&quot;There&#39;s a frood who really knows...&quot;</span><span class='p'>)</span>
<span class='err'>#</span><span class='nv'>B</span><span class='p'>(</span><span class='mi'>84</span> <span class='mi'>104</span> <span class='mi'>101</span> <span class='mi'>114</span> <span class='mi'>101</span> <span class='mi'>39</span> <span class='mi'>115</span> <span class='mi'>32</span> <span class='mi'>97</span> <span class='mi'>32</span> <span class='mi'>102</span> <span class='mi'>114</span> <span class='mi'>111</span> <span class='mi'>111</span> <span class='mi'>100</span> <span class='mi'>32</span> <span class='mi'>119</span> <span class='mi'>104</span> <span class='mi'>111</span> <span class='o'>...</span><span class='p'>)</span>
<span class='mi'>101</span> <span class='mi'>97</span> <span class='mi'>108</span> <span class='mi'>108</span> <span class='mi'>121</span> <span class='mi'>32</span> <span class='mi'>107</span> <span class='mi'>110</span> <span class='mi'>111</span> <span class='o'>...</span><span class='p'>)</span>
</code></pre></div>
<p>Let&#8217;s set a variable with this value in the shell, so we can work with it more easily:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>set</span> <span class='nv'>data</span> <span class='p'>(</span><span class='nv'>binary</span> <span class='s'>&quot;There&#39;s a frood who really knows where his towel is.&quot;</span><span class='p'>))</span>
<span class='err'>#</span><span class='nv'>B</span><span class='p'>(</span><span class='mi'>84</span> <span class='mi'>104</span> <span class='mi'>101</span> <span class='mi'>114</span> <span class='mi'>101</span> <span class='mi'>39</span> <span class='mi'>115</span> <span class='mi'>32</span> <span class='mi'>97</span> <span class='mi'>32</span> <span class='mi'>102</span> <span class='mi'>114</span> <span class='mi'>111</span> <span class='mi'>111</span> <span class='mi'>100</span> <span class='mi'>32</span> <span class='mi'>119</span> <span class='mi'>104</span> <span class='mi'>111</span> <span class='o'>...</span><span class='p'>)</span>
</code></pre></div><a name='232_binary_functions_in_otp' />
<h3 id='232_binary_functions_in_otp'>2.3.2 Binary Functions in OTP</h3>

<p>Let&#8217;s convert it back to a list using a function from the Erlang stdlib <code>binary</code> module:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>unicode</span> <span class='nv'>characters_to_list</span> <span class='nv'>data</span><span class='p'>)</span>
<span class='s'>&quot;There&#39;s a frood who really knows where his towel is.&quot;</span>
</code></pre></div>
<p>Note that the LFE <code>binary</code> function is quite different than the call to the <code>binary</code> module in the Erlang stdlib! The <code>binary</code> module has all sorts of nifty functions we can use (check out the <a href='http://www.erlang.org/doc/man/binary.html'>docs</a>). Here&#8217;s an example of splitting our data: <div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>binary</span> <span class='nv'>split</span> <span class='nv'>data</span> <span class='p'>(</span><span class='nv'>binary</span> <span class='s'>&quot; who really knows &quot;</span><span class='p'>))</span>
<span class='p'>(</span><span class='err'>#</span><span class='nv'>B</span><span class='p'>(</span><span class='mi'>84</span> <span class='mi'>104</span> <span class='mi'>101</span> <span class='mi'>114</span> <span class='mi'>101</span> <span class='mi'>39</span> <span class='mi'>115</span> <span class='mi'>32</span> <span class='mi'>97</span> <span class='mi'>32</span> <span class='mi'>102</span> <span class='mi'>114</span> <span class='mi'>111</span> <span class='mi'>111</span> <span class='mi'>100</span><span class='p'>)</span>
 <span class='err'>#</span><span class='nv'>B</span><span class='p'>(</span><span class='mi'>119</span> <span class='mi'>104</span> <span class='mi'>101</span> <span class='mi'>114</span> <span class='mi'>101</span> <span class='mi'>32</span> <span class='mi'>104</span> <span class='mi'>105</span> <span class='mi'>115</span> <span class='mi'>32</span> <span class='mi'>116</span> <span class='mi'>111</span> <span class='mi'>119</span> <span class='mi'>101</span> <span class='mi'>108</span> <span class='mi'>32</span> <span class='mi'>105</span> <span class='mi'>115</span> <span class='mi'>46</span><span class='p'>))</span>
</code></pre></div></p>

<p>The <code>split</code> gives us two pieces; here&#8217;s how we can get the new string from that <code>split</code>:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>unicode</span> <span class='nv'>characters_to_list</span>
    <span class='p'>(</span><span class='err'>:</span> <span class='nv'>binary</span> <span class='nv'>split</span> <span class='nv'>data</span> <span class='p'>(</span><span class='nv'>binary</span> <span class='s'>&quot;who really knows &quot;</span><span class='p'>)))</span>
<span class='s'>&quot;There&#39;s a frood where his towel is.&quot;</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p><code>binary split</code> creates a list of binaries, but since this is an <code>IoList</code> and <code>unicode characters_to_list</code> can handle those without us having to flatten them, our work is done! We get our result: the new string that we created by splitting on <code>&quot;who really knows &quot;</code>.</p>
<a name='233_bit-packing_(and_unpacking)' />
<h3 id='233_bitpacking_and_unpacking'>2.3.3 Bit-Packing (and Unpacking)</h3>

<p>For this section, let&#8217;s use the 16-bit color example that is given in Joe Armstrong&#8217;s Erlang book where 5 bits are allocated for the red channel, 6 for the green and 5 for the blue. In LFE, we can create a 16-bit memory area like so:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>red</span> <span class='mi'>2</span><span class='p'>)</span>
<span class='mi'>2</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>green</span> <span class='mi'>61</span><span class='p'>)</span>
<span class='mi'>61</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>blue</span> <span class='mi'>20</span><span class='p'>)</span>
<span class='mi'>20</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>binary</span>
    <span class='p'>(</span><span class='nv'>red</span> <span class='p'>(</span><span class='nv'>size</span> <span class='mi'>5</span><span class='p'>))</span>
    <span class='p'>(</span><span class='nv'>green</span> <span class='p'>(</span><span class='nv'>size</span> <span class='mi'>6</span><span class='p'>))</span>
    <span class='p'>(</span><span class='nv'>blue</span> <span class='p'>(</span><span class='nv'>size</span> <span class='mi'>5</span><span class='p'>)))</span>
<span class='err'>#</span><span class='nv'>B</span><span class='p'>(</span><span class='mi'>23</span> <span class='mi'>180</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>All packed and ready!</p>

<p>We can use patterns to unpack binary data in a <code>let</code> expression into the variables <code>r</code>, <code>g</code>, and <code>b</code>, printing out the results within the <code>let</code>:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='k'>let</span> <span class='p'>(((</span><span class='nv'>binary</span> <span class='p'>(</span><span class='nv'>r</span> <span class='p'>(</span><span class='nv'>size</span> <span class='mi'>5</span><span class='p'>))</span> <span class='p'>(</span><span class='nv'>g</span> <span class='p'>(</span><span class='nv'>size</span> <span class='mi'>6</span><span class='p'>))</span> <span class='p'>(</span><span class='nv'>b</span> <span class='p'>(</span><span class='nv'>size</span> <span class='mi'>5</span><span class='p'>)))</span>
         <span class='err'>#</span><span class='nv'>b</span><span class='p'>(</span><span class='mi'>23</span> <span class='mi'>180</span><span class='p'>)))</span>
       <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;~p ~p ~p~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>r</span> <span class='nv'>g</span> <span class='nv'>b</span><span class='p'>)))</span>
<span class='mi'>2</span> <span class='mi'>61</span> <span class='mi'>20</span>
<span class='nv'>ok</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>We&#8217;re getting a little ahead of ourselves here, by throwing a pattern in the mix, but it&#8217;s a good enough example to risk it :-)</p>
<a name='234_so_whats_a_bitstring?' />
<h3 id='234_so_whats_a_bitstring'>2.3.4 So What&#8217;s a Bitstring?</h3>

<p>We&#8217;ve been looking at binaries in LFE, but what&#8217;s a bitstring? The <a href='http://www.erlang.org/doc/programming_examples/bit_syntax.html'>Erlang docs</a> say it well: A bitstring is a sequence of zero or more bits, where the number of bits doesn&#8217;t need to be divisible by 8. If the number of bits is divisible by 8, the bitstring is also a binary.</p>
<a name='235_lfes_exact_definition_of_binary' />
<h3 id='235_lfes_exact_definition_of_binary'>2.3.5 LFE&#8217;s Exact Definition of Binary</h3>

<p>Here&#8217;s the full definition for the <code>binary</code> from in LFE:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nv'>binary</span> <span class='nv'>seg</span> <span class='o'>...</span> <span class='p'>)</span>
</code></pre></div>
<p>Where <code>seg</code> is:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>byte</span>
<span class='nb'>string</span>
<span class='p'>(</span><span class='nv'>val</span> <span class='nc'>integer</span><span class='nv'>|float|binary|bitstring|bytes|bits</span>
<span class='nv'>     (size n) (unit n)</span>
<span class='nv'>     big-endian|little-endian|native-endian|little|native|big</span>
     <span class='nv'>signed</span><span class='err'>|</span><span class='nv'>unsigned</span><span class='p'>)</span>
</code></pre></div>
<p>This should help you puzzle through some of the more complex binary constructions you come accross ;-)</p>
<a name='24_variables' />
<h2 id='24_variables'>2.4 Variables</h2>
<a name='241_variables_in_the_repl' />
<h3 id='241_variables_in_the_repl'>2.4.1 Variables in the REPL</h3>

<p>Variables in LFE don&#8217;t have the same syntactical limitations that vanilla Erlang has. Let&#8217;s take a look at some examples in the REPL:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>&amp;$%</span> <span class='o'>&#39;</span><span class='s'>&quot;Mostly Harmless&quot;</span><span class='p'>)</span>
<span class='s'>&quot;Mostly Harmless&quot;</span>
<span class='nb'>&gt;</span> <span class='nv'>&amp;$%</span>
<span class='s'>&quot;Mostly Harmless&quot;</span>
</code></pre></div>
<p>Your variable does <em>not</em> have to start with a capital letter and not only can it contain special characters, it can <em>entirely consist</em> of them! We don&#8217;t recommend this, however ;-)</p>

<p>Furthermore, LFE also does not share with Erlang the characteristic of not being able to change a variable once you&#8217;ve set it&#8217;s value. In the REPL you can do this without issue:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>phrase</span> <span class='o'>&#39;</span><span class='s'>&quot;Don&#39;t Panic&quot;</span><span class='p'>)</span>
<span class='s'>&quot;Don&#39;t Panic&quot;</span>
<span class='nb'>&gt;</span> <span class='nv'>phrase</span>
<span class='s'>&quot;Don&#39;t Panic&quot;</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>phrase</span> <span class='o'>&#39;</span><span class='s'>&quot;Mostly Harmless&quot;</span><span class='p'>)</span>
<span class='s'>&quot;Mostly Harmless&quot;</span>
<span class='nb'>&gt;</span> <span class='nv'>phrase</span>
<span class='s'>&quot;Mostly Harmless&quot;</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>In previous sections we&#8217;ve set variables and worked with those variables in the REPL (saving us some typing), so this should all seem a bit familiar.</p>

<p>As such, this should be fairly intuitive clear at this point:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>the-answer</span> <span class='mi'>42</span><span class='p'>)</span>
<span class='mi'>42</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>*</span> <span class='nv'>the-answer</span> <span class='mi'>2</span><span class='p'>)</span>
<span class='mi'>84</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>*</span> <span class='nv'>the-answer</span> <span class='nv'>the-answer</span><span class='p'>)</span>
<span class='mi'>1764</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>*</span> <span class='nv'>the-answer</span> <span class='nv'>the-answer</span> <span class='nv'>the-answer</span><span class='p'>)</span>
<span class='mi'>74088</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Unlike Erlang, the LFE REPL doesn&#8217;t have the <code>b()</code> and <code>f()</code> functions (&#8220;show bound variables&#8221; and &#8220;flush bound variables&#8221; respectively).</p>
<a name='242_variables_in_lfe_modules' />
<h3 id='242_variables_in_lfe_modules'>2.4.2 Variables in LFE Modules</h3>

<p>Unlike Lisp, LFE doesn&#8217;t support global variables, so (unless you create some dirty hacks!) you won&#8217;t be doing things like this in your modules:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>defvar</span> <span class='vg'>*sneaky-global-data*</span> <span class='o'>...</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>defparameter</span> <span class='vg'>*side-effect-special*</span> <span class='o'>...</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>defconstant</span> <span class='nv'>+my-constant+</span> <span class='o'>...</span><span class='p'>)</span>
</code></pre></div>
<p>(Not to mention that LFE doesn&#8217;t even <em>define</em> <code>defvar</code>, <code>defparameter</code>, or <code>defconstant</code>.)</p>

<p>As such, you shouldn&#8217;t run into variables that are defined at the module-level, only inside actual functions.</p>
<a name='242_variables_in_functions' />
<h3 id='242_variables_in_functions'>2.4.2 Variables in Functions</h3>

<p>There are <em>all sorts</em> of ways one might set a variable in an LFE function. The snippets below illustrate some of these, though for demonstration purposes, they are executed in the REPL.</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='k'>let</span> <span class='p'>((</span><span class='nv'>x</span> <span class='mi'>2</span><span class='p'>)</span>
        <span class='p'>(</span><span class='nv'>y</span> <span class='mi'>3</span><span class='p'>))</span>
    <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>x</span> <span class='nv'>y</span> <span class='p'>(</span><span class='nb'>*</span> <span class='nv'>x</span> <span class='nv'>y</span><span class='p'>)))</span>
<span class='p'>(</span><span class='mi'>2</span> <span class='mi'>3</span> <span class='mi'>6</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Above we set two variables, and then withing the scope of the <code>let</code> with display some values, one of which is computed from the variables.</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='k'>let*</span> <span class='p'>((</span><span class='nv'>x</span> <span class='mi'>2</span><span class='p'>)</span>
         <span class='p'>(</span><span class='nv'>y</span> <span class='mi'>3</span><span class='p'>)</span>
         <span class='p'>(</span><span class='nv'>z</span> <span class='p'>(</span><span class='nb'>*</span> <span class='nv'>x</span> <span class='nv'>y</span><span class='p'>)))</span>
    <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>x</span> <span class='nv'>y</span> <span class='nv'>z</span><span class='p'>))</span>
<span class='p'>(</span><span class='mi'>2</span> <span class='mi'>3</span> <span class='mi'>6</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>In this example, we make use of <code>let*</code>&#8217;s ability to use defined variables in subsequent variables assignments. Tying this with regular <code>let</code> will result in an error.</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='k'>let</span> <span class='p'>(((</span><span class='nv'>tuple</span> <span class='nv'>name</span> <span class='nv'>place</span> <span class='nv'>age</span><span class='p'>)</span> <span class='o'>#(</span><span class='s'>&quot;Ford Prefect&quot;</span> <span class='s'>&quot;Betelgeuse Seven&quot;</span> <span class='mi'>234</span><span class='p'>)))</span>
    <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>name</span> <span class='nv'>place</span> <span class='nv'>age</span><span class='p'>))</span>
<span class='p'>(</span><span class='s'>&quot;Ford Prefect&quot;</span> <span class='s'>&quot;Betelgeuse Seven&quot;</span> <span class='mi'>234</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Here is an example of multiple-binding in LFE. We haven&#8217;t covered patterns yet, but we will &#8211; and this example is making use of patterns to assign data from the given record to the variables in the <code>tuple</code>.</p>

<p>Patterns may be used in several different LFE forms, each of which may do some varaible binding.</p>
<a name='25_pattern_matching' />
<h2 id='25_pattern_matching'>2.5 Pattern Matching</h2>
<a name='251_what_are_patterns?' />
<h3 id='251_what_are_patterns'>2.5.1 What Are Patterns?</h3>

<p>Pattern matching in Erlang is huge, and it has a proportional impact on LFE and what one can do with this dialect of Lisp. Pattern matching in LFE can be used in function clauses, <code>let</code>, <code>case</code>, <code>receive</code> and in the macros <code>cond</code>, <code>lc</code>, and <code>bc</code>. From the REPL, pattern matching may be done in <code>set</code> as well.</p>

<p>Pattern matching in LFE happens when an expression matches a given pattern, e.g.:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='o'>...</span> <span class='p'>(</span><span class='nv'>&lt;pattern&gt;</span> <span class='nv'>&lt;expression&gt;</span><span class='p'>)</span> <span class='o'>...</span><span class='p'>)</span>
</code></pre></div>
<p>where the <code>&lt;pattern&gt;</code> might be something like this:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nv'>binary</span> <span class='p'>(</span><span class='nv'>f</span> <span class='nb'>float</span> <span class='p'>(</span><span class='nv'>size</span> <span class='mi'>32</span><span class='p'>))</span>
        <span class='p'>(</span><span class='nv'>b</span> <span class='nv'>bitstring</span><span class='p'>))</span>
</code></pre></div>
<p>or this:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nv'>tuple</span> <span class='ss'>&#39;ok</span> <span class='nv'>value</span><span class='p'>)</span>
</code></pre></div>
<p>or this:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>list</span> <span class='nv'>a</span> <span class='nv'>b</span> <span class='nv'>c</span><span class='p'>)</span>
</code></pre></div>
<p>or this:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>cons</span> <span class='nv'>h</span> <span class='no'>t</span><span class='p'>)</span>
</code></pre></div>
<p>and the <code>&lt;expression&gt;</code> is any legal LFE expression. Ideally, it will return data that will be matched by the pattern.</p>

<p>If the matching succeeds, any unbound variables in the pattern become bound. If the matching fails, a run-time error occurs. All of this is best understood through the examples given below. Each example is preceeded by the general form of pattern as used in the given context. This should help keep things clear, even when the examples get convoluted.</p>
<a name='252_patterns_in_forms' />
<h3 id='252_patterns_in_forms'>2.5.2 Patterns in Forms</h3>
<a name='2521_let' />
<h4 id='2521_'>2.5.2.1 <code>let</code></h4>

<p>Pattern matching in <code>let</code> has the following general form:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='k'>let</span> <span class='p'>((</span><span class='nv'>&lt;pattern&gt;</span> <span class='nv'>&lt;expression&gt;</span><span class='p'>)</span>
      <span class='p'>(</span><span class='nv'>&lt;pattern&gt;</span> <span class='nv'>&lt;expression&gt;</span><span class='p'>)</span> <span class='o'>...</span> <span class='p'>)</span>
  <span class='o'>...</span> <span class='p'>)</span>
</code></pre></div>
<p>Examples:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='k'>let</span> <span class='p'>(((</span><span class='nv'>tuple</span> <span class='nv'>len</span> <span class='nv'>status</span> <span class='nv'>data</span><span class='p'>)</span> <span class='o'>#(</span><span class='mi'>8</span> <span class='nv'>ok</span> <span class='s'>&quot;Trillian&quot;</span><span class='p'>)))</span>
       <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>len</span> <span class='nv'>status</span> <span class='nv'>data</span><span class='p'>))</span>
<span class='p'>(</span><span class='mi'>8</span> <span class='nv'>ok</span> <span class='s'>&quot;Trillian&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>In this example, we have a pattern of <code>(tuple len status data)</code> and this is getting matched against our expression which is some data of the form <code>#(8 ok &quot;Trillian&quot;)</code>. The pattern expects a tuple, and a tuple is what we gave it. With the pattern&#8217;s variables bound inside the <code>let</code>, we can return a list of the variables.</p>

<p>If our pattern was written to expect a list and the expression was a tuple, we&#8217;d get a <code>badmatch</code> error:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='k'>let</span> <span class='p'>(((</span><span class='nb'>list</span> <span class='nv'>len</span> <span class='nv'>status</span> <span class='nv'>data</span><span class='p'>)</span> <span class='o'>#(</span><span class='mi'>8</span> <span class='nv'>ok</span> <span class='s'>&quot;Trillian&quot;</span><span class='p'>)))</span>
       <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>len</span> <span class='nv'>status</span> <span class='nv'>data</span><span class='p'>))</span>
<span class='nv'>exception</span> <span class='nv'>error:</span> <span class='o'>#(</span><span class='nv'>badmatch</span> <span class='o'>#(</span><span class='mi'>8</span> <span class='nv'>ok</span> <span class='s'>&quot;Trillian&quot;</span><span class='p'>))</span>

<span class='nb'>&gt;</span>
</code></pre></div>
<p>Whatever our expression is going to be needs to be matched in the pattern. If we had a list integers in the expression, we would need a pattern like <code>(list i1 i2 i3 ...)</code>.</p>

<p>Here&#8217;s a super-simplified version of a <code>let</code> with pattern matching:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='k'>let</span> <span class='p'>((</span><span class='nv'>data</span> <span class='o'>&#39;</span><span class='s'>&quot;Trillian&quot;</span><span class='p'>))</span>
       <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>data</span><span class='p'>))</span>
<span class='p'>(</span><span class='s'>&quot;Trillian&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Here our pattern was simply the variable <code>data</code> and our expression was the string &#8220;Trillian&#8221;. This, of course, is easily recognized as a standard variable assignment within a <code>let</code>.</p>

<p>Patterns can nest, though, and with this you can start to get a sense of the power they hold. Let&#8217;s look at a more complicated example:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='k'>let</span> <span class='p'>(((</span><span class='nv'>tuple</span> <span class='nv'>lens</span> <span class='nv'>status</span> <span class='nv'>data</span><span class='p'>)</span>
         <span class='o'>#(</span><span class='p'>(</span><span class='mi'>8</span> <span class='mi'>43</span><span class='p'>)</span> <span class='o'>#(</span><span class='nv'>err</span> <span class='s'>&quot;msg too short&quot;</span><span class='p'>)</span> <span class='s'>&quot;Trillian&quot;</span><span class='p'>)))</span>
       <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>lens</span> <span class='nv'>status</span> <span class='nv'>data</span><span class='p'>))</span>
<span class='p'>(</span><span class='s'>&quot;\b+&quot;</span> <span class='o'>#(</span><span class='nv'>err</span> <span class='s'>&quot;msg too short&quot;</span><span class='p'>)</span> <span class='s'>&quot;Trillian&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>As you can see, we&#8217;ve nested our expression: length is a two-valued list and status is a two-valued tuple. Our pattern, however, is still simple. But this is going to change: we want to extract our data into more variables, and we do this by mirroring the expression data structure in the pattern itself:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='k'>let</span> <span class='p'>(((</span><span class='nv'>tuple</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>len-data</span> <span class='nv'>len-total</span><span class='p'>)</span> <span class='p'>(</span><span class='nv'>tuple</span> <span class='nv'>status-code</span> <span class='nv'>status-msg</span><span class='p'>)</span> <span class='nv'>data</span><span class='p'>)</span>
         <span class='o'>#(</span><span class='p'>(</span><span class='mi'>8</span> <span class='mi'>43</span><span class='p'>)</span> <span class='o'>#(</span><span class='nv'>err</span> <span class='s'>&quot;msg too short&quot;</span><span class='p'>)</span> <span class='s'>&quot;Trillian&quot;</span><span class='p'>)))</span>
       <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>len-data</span> <span class='nv'>len-total</span> <span class='nv'>status-code</span> <span class='nv'>status-msg</span> <span class='nv'>data</span><span class='p'>))</span>
<span class='p'>(</span><span class='mi'>8</span> <span class='mi'>43</span> <span class='nv'>err</span> <span class='s'>&quot;msg too short&quot;</span> <span class='s'>&quot;Trillian&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>As you can see, our nested pattern extracted the data into the pattern&#8217;s variables. If all we cared about was the status message, we could make this simpler by using the &#8220;I don&#8217;t care&#8221; variable (the underscore):</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='k'>let</span> <span class='p'>(((</span><span class='nv'>tuple</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>_</span> <span class='nv'>_</span><span class='p'>)</span> <span class='p'>(</span><span class='nv'>tuple</span> <span class='nv'>_</span> <span class='nv'>status-msg</span><span class='p'>)</span> <span class='nv'>_</span><span class='p'>)</span>
         <span class='o'>#(</span><span class='p'>(</span><span class='mi'>8</span> <span class='mi'>43</span><span class='p'>)</span> <span class='o'>#(</span><span class='nv'>err</span> <span class='s'>&quot;msg too short&quot;</span><span class='p'>)</span> <span class='s'>&quot;Trillian&quot;</span><span class='p'>)))</span>
       <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>status-msg</span><span class='p'>))</span>
<span class='p'>(</span><span class='s'>&quot;msg too short&quot;</span><span class='p'>)</span>
</code></pre></div>
<p>Having seen these examples, you are probably gaining some insight into the power of pattern matching in Erlang and LFE. There&#8217;s more, though :-) See below for equally potent uses.</p>
<a name='2522_case' />
<h4 id='2522_'>2.5.2.2 <code>case</code></h4>

<p>Pattern matching in <code>case</code> has the following general form:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>case</span> <span class='nv'>&lt;expression&gt;</span>
  <span class='p'>(</span><span class='nv'>&lt;pattern&gt;</span> <span class='nv'>&lt;expression&gt;</span> <span class='o'>...</span> <span class='p'>)</span>
  <span class='p'>(</span><span class='nv'>&lt;pattern&gt;</span> <span class='nv'>&lt;expression&gt;</span> <span class='o'>...</span> <span class='p'>)</span>
  <span class='o'>...</span><span class='p'>)</span>
</code></pre></div>
<p>Keep in mind that <code>case</code> may also be used (optionally) inside the <code>try</code> form. For more information on <code>try</code>, see <a href='/user-guide/check/2.html'>section 5.2</a>.</p>

<p>Let&#8217;s take a look at <code>case</code> in action:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>data</span> <span class='o'>#(</span><span class='mi'>6</span> <span class='nb'>warn</span> <span class='s'>&quot;Arthur&quot;</span><span class='p'>))</span>
<span class='o'>#(</span><span class='mi'>6</span> <span class='nb'>warn</span> <span class='s'>&quot;Arthur&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>case</span> <span class='nv'>data</span>
    <span class='p'>((</span><span class='nv'>tuple</span> <span class='nv'>len</span> <span class='ss'>&#39;ok</span> <span class='nv'>msg</span><span class='p'>)</span>
      <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;~s seems good.~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>msg</span><span class='p'>)))</span>
    <span class='p'>((</span><span class='nv'>tuple</span> <span class='nv'>len</span> <span class='ss'>&#39;err</span> <span class='nv'>msg</span><span class='p'>)</span>
      <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;There&#39;s a problem with ~s.~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>msg</span><span class='p'>)))</span>
    <span class='p'>((</span><span class='nv'>tuple</span> <span class='nv'>len</span> <span class='ss'>&#39;warn</span> <span class='nv'>msg</span><span class='p'>)</span>
      <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;Be careful of ~s.~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>msg</span><span class='p'>))))</span>
<span class='nv'>Be</span> <span class='nv'>careful</span> <span class='nv'>of</span> <span class='nv'>Arthur.</span>
<span class='nv'>ok</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>The patterns we are using in this <code>case</code> example expect data of one particular format, differentiating by the second element of the provided tuple. With new data, we can exercise the other cases:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>data</span> <span class='o'>#(</span><span class='mi'>8</span> <span class='nv'>ok</span> <span class='s'>&quot;Trillian&quot;</span><span class='p'>))</span>
<span class='o'>#(</span><span class='mi'>8</span> <span class='nv'>ok</span> <span class='s'>&quot;Trillian&quot;</span><span class='p'>)</span>
</code></pre></div>
<p>We won&#8217;t re-type the <code>case</code> example here; just hit the &#8220;up&#8221; arror until you get to the <code>case</code> entry and hit return:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>case</span> <span class='o'>...</span><span class='p'>)</span>
<span class='nv'>Trillian</span> <span class='nv'>seems</span> <span class='nv'>good.</span>
<span class='nv'>ok</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Similarly, we can test the remaining case:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>data</span> <span class='o'>#(</span><span class='mi'>6</span> <span class='nv'>err</span> <span class='s'>&quot;Zaphod&quot;</span><span class='p'>))</span>
<span class='o'>#(</span><span class='mi'>6</span> <span class='nv'>err</span> <span class='s'>&quot;Zaphod&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>case</span> <span class='o'>...</span><span class='p'>)</span>
<span class='nv'>There</span><span class='ss'>&#39;s</span> <span class='nv'>a</span> <span class='nv'>problem</span> <span class='nv'>with</span> <span class='nv'>Zaphod.</span>
<span class='nv'>ok</span>
<span class='nb'>&gt;</span>
</code></pre></div><a name='2523_receive' />
<h4 id='2523_'>2.5.2.3 <code>receive</code></h4>

<p>Pattern matching in <code>receive</code> has the following general form:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nv'>receive</span>
  <span class='p'>(</span><span class='nv'>&lt;pattern&gt;</span> <span class='o'>...</span> <span class='p'>)</span>
  <span class='p'>(</span><span class='nv'>&lt;pattern&gt;</span> <span class='o'>...</span> <span class='p'>)</span>
  <span class='o'>...</span>
  <span class='p'>(</span><span class='nv'>after</span> <span class='nv'>timeout</span>
    <span class='o'>...</span> <span class='p'>))</span>
</code></pre></div>
<p>There is a tutorial on working with Erlang&#8217;s <a href='/tutorials/processes/1.html'>light weight processes in LFE</a>, and several example usages of <code>receive</code> are given there. On the second page of that tutorial, we see that any message sent to <code>receive</code> is accepted and processed. In the example below, we replace the simple pattern of the whole data (i.e., <code>msg</code>) with a series of patterns that will print only if the message matches one of the provided patterns.</p>

<p>Save the following in a file named <code>rcv-pttrn.lfe</code>:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nv'>defmodule</span> <span class='nv'>rcv-pttrn</span>
  <span class='p'>(</span><span class='nb'>export</span> <span class='p'>(</span><span class='nv'>safety-check</span> <span class='mi'>0</span><span class='p'>)))</span>

<span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>safety-check</span> <span class='p'>()</span>
  <span class='p'>(</span><span class='nv'>receive</span>
    <span class='p'>((</span><span class='nv'>tuple</span> <span class='ss'>&#39;ok</span> <span class='nv'>item</span><span class='p'>)</span>
      <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;~s is safe to approach.~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>item</span><span class='p'>))</span>
      <span class='p'>(</span><span class='nv'>safety-check</span><span class='p'>))</span>
    <span class='p'>((</span><span class='nv'>tuple</span> <span class='ss'>&#39;warn</span> <span class='nv'>item</span><span class='p'>)</span>
      <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;Approach ~s with extreme caution.~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>item</span><span class='p'>))</span>
      <span class='p'>(</span><span class='nv'>safety-check</span><span class='p'>))</span>
    <span class='p'>((</span><span class='nv'>tuple</span> <span class='ss'>&#39;crit</span> <span class='nv'>item</span><span class='p'>)</span>
      <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;Withdraw from ~s immediately!~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>item</span><span class='p'>))</span>
      <span class='p'>(</span><span class='nv'>safety-check</span><span class='p'>))))</span>
</code></pre></div>
<p>Next, start up the LFE REPL, compile the module above, and start our safety server:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>c</span> <span class='o'>&#39;</span><span class='s'>&quot;rcv-pttrn&quot;</span><span class='p'>)</span>
<span class='o'>#(</span><span class='nv'>module</span> <span class='nv'>rcv-pttrn</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>pid</span> <span class='p'>(</span><span class='nv'>spawn</span> <span class='ss'>&#39;rcv-pttrn</span> <span class='ss'>&#39;safety-check</span> <span class='p'>()))</span>
<span class='nv'>&lt;0.34.0&gt;</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Now let&#8217;s give our patterns a try by sending messages to the server process:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>!</span> <span class='nv'>pid</span> <span class='o'>#(</span><span class='nv'>ok</span> <span class='s'>&quot;Earth&quot;</span><span class='p'>))</span>
<span class='o'>#(</span><span class='nv'>ok</span> <span class='s'>&quot;Earth&quot;</span><span class='p'>)</span>
<span class='nv'>Earth</span> <span class='nv'>is</span> <span class='nv'>safe</span> <span class='nv'>to</span> <span class='nv'>approach.</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>!</span> <span class='nv'>pid</span> <span class='o'>#(</span><span class='nb'>warn</span> <span class='s'>&quot;Frogstar&quot;</span><span class='p'>))</span>
<span class='o'>#(</span><span class='nb'>warn</span> <span class='s'>&quot;Frogstar&quot;</span><span class='p'>)</span>
<span class='nv'>Approach</span> <span class='nv'>Frogstar</span> <span class='nv'>with</span> <span class='nv'>extreme</span> <span class='nv'>caution.</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>!</span> <span class='nv'>pid</span> <span class='o'>#(</span><span class='nv'>crit</span> <span class='s'>&quot;Krikkit&quot;</span><span class='p'>))</span>
<span class='o'>#(</span><span class='nv'>crit</span> <span class='s'>&quot;Krikkit&quot;</span><span class='p'>)</span>
<span class='nv'>Withdraw</span> <span class='nv'>from</span> <span class='nv'>Krikkit</span> <span class='nv'>immediately!</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>As you can see, the <code>receive</code> patterns are working.</p>

<p>We can also see what happens when we send messages that don&#8217;t match any of the defined patterns:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>!</span> <span class='nv'>pid</span> <span class='o'>#(</span><span class='nv'>noop</span> <span class='s'>&quot;This won&#39;t be matched&quot;</span><span class='p'>))</span>
<span class='o'>#(</span><span class='nv'>noop</span> <span class='s'>&quot;This won&#39;t be matched&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>!</span> <span class='nv'>pid</span> <span class='o'>&#39;</span><span class='s'>&quot;Neither will this&quot;</span><span class='p'>))</span>
<span class='s'>&quot;Neither will this&quot;</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Absolutely nothing, that&#8217;s what. Well, nothing from the process we spawned, that is&#8230; just the REPL doing its thang.</p>
<a name='2524_cond' />
<h4 id='2524_'>2.5.2.4 <code>cond</code></h4>

<p>Pattern matching in <code>cond</code> has the following general form:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>cond</span> <span class='p'>(</span><span class='nv'>&lt;test&gt;</span> <span class='o'>...</span> <span class='p'>)</span>
      <span class='p'>((</span><span class='nv'>?=</span> <span class='nv'>&lt;pattern&gt;</span> <span class='nv'>&lt;expr&gt;</span><span class='p'>)</span> <span class='o'>...</span> <span class='p'>)</span>
      <span class='o'>...</span> <span class='p'>)</span>
</code></pre></div>
<p>Typically, a <code>cond</code> looks like this:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>cond</span> <span class='p'>((</span><span class='nv'>==</span> <span class='nv'>a</span> <span class='mi'>1</span><span class='p'>)</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;It&#39;s one!&quot;</span><span class='p'>))</span>
      <span class='p'>((</span><span class='nv'>==</span> <span class='nv'>a</span> <span class='mi'>2</span><span class='p'>)</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;It&#39;s two!&quot;</span><span class='p'>)))</span>
</code></pre></div>
<p>In other words, a series of tests with conditional results. LFE extends the basic form with support for pattern matching, as seen in the general form above.</p>

<p>Here&#8217;s an example of how one can do pattern matching in LFE with <code>cond</code> (starting with the setting of some data):</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>data</span> <span class='o'>#(</span><span class='mi'>8</span> <span class='nv'>ok</span> <span class='s'>&quot;Trillian&quot;</span><span class='p'>))</span>
<span class='o'>#(</span><span class='mi'>8</span> <span class='nv'>ok</span> <span class='s'>&quot;Trillian&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>cond</span> <span class='p'>((</span><span class='nv'>?=</span> <span class='p'>(</span><span class='nv'>tuple</span> <span class='nv'>len</span> <span class='ss'>&#39;ok</span> <span class='nv'>msg</span><span class='p'>)</span> <span class='nv'>data</span><span class='p'>)</span>
         <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;~s seems good.~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>msg</span><span class='p'>)))</span>
        <span class='p'>((</span><span class='nv'>?=</span> <span class='p'>(</span><span class='nv'>tuple</span> <span class='nv'>len</span> <span class='ss'>&#39;err</span> <span class='nv'>msg</span><span class='p'>)</span> <span class='nv'>data</span><span class='p'>)</span>
         <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;There&#39;s a problem with ~s.~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>msg</span><span class='p'>)))</span>
        <span class='p'>((</span><span class='nv'>?=</span> <span class='p'>(</span><span class='nv'>tuple</span> <span class='nv'>len</span> <span class='ss'>&#39;warn</span> <span class='nv'>msg</span><span class='p'>)</span> <span class='nv'>data</span><span class='p'>)</span>
         <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;Be careful of ~s.~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>msg</span><span class='p'>))))</span>
<span class='nv'>Trillian</span> <span class='nv'>seems</span> <span class='nv'>good.</span>
<span class='nv'>ok</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Note that this is a replacement of the <code>case</code> example above.</p>

<p>We can set the <code>data</code> variable differently to exercise the other code paths, and then enter the <code>cond</code> expression from above (elided below to save space):</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>data</span> <span class='o'>#(</span><span class='mi'>6</span> <span class='nb'>warn</span> <span class='s'>&quot;Arthur&quot;</span><span class='p'>))</span>
<span class='o'>#(</span><span class='mi'>6</span> <span class='nb'>warn</span> <span class='s'>&quot;Arthur&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>cond</span> <span class='o'>...</span> <span class='p'>)</span>
<span class='nv'>Be</span> <span class='nv'>careful</span> <span class='nv'>of</span> <span class='nv'>Arthur.</span>
<span class='nv'>ok</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>data</span> <span class='o'>#(</span><span class='mi'>6</span> <span class='nv'>err</span> <span class='s'>&quot;Zaphod&quot;</span><span class='p'>))</span>
<span class='o'>#(</span><span class='mi'>6</span> <span class='nv'>err</span> <span class='s'>&quot;Zaphod&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>cond</span> <span class='o'>...</span> <span class='p'>)</span>
<span class='nv'>There</span><span class='ss'>&#39;s</span> <span class='nv'>a</span> <span class='nv'>problem</span> <span class='nv'>with</span> <span class='nv'>Zaphod.</span>
<span class='nv'>ok</span>
<span class='nb'>&gt;</span>
</code></pre></div><a name='253_special_cases' />
<h3 id='253_special_cases'>2.5.3 Special Cases</h3>
<a name='2531_set_in_the_repl' />
<h4 id='2531__in_the_repl'>2.5.3.1 <code>set</code> in the REPL</h4>

<p>Using <code>set</code> in the REPL has the following general form:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>set</span> <span class='nv'>&lt;pattern&gt;</span> <span class='nv'>&lt;expression&gt;</span><span class='p'>)</span>
</code></pre></div>
<p>Note that <code>set</code> is only valid when running the LFE shell. Example usage:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='p'>(</span><span class='nv'>tuple</span> <span class='nv'>len</span> <span class='nv'>status</span> <span class='nv'>data</span><span class='p'>)</span>
       <span class='o'>#(</span><span class='mi'>8</span> <span class='nv'>ok</span> <span class='s'>&quot;Trillian&quot;</span><span class='p'>))</span>
<span class='o'>#(</span><span class='mi'>8</span> <span class='nv'>ok</span> <span class='s'>&quot;Trillian&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='nv'>len</span>
<span class='mi'>8</span>
<span class='nb'>&gt;</span> <span class='nv'>status</span>
<span class='nv'>ok</span>
<span class='nb'>&gt;</span> <span class='nv'>data</span>
<span class='s'>&quot;Trillian&quot;</span>
<span class='nb'>&gt;</span>
</code></pre></div><a name='2532_aliases_with_=' />
<h4 id='2532_aliases_with_'>2.5.3.2 Aliases with <code>=</code></h4>

<p>Aliases are defined with the following general form:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span> <span class='o'>...</span> <span class='p'>(</span><span class='nb'>=</span> <span class='nv'>&lt;pattern</span> <span class='nv'>1&gt;</span> <span class='nv'>&lt;pattern</span> <span class='nv'>2&gt;</span><span class='p'>)</span> <span class='o'>...</span> <span class='p'>)</span>
</code></pre></div>
<p>Aliases can be used anywhere in a pattern. A quick example of this, updating the previous example with aliases:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='p'>(</span><span class='nb'>=</span> <span class='p'>(</span><span class='nv'>tuple</span> <span class='nv'>len</span> <span class='nv'>status</span> <span class='nv'>data</span><span class='p'>)</span> <span class='p'>(</span><span class='nv'>tuple</span> <span class='nv'>a</span> <span class='nv'>b</span> <span class='nv'>c</span><span class='p'>))</span>
       <span class='o'>#(</span><span class='mi'>8</span> <span class='nv'>ok</span> <span class='s'>&quot;Trillian&quot;</span><span class='p'>))</span>
<span class='o'>#(</span><span class='mi'>8</span> <span class='nv'>ok</span> <span class='s'>&quot;Trillian&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>The same variables that were bound in the previous example are bound in this one:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='nv'>len</span>
<span class='mi'>8</span>
<span class='nb'>&gt;</span> <span class='nv'>status</span>
<span class='nv'>ok</span>
<span class='nb'>&gt;</span> <span class='nv'>data</span>
<span class='s'>&quot;Trillian&quot;</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>In addition, however, we have aliased new variables to these:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='nv'>a</span>
<span class='mi'>8</span>
<span class='nb'>&gt;</span> <span class='nv'>b</span>
<span class='nv'>ok</span>
<span class='nb'>&gt;</span> <span class='nv'>c</span>
<span class='s'>&quot;Trillian&quot;</span>
</code></pre></div><a name='2533_arguments_to_defun' />
<h4 id='2533_arguments_to_'>2.5.3.3 Arguments to <code>defun</code></h4>

<p>Pattern matching in functions has the following general form:</p>
<div class='highlight'><pre><code class='cl'>    <span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>name</span>
      <span class='p'>((</span><span class='nv'>argpat</span> <span class='o'>...</span><span class='p'>)</span> <span class='o'>...</span><span class='p'>)</span>
      <span class='o'>...</span><span class='p'>)</span>
</code></pre></div>
<p>We haven&#8217;t covered functions yet (that&#8217;s coming up in <a href='/user-guide/funcode/1.html'>Chapter 4</a>), so this will be a short preview focusing just on the pattern usage in functions, with more detail coming later.</p>

<p>Proper functions can&#8217;t be defined in the LFE REPL, so save the following to <code>func-pttrn.lfe</code>:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nv'>defmodule</span> <span class='nv'>func-pttrn</span>
  <span class='p'>(</span><span class='nb'>export</span> <span class='p'>(</span><span class='nv'>safety-check</span> <span class='mi'>2</span><span class='p'>)))</span>

<span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>safety-check</span>
  <span class='p'>((</span><span class='ss'>&#39;ok</span> <span class='nv'>msg</span><span class='p'>)</span>
    <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;~s seems good.~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>msg</span><span class='p'>)))</span>
  <span class='p'>((</span><span class='ss'>&#39;warn</span> <span class='nv'>msg</span><span class='p'>)</span>
    <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;There&#39;s a problem with ~s.~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>msg</span><span class='p'>)))</span>
  <span class='p'>((</span><span class='ss'>&#39;crit</span> <span class='nv'>msg</span><span class='p'>)</span>
    <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;Be careful of ~s.~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>msg</span><span class='p'>))))</span>
</code></pre></div>
<p>As you can see, the usual function arguments have been replaced with a pattern. In particular, this function will accept any of three options with two arguments each: where the first argument is <code>&#39;ok</code>, or where it is <code>&#39;warn</code>, or where it is <code>&#39;crit</code>.</p>

<p>Let&#8217;s compile our new module from the LFE REPL:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>c</span> <span class='o'>&#39;</span><span class='s'>&quot;func-pttrn&quot;</span><span class='p'>)</span>
<span class='o'>#(</span><span class='nv'>module</span> <span class='nv'>func-pttrn</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Now let&#8217;s step it through its paces:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>func-pttrn</span> <span class='nv'>safety-check</span> <span class='ss'>&#39;ok</span> <span class='o'>&#39;</span><span class='s'>&quot;Trillian&quot;</span><span class='p'>)</span>
<span class='nv'>Trillian</span> <span class='nv'>seems</span> <span class='nv'>good.</span>
<span class='nv'>ok</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>func-pttrn</span> <span class='nv'>safety-check</span> <span class='ss'>&#39;warn</span> <span class='o'>&#39;</span><span class='s'>&quot;Arthur&quot;</span><span class='p'>)</span>
<span class='nv'>There</span><span class='ss'>&#39;s</span> <span class='nv'>a</span> <span class='nv'>problem</span> <span class='nv'>with</span> <span class='nv'>Arthur.</span>
<span class='nv'>ok</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>func-pttrn</span> <span class='nv'>safety-check</span> <span class='ss'>&#39;crit</span> <span class='o'>&#39;</span><span class='s'>&quot;Zaphod&quot;</span><span class='p'>)</span>
<span class='nv'>Be</span> <span class='nv'>careful</span> <span class='nv'>of</span> <span class='nv'>Zaphod.</span>
<span class='nv'>ok</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>If a pattern is not matched in our example (which has no fallback pattern), an error is raised:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>func-pttrn</span> <span class='nv'>safety-check</span> <span class='ss'>&#39;oops</span> <span class='o'>&#39;</span><span class='s'>&quot;Eccentrica Gallumbits&quot;</span><span class='p'>)</span>
<span class='nv'>exception</span> <span class='nv'>error:</span> <span class='o'>#(</span><span class='nv'>case_clause</span> <span class='o'>#(</span><span class='nv'>oops</span> <span class='s'>&quot;Eccentrica Gallumbits&quot;</span><span class='p'>))</span>
  <span class='nv'>in</span> <span class='p'>(</span><span class='nv'>func-pttrn</span> <span class='nv'>safety-check</span> <span class='mi'>2</span><span class='p'>)</span>
</code></pre></div><a name='2534_arguments_to_anonymous_functions' />
<h4 id='2534_arguments_to_anonymous_functions'>2.5.3.4 Arguments to Anonymous Functions</h4>

<p>One can use patterns in arguments with anonymous functions similarly to how one does with named functions, demonstrated above. In LFE, this is done with <code>match-lambda</code>. Here&#8217;s an example done in the REPL:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>safety-check</span>
    <span class='p'>(</span><span class='nv'>match-lambda</span>
      <span class='p'>((</span><span class='ss'>&#39;ok</span> <span class='nv'>msg</span><span class='p'>)</span>
        <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;~s seems good.~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>msg</span><span class='p'>)))</span>
      <span class='p'>((</span><span class='ss'>&#39;warn</span> <span class='nv'>msg</span><span class='p'>)</span>
        <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;There&#39;s a problem with ~s.~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>msg</span><span class='p'>)))</span>
      <span class='p'>((</span><span class='ss'>&#39;crit</span> <span class='nv'>msg</span><span class='p'>)</span>
        <span class='p'>(</span><span class='err'>:</span> <span class='nv'>io</span> <span class='nb'>format</span> <span class='o'>&#39;</span><span class='s'>&quot;Be careful of ~s.~n&quot;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='nv'>msg</span><span class='p'>)))))</span>
<span class='err'>#</span><span class='nv'>Fun&lt;lfe_eval.31.53503600&gt;</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Usage is similar as well:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>safety-check</span> <span class='ss'>&#39;warn</span> <span class='o'>&#39;</span><span class='s'>&quot;Arthur&quot;</span><span class='p'>)</span>
<span class='nv'>There</span><span class='ss'>&#39;s</span> <span class='nv'>a</span> <span class='nv'>problem</span> <span class='nv'>with</span> <span class='nv'>Arthur.</span>
<span class='nv'>ok</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>safety-check</span> <span class='ss'>&#39;oops</span> <span class='o'>&#39;</span><span class='s'>&quot;Eccentrica Gallumbits&quot;</span><span class='p'>)</span>
<span class='nv'>exception</span> <span class='nv'>error:</span> <span class='nv'>function_clause</span>

<span class='nb'>&gt;</span>
</code></pre></div><a name='2535_patterns_in_comprehensions' />
<h4 id='2535_patterns_in_comprehensions'>2.5.3.5 Patterns in Comprehensions</h4>

<p>List and binary comprehensions make use of patterns in a limited sense. They have the following general forms:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nv'>&lt;-</span> <span class='nv'>pat</span> <span class='nv'>guard</span> <span class='nv'>list-expr</span><span class='p'>)</span>
</code></pre></div>
<p>and</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>&lt;=</span> <span class='nv'>bin-pat</span> <span class='nv'>guard</span> <span class='nv'>binary-expr</span><span class='p'>)</span>
</code></pre></div>
<p>where the <code>guard</code> in both cases is optional.</p>

<p>You can read more about LFE comprehensions in <a href='/user-guide/data/2.html'>section 3.3</a> <a name='3_lists_and_simple_data' /></p>

<h1 id='3_lists_and_simple_data'>3 Lists and Simple Data</h1>
<a name='31_lists' />
<h2 id='31_lists'>3.1 Lists</h2>

<p>Lists in Erlang and LFE are straight-forward; those coming from another programming language will not find anything surprising about them. Lists are generally good for storing and iterating over data that is of a similar type. There are other types one can use for more structured or complex data type combos.</p>

<p>You can create lists in LFE in the following ways:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='mi'>1</span> <span class='mi'>3</span> <span class='mi'>9</span> <span class='mi'>27</span><span class='p'>)</span>
<span class='p'>(</span><span class='mi'>1</span> <span class='mi'>3</span> <span class='mi'>9</span> <span class='mi'>27</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>1</span> <span class='mi'>3</span> <span class='mi'>9</span> <span class='mi'>27</span><span class='p'>)</span>
<span class='p'>(</span><span class='mi'>1</span> <span class='mi'>3</span> <span class='mi'>9</span> <span class='mi'>27</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>==</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>1</span> <span class='mi'>3</span> <span class='mi'>9</span> <span class='mi'>27</span><span class='p'>)</span> <span class='p'>(</span><span class='nb'>list</span> <span class='mi'>1</span> <span class='mi'>3</span> <span class='mi'>9</span> <span class='mi'>27</span><span class='p'>))</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>=:=</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>1</span> <span class='mi'>3</span> <span class='mi'>9</span> <span class='mi'>27</span><span class='p'>)</span> <span class='p'>(</span><span class='nb'>list</span> <span class='mi'>1</span> <span class='mi'>3</span> <span class='mi'>9</span> <span class='mi'>27</span><span class='p'>))</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>To get the length of a list, you&#8217;ll need to use the <code>length</code> function from the <code>erlang</code> module:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>erlang</span> <span class='nb'>length</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span> <span class='mi'>4</span> <span class='mi'>5</span> <span class='mi'>6</span> <span class='mi'>7</span><span class='p'>))</span>
<span class='mi'>7</span>
</code></pre></div>
<p>Later, we will discuss Lisp-specific functions that have been implemented in LFE, but this is a good time to mention a few classic functions:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>car</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span> <span class='mi'>4</span> <span class='mi'>5</span> <span class='mi'>6</span><span class='p'>))</span>
<span class='mi'>1</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>cdr</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span> <span class='mi'>4</span> <span class='mi'>5</span> <span class='mi'>6</span><span class='p'>))</span>
<span class='p'>(</span><span class='mi'>2</span> <span class='mi'>3</span> <span class='mi'>4</span> <span class='mi'>5</span> <span class='mi'>6</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>cadr</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span> <span class='mi'>4</span> <span class='mi'>5</span> <span class='mi'>6</span><span class='p'>))</span>
<span class='mi'>2</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>cddr</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span> <span class='mi'>4</span> <span class='mi'>5</span> <span class='mi'>6</span><span class='p'>))</span>
<span class='p'>(</span><span class='mi'>3</span> <span class='mi'>4</span> <span class='mi'>5</span> <span class='mi'>6</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>cons</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span><span class='p'>)</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>4</span> <span class='mi'>5</span> <span class='mi'>6</span><span class='p'>))</span>
<span class='p'>((</span><span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span><span class='p'>)</span> <span class='mi'>4</span> <span class='mi'>5</span> <span class='mi'>6</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>There is an Erlang <a href='http://www.erlang.org/doc/man/lists.html'>module
dedicated to handling lists</a> that we can take advantage of:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>lists</span> <span class='nb'>append</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>1</span> <span class='mi'>2</span><span class='p'>)</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>3</span> <span class='mi'>4</span><span class='p'>))</span>
<span class='p'>(</span><span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span> <span class='mi'>4</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>lists</span> <span class='nb'>append</span> <span class='p'>(</span><span class='nb'>list</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>1</span> <span class='mi'>2</span><span class='p'>)</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>3</span> <span class='mi'>4</span><span class='p'>)</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>5</span> <span class='mi'>6</span><span class='p'>)))</span>
<span class='p'>(</span><span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span> <span class='mi'>4</span> <span class='mi'>5</span> <span class='mi'>6</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>You can also use the <code>++</code> operator to combine two lists:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>++</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span><span class='p'>)</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>4</span> <span class='mi'>5</span> <span class='mi'>6</span><span class='p'>))</span>
<span class='p'>(</span><span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span> <span class='mi'>4</span> <span class='mi'>5</span> <span class='mi'>6</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Here&#8217;s a <code>map</code> example that generates the same list we manually created above:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>lists</span> <span class='nb'>map</span>
    <span class='p'>(</span><span class='k'>lambda</span> <span class='p'>(</span><span class='nv'>x</span><span class='p'>)</span>
      <span class='p'>(</span><span class='nv'>trunc</span>
        <span class='p'>(</span><span class='err'>:</span> <span class='nv'>math</span> <span class='nv'>pow</span> <span class='mi'>3</span> <span class='nv'>x</span><span class='p'>)))</span>
    <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>0</span> <span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span><span class='p'>))</span>
<span class='p'>(</span><span class='mi'>1</span> <span class='mi'>3</span> <span class='mi'>9</span> <span class='mi'>27</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Another one is <code>filter</code>, but before we use it, let&#8217;s first define a predicate that returns <code>true</code> for even numbers:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nb'>evenp</span>
    <span class='p'>(</span><span class='k'>lambda</span> <span class='p'>(</span><span class='nv'>x</span><span class='p'>)</span>
      <span class='p'>(</span><span class='nv'>==</span> <span class='mi'>0</span> <span class='p'>(</span><span class='nb'>rem</span> <span class='nv'>x</span> <span class='mi'>2</span><span class='p'>))))</span>
<span class='err'>#</span><span class='nv'>Fun&lt;lfe_eval.10.53503600&gt;</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Not let&#8217;s try out <code>filter</code> with our new predicate:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>lists</span> <span class='nv'>filter</span> <span class='nb'>evenp</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span> <span class='mi'>4</span> <span class='mi'>5</span> <span class='mi'>6</span><span class='p'>))</span>
<span class='p'>(</span><span class='mi'>2</span> <span class='mi'>4</span> <span class='mi'>6</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>There are many, many more highly useful functions in the <code>lists</code> module &#8211; be sure to give the docs a thorough reading, lest you miss something fun!</p>
<a name='311_i/o_lists' />
<h3 id='311_io_lists'>3.1.1 I/O Lists</h3>

<p>There is another type of list that is used for such things as file and network operations; it&#8217;s called an <code>IoList</code>. An <code>IoList</code> is a list whose elements are either</p>

<ul>
<li>integers ranging from 0 to 255,</li>

<li>binaries,</li>

<li>other <code>IoList</code>s, or</li>

<li>a combination of these.</li>
</ul>

<p>Here&#8217;s an example for you:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>list</span> <span class='o'>&#39;</span><span class='s'>&quot;hoopy&quot;</span> <span class='mi'>42</span> <span class='err'>#</span><span class='nv'>b</span><span class='p'>(</span><span class='s'>&quot;frood&quot;</span> <span class='mi'>210</span><span class='p'>)</span> <span class='p'>(</span><span class='nb'>list</span> <span class='err'>#</span><span class='nv'>b</span><span class='p'>(</span><span class='mi'>42</span> <span class='mi'>84</span> <span class='mi'>126</span><span class='p'>)</span> <span class='mi'>168</span> <span class='mi'>252</span><span class='p'>))</span>
<span class='p'>(</span><span class='s'>&quot;hoopy&quot;</span> <span class='mi'>42</span> <span class='err'>#</span><span class='nv'>B</span><span class='p'>(</span><span class='mi'>102</span> <span class='mi'>114</span> <span class='mi'>111</span> <span class='mi'>111</span> <span class='mi'>100</span> <span class='mi'>210</span><span class='p'>)</span> <span class='p'>(</span><span class='err'>#</span><span class='nv'>B</span><span class='p'>(</span><span class='mi'>42</span> <span class='mi'>84</span> <span class='mi'>126</span><span class='p'>)</span> <span class='mi'>168</span> <span class='mi'>252</span><span class='p'>))</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>You don&#8217;t need to flatten <code>IoList</code>s; they get passed as they are to the various low-level functions that accept an <code>IoList</code> and Erlang will flatten them efficiently for you.</p>

<p>We saw an example of this in a previous section when we were playing with strings as binaries. We ended up calling a function that accepted an <code>IoList</code> as a parameter and this saved us from having to flatten the list of binaries ourselves. If you recall, <code>data</code> was a long string and the <code>split</code> function returned a list of binaries:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>unicode</span> <span class='nv'>characters_to_list</span>
    <span class='p'>(</span><span class='err'>:</span> <span class='nv'>binary</span> <span class='nv'>split</span> <span class='nv'>data</span> <span class='p'>(</span><span class='nv'>binary</span> <span class='s'>&quot;who really knows &quot;</span><span class='p'>)))</span>
<span class='s'>&quot;There&#39;s a frood where his towel is.&quot;</span>
<span class='nb'>&gt;</span>
</code></pre></div><a name='32_tuples' />
<h2 id='32_tuples'>3.2 Tuples</h2>

<p>Tuples are the data melting pot for Erlang: you can combine any of Erlang&#8217;s data types (including lists and other tuples) into a single composite data type. This comes in very handy with pattern matching, but in general, makes passing data around much easier.</p>

<p>Creating a tuple can be as simple as:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>tuple</span><span class='p'>)</span>
<span class='o'>#(</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>But perhaps more useful:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>tuple</span> <span class='ss'>&#39;odds</span> <span class='o'>&#39;</span><span class='s'>&quot;5 to 1 against&quot;</span><span class='p'>)</span>
<span class='o'>#(</span><span class='nv'>odds</span> <span class='s'>&quot;5 to 1 against&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>You could also have done this:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='o'>#(</span><span class='nv'>odds</span> <span class='s'>&quot;5 to 1 against&quot;</span><span class='p'>)</span>
<span class='o'>#(</span><span class='nv'>odds</span> <span class='s'>&quot;5 to 1 against&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Here&#8217;s a simple data structure:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>data</span>
    <span class='p'>(</span><span class='nv'>tuple</span>
      <span class='ss'>&#39;|things to see|</span>
      <span class='p'>(</span><span class='nb'>list</span> <span class='o'>&#39;</span><span class='s'>&quot;moons of Jaglan Beta&quot;</span>
            <span class='o'>&#39;</span><span class='s'>&quot;beaches of Santraginus V&quot;</span>
            <span class='o'>&#39;</span><span class='s'>&quot;desert world of Kakrafoon&quot;</span>
            <span class='o'>&#39;</span><span class='s'>&quot;heavy river Moth&quot;</span><span class='p'>)</span>
      <span class='ss'>&#39;|things to avoid|</span>
      <span class='p'>(</span><span class='nb'>list</span> <span class='o'>&#39;</span><span class='s'>&quot;Ravenous Bugblatter Beast of Traal&quot;</span>
            <span class='o'>&#39;</span><span class='s'>&quot;small piece of fairy cake&quot;</span><span class='p'>)))</span>
<span class='o'>#(</span><span class='nv'>|things to see|</span>
  <span class='p'>(</span><span class='s'>&quot;moons of Jaglan Beta&quot;</span>
   <span class='s'>&quot;beaches of Santraginus V&quot;</span>
   <span class='s'>&quot;desert world of Kakrafoon&quot;</span>
   <span class='s'>&quot;heavy river Moth&quot;</span><span class='p'>)</span>
  <span class='nv'>|things to avoid|</span>
  <span class='p'>(</span><span class='s'>&quot;Ravenous Bugblatter Beast of Traal&quot;</span> <span class='s'>&quot;small piece of fairy cake&quot;</span><span class='p'>))</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Now let&#8217;s poke around at our new data structure:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>erlang</span> <span class='nv'>tuple_size</span> <span class='nv'>data</span><span class='p'>)</span>
<span class='mi'>4</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>erlang</span> <span class='nv'>element</span> <span class='mi'>1</span> <span class='nv'>data</span><span class='p'>)</span>
<span class='nv'>|things to see|</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>erlang</span> <span class='nv'>element</span> <span class='mi'>3</span> <span class='nv'>data</span><span class='p'>)</span>
<span class='nv'>|things to avoid|</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Using the erlang module&#8217;s function is one way to get our tuple data, but you&#8217;ll probably not use that as much as the next method we show you.</p>

<p>We&#8217;re going to sneak ahead here a bit, and touch on patterns again; we&#8217;ll explain in more detail in the actual section on patterns! For now, though, just know that extracting data from structures such as our tuple is very easy with patterns. Take a look:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='p'>(</span><span class='nv'>tuple</span> <span class='nv'>key1</span> <span class='nv'>val1</span> <span class='nv'>key2</span> <span class='nv'>val2</span><span class='p'>)</span> <span class='nv'>data</span><span class='p'>)</span>
<span class='o'>#(</span><span class='nv'>|things to see|</span>
  <span class='p'>(</span><span class='s'>&quot;moons of Jaglan Beta&quot;</span>
   <span class='s'>&quot;beaches of Santraginus V&quot;</span>
   <span class='s'>&quot;desert world of Kakrafoon&quot;</span>
   <span class='s'>&quot;heavy river Moth&quot;</span><span class='p'>)</span>
  <span class='nv'>|things to avoid|</span>
  <span class='p'>(</span><span class='s'>&quot;Ravenous Bugblatter Beast of Traal&quot;</span> <span class='s'>&quot;small piece of fairy cake&quot;</span><span class='p'>))</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>To be clear: had we needed to do this in a function, we would have used <code>let</code> ;-)</p>

<p>Now we can references our data by the variables we bound when we extracted it with the pattern in our <code>set</code> call:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='nv'>key1</span>
<span class='nv'>|things to see|</span>
<span class='nb'>&gt;</span> <span class='nv'>key2</span>
<span class='nv'>|things to avoid|</span>
<span class='nb'>&gt;</span> <span class='nv'>val1</span>
<span class='p'>(</span><span class='s'>&quot;moons of Jaglan Beta&quot;</span>
 <span class='s'>&quot;beaches of Santraginus V&quot;</span>
 <span class='s'>&quot;desert world of Kakrafoon&quot;</span>
 <span class='s'>&quot;heavy river Moth&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='nv'>val2</span>
<span class='p'>(</span><span class='s'>&quot;Ravenous Bugblatter Beast of Traal&quot;</span> <span class='s'>&quot;small piece of fairy cake&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div><a name='33_comprehensions' />
<h2 id='33_comprehensions'>3.3 Comprehensions</h2>

<p>In the section on lists, we gave an example of building a list using the <code>map</code> function:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>lists</span> <span class='nb'>map</span>
    <span class='p'>(</span><span class='k'>lambda</span> <span class='p'>(</span><span class='nv'>x</span><span class='p'>)</span>
      <span class='p'>(</span><span class='nv'>trunc</span>
        <span class='p'>(</span><span class='err'>:</span> <span class='nv'>math</span> <span class='nv'>pow</span> <span class='mi'>3</span> <span class='nv'>x</span><span class='p'>)))</span>
    <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>0</span> <span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span><span class='p'>))</span>
<span class='p'>(</span><span class='mi'>1</span> <span class='mi'>3</span> <span class='mi'>9</span> <span class='mi'>27</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>This sort of approach should be familiar to many programmers, even those who aren&#8217;t adepts at functional programming. This is a well-known pattern. Erlang offers another pattern, though: comprehensions.</p>

<p>LFE supports Erlang comprehensions via two macros: <code>lc</code> for list comprehensions and <code>bc</code> for bitstring comprehensions.</p>
<a name='331_list_comprehensions' />
<h3 id='331_list_comprehensions'>3.3.1 List Comprehensions</h3>

<p>Let&#8217;s take a look at an example and then discuss it. Here&#8217;s a list comprehension version of our <code>map</code>/<code>lambda</code> combo above:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>lc</span>
    <span class='p'>((</span><span class='nv'>&lt;-</span> <span class='nv'>x</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='mi'>0</span> <span class='mi'>1</span> <span class='mi'>2</span> <span class='mi'>3</span><span class='p'>)))</span>
    <span class='p'>(</span><span class='nv'>trunc</span>
      <span class='p'>(</span><span class='err'>:</span> <span class='nv'>math</span> <span class='nv'>pow</span> <span class='mi'>3</span> <span class='nv'>x</span><span class='p'>)))</span>
<span class='p'>(</span><span class='mi'>1</span> <span class='mi'>3</span> <span class='mi'>9</span> <span class='mi'>27</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>This can be translated to English as &#8220;the list of integers whose values are <code>x</code> raised to the power of <code>3</code> where <code>x</code> is taken from the list we provided, iterated in order from first to last.&#8221;</p>

<p>In Erlang, this would have looked like the following:</p>
<div class='highlight'><pre><code class='erlang'><span class='mi'>1</span><span class='o'>&gt;</span> <span class='p'>[</span><span class='nb'>trunc</span><span class='p'>(</span><span class='nn'>math</span><span class='p'>:</span><span class='nf'>pow</span><span class='p'>(</span><span class='nv'>X</span><span class='p'>,</span><span class='mi'>3</span><span class='p'>))</span> <span class='p'>||</span> <span class='nv'>X</span> <span class='o'>&lt;-</span> <span class='p'>[</span><span class='mi'>0</span><span class='p'>,</span><span class='mi'>1</span><span class='p'>,</span><span class='mi'>2</span><span class='p'>,</span><span class='mi'>3</span><span class='p'>]].</span>
<span class='p'>[</span><span class='mi'>0</span><span class='p'>,</span><span class='mi'>1</span><span class='p'>,</span><span class='mi'>8</span><span class='p'>,</span><span class='mi'>27</span><span class='p'>]</span>
<span class='mi'>2</span><span class='o'>&gt;</span>
</code></pre></div>
<p>As we can see, the LFE syntax is not as concise as the native Erlang syntax, though it is pretty close. Our original example is 62 characters long; the LFE list comprehension is 49 characters long; the Erlang version is 41 characters.</p>

<p>To a Lisper, the original is probably much more legible. However, in Erlang these is no question that the list comprehensions are shorter and easier to read than using anonymous functions.</p>
<a name='331_bitstring_comprehensions' />
<h3 id='331_bitstring_comprehensions'>3.3.1 Bitstring Comprehensions</h3>

<p>For binary data, we have something similar to the list comprehension. Here&#8217;s what a bitstring comprehension looks like (adapted from the example given by Francesco Cesarini and Simon Thompson in their book, &#8220;Erlang Programming&#8221;):</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>bc</span>
    <span class='p'>((</span><span class='nb'>&lt;=</span> <span class='p'>(</span><span class='nv'>x</span> <span class='p'>(</span><span class='nv'>size</span> <span class='mi'>1</span><span class='p'>))</span> <span class='p'>(</span><span class='nv'>binary</span> <span class='p'>(</span><span class='mi'>42</span> <span class='p'>(</span><span class='nv'>size</span> <span class='mi'>6</span><span class='p'>)))))</span>
    <span class='p'>((</span><span class='nv'>bnot</span> <span class='nv'>x</span><span class='p'>)</span> <span class='p'>(</span><span class='nv'>size</span> <span class='mi'>1</span><span class='p'>)))</span>
<span class='err'>#</span><span class='nv'>B</span><span class='p'>((</span><span class='mi'>21</span> <span class='p'>(</span><span class='nv'>size</span> <span class='mi'>6</span><span class='p'>)))</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Note that the bitstring comprehension uses the <code>&lt;=</code> operator (not to be confused with the <code>=&lt;</code> equality operator!) instead of the <code>&lt;-</code> that list comprehensions use.</p>

<p>Here&#8217;s the Erlang version:</p>
<div class='highlight'><pre><code class='erlang'><span class='mi'>2</span><span class='o'>&gt;</span> <span class='o'>&lt;&lt;</span> <span class='o'>&lt;&lt;</span><span class='ow'>bnot</span><span class='p'>(</span><span class='nv'>X</span><span class='p'>):</span><span class='mi'>1</span><span class='o'>&gt;&gt;</span> <span class='p'>||</span> <span class='o'>&lt;&lt;</span><span class='nv'>X</span><span class='p'>:</span><span class='mi'>1</span><span class='o'>&gt;&gt;</span> <span class='o'>&lt;=</span> <span class='o'>&lt;&lt;</span><span class='mi'>42</span><span class='p'>:</span><span class='mi'>6</span><span class='o'>&gt;&gt;</span> <span class='o'>&gt;&gt;</span><span class='p'>.</span>
<span class='o'>&lt;&lt;</span><span class='mi'>21</span><span class='p'>:</span><span class='mi'>6</span><span class='o'>&gt;&gt;</span>
<span class='mi'>3</span><span class='o'>&gt;</span>
</code></pre></div>
<p>As we might expect, the native Erlang version is much more concise. Fortunately, though, in LFE we don&#8217;t need to enter the whole binary form, just the bit syntax portion. In other words, instead of writing this:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nv'>binary</span> <span class='p'>(</span><span class='nv'>x</span> <span class='p'>(</span><span class='nv'>size</span> <span class='mi'>1</span><span class='p'>)))</span>
</code></pre></div>
<p>and this:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nv'>binary</span> <span class='p'>((</span><span class='nv'>bnot</span> <span class='nv'>x</span><span class='p'>)</span> <span class='p'>(</span><span class='nv'>size</span> <span class='mi'>1</span><span class='p'>)))</span>
</code></pre></div>
<p>we only had to write this:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nv'>x</span> <span class='p'>(</span><span class='nv'>size</span> <span class='mi'>1</span><span class='p'>))</span>
</code></pre></div>
<p>and this:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>((</span><span class='nv'>bnot</span> <span class='nv'>x</span><span class='p'>)</span> <span class='p'>(</span><span class='nv'>size</span> <span class='mi'>1</span><span class='p'>))</span>
</code></pre></div><a name='34_property_lists_and_hashes' />
<h2 id='34_property_lists_and_hashes'>3.4 Property Lists and Hashes</h2>
<a name='341_property_lists' />
<h3 id='341_property_lists'>3.4.1 Property Lists</h3>

<p>Property lists are just lists whose entries are key/value tuples. Alternatively, an entry may be a single atom, in which case it implies a tuple with the atom as the key and <code>true</code> as the value.</p>

<p>Since there&#8217;s no special type here, we just create a regular list:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>plist</span>
    <span class='p'>(</span><span class='nb'>list</span>
      <span class='p'>(</span><span class='nv'>tuple</span> <span class='ss'>&#39;|to see|</span>
             <span class='o'>&#39;</span><span class='s'>&quot;moons of Jaglan Beta&quot;</span>
             <span class='o'>&#39;</span><span class='s'>&quot;beaches of Santraginus V&quot;</span><span class='p'>)</span>
      <span class='p'>(</span><span class='nv'>tuple</span> <span class='ss'>&#39;|to avoid|</span>
             <span class='o'>&#39;</span><span class='s'>&quot;small piece of fairy cake&quot;</span><span class='p'>)))</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Let&#8217;s see what keys we have defined:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>proplists</span> <span class='nv'>get_keys</span> <span class='nv'>plist</span><span class='p'>)</span>
<span class='p'>(</span><span class='nv'>|to avoid|</span> <span class='nv'>|to see|</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Extracting data by key:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>proplists</span> <span class='nv'>lookup</span> <span class='ss'>&#39;|to see|</span> <span class='nv'>plist</span><span class='p'>)</span>
<span class='o'>#(</span><span class='nv'>|to see|</span> <span class='s'>&quot;moons of Jaglan Beta&quot;</span> <span class='s'>&quot;beaches of Santraginus V&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>proplists</span> <span class='nv'>lookup</span> <span class='ss'>&#39;|to avoid|</span> <span class='nv'>plist</span><span class='p'>)</span>
<span class='o'>#(</span><span class='nv'>|to avoid|</span> <span class='s'>&quot;small piece of fairy cake&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>If you know that your value is single-valued (e.g., not a list), then you can do this:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>proplists</span> <span class='nv'>get_value</span> <span class='ss'>&#39;|to avoid|</span> <span class='nv'>plist</span><span class='p'>)</span>
<span class='s'>&quot;small piece of fairy cake&quot;</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>There is more information about property lists on the <a href='http://www.erlang.org/doc/man/proplists.html'>docs</a> page for them.</p>
<a name='342_hashes' />
<h3 id='342_hashes'>3.4.2 Hashes</h3>

<p>There is no builtin &#8220;dictionary&#8221; or &#8220;hash&#8221; type in Erlang. However, there are some libraries that support data structures like these. There is also a concept of &#8220;records&#8221; which we will discuss in another section.</p>
<a name='3421_the_dictionary' />
<h4 id='3421_the_dictionary'>3.4.2.1 The Dictionary</h4>

<p>The Erlang <code>dict</code> module implements a key/value dictionary part of which is an additional <code>dict</code> data type which supplements the built-in Erlang data types.</p>

<p>Here&#8217;s how you create a new <code>dict</code>:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>my-dict</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>dict</span> <span class='nv'>new</span><span class='p'>))</span>
<span class='o'>#(</span><span class='nv'>dict</span>
  <span class='mi'>0</span>
  <span class='mi'>16</span>
  <span class='mi'>16</span>
  <span class='mi'>8</span>
  <span class='mi'>80</span>
  <span class='mi'>48</span>
  <span class='o'>#(</span><span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>())</span>
  <span class='o'>#(#(</span><span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>()</span> <span class='p'>())))</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Let&#8217;s check that there&#8217;s no actual data in it:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>dict</span> <span class='nv'>size</span> <span class='nv'>my-dict</span><span class='p'>)</span>
<span class='mi'>0</span>
</code></pre></div>
<p>Now let&#8217;s add some!</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>my-dict</span>
    <span class='p'>(</span><span class='err'>:</span> <span class='nv'>dict</span> <span class='nb'>append</span> <span class='ss'>&#39;|to see|</span> <span class='o'>&#39;</span><span class='s'>&quot;moons of Jaglan Beta&quot;</span> <span class='nv'>my-dict</span><span class='p'>))</span>
<span class='o'>#(</span><span class='nv'>dict</span> <span class='o'>...</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>my-dict</span>
    <span class='p'>(</span><span class='err'>:</span> <span class='nv'>dict</span> <span class='nb'>append</span> <span class='ss'>&#39;|to avoid|</span> <span class='o'>&#39;</span><span class='s'>&quot;small piece of fairy cake&quot;</span> <span class='nv'>my-dict</span><span class='p'>))</span>
<span class='o'>#(</span><span class='nv'>dict</span> <span class='o'>...</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>As you might guess from the usage, <code>dict</code>s are not updated in-place. A new dictionary is returned with each call to <code>append</code>. As such, we need to re<code>set</code> with each append. Is everything there?</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>dict</span> <span class='nv'>size</span> <span class='nv'>my-dict</span><span class='p'>)</span>
<span class='mi'>2</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Looking good so far&#8230; Now let&#8217;s get some data out:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>dict</span> <span class='nv'>fetch</span> <span class='ss'>&#39;|to avoid|</span> <span class='nv'>my-dict</span><span class='p'>)</span>
<span class='p'>(</span><span class='s'>&quot;small piece of fairy cake&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Why the is the function called &#8220;append&#8221;? Well, <code>dict</code> accepts multiple values for keys. Let&#8217;s try this out, and then re-query our <code>dict</code>:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>erlang</span> <span class='nb'>length</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>dict</span> <span class='nv'>fetch</span> <span class='ss'>&#39;|to see|</span> <span class='nv'>my-dict</span><span class='p'>))</span>
<span class='mi'>1</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>my-dict</span>
    <span class='p'>(</span><span class='err'>:</span> <span class='nv'>dict</span> <span class='nb'>append</span> <span class='ss'>&#39;|to see|</span> <span class='o'>&#39;</span><span class='s'>&quot;beaches of Santraginus V&quot;</span> <span class='nv'>my-dict</span><span class='p'>))</span>
<span class='o'>#(</span><span class='nv'>dict</span> <span class='o'>...</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>erlang</span> <span class='nb'>length</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>dict</span> <span class='nv'>fetch</span> <span class='ss'>&#39;|to see|</span> <span class='nv'>my-dict</span><span class='p'>))</span>
<span class='mi'>2</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>dict</span> <span class='nv'>size</span> <span class='nv'>my-dict</span><span class='p'>)</span>
<span class='mi'>2</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>dict</span> <span class='nv'>fetch</span> <span class='ss'>&#39;|to see|</span> <span class='nv'>my-dict</span><span class='p'>)</span>
<span class='p'>(</span><span class='s'>&quot;moons of Jaglan Beta&quot;</span> <span class='s'>&quot;beaches of Santraginus V&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>The size of the <code>my-dict</code> didn&#8217;t change because we didn&#8217;t add a new key; rather, we updated an existing one, appending a new value. The <code>|to see|</code> key now has two values in it.</p>

<p>You can also build <code>dict</code>s from a list of tuples:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>my-dict-2</span>
    <span class='p'>(</span><span class='err'>:</span> <span class='nv'>dict</span> <span class='nv'>from_list</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='o'>#(</span><span class='ss'>&#39;key1</span> <span class='o'>&#39;</span><span class='s'>&quot;foo&quot;</span><span class='p'>)</span> <span class='o'>#(</span><span class='ss'>&#39;key2</span> <span class='o'>&#39;</span><span class='s'>&quot;bar&quot;</span><span class='p'>))))</span>
<span class='o'>#(</span><span class='nv'>dict</span> <span class='o'>...</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>dict</span> <span class='nv'>size</span> <span class='nv'>my-dict-2</span><span class='p'>)</span>
<span class='mi'>2</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>There are many more functions to explore in the <a href='http://www.erlang.org/doc/man/dict.html'>dict docs</a>.</p>
<a name='3422_other_hash_tables' />
<h4 id='3422_other_hash_tables'>3.4.2.2 Other Hash Tables</h4>

<p>OTP comes with the <code>ets</code> module which provides the ability to store very large quantities of data in an Erlang runtime system. The <code>ets</code> module supports hash tables of the following types:</p>

<ul>
<li><code>set</code></li>

<li><code>ordered_set</code></li>

<li><code>bag</code></li>

<li><code>duplicate_bag</code></li>
</ul>

<p>The documentation for this module is <a href='http://www.erlang.org/doc/man/ets.html'>here</a>, though we will be adding information on how to use this from LFE at a later point (likely a dedicated tutorial).</p>
<a name='35_records' />
<h2 id='35_records'>3.5 Records</h2>
<a name='351_just_records' />
<h3 id='351_just_records'>3.5.1 Just Records</h3>

<p>Sometimes lists, tuples, property lists, or hashes are not quite what is needed. With tuples, you can&#8217;t name keys (without awkward work-arounds), and this makes working with large tuples rather cumbersome. Records are one way around this.</p>

<p>A record is a data structure for storing a fixed number of elements. It has named fields and LFE provides some convenience functions/macros for interacting with them.</p>

<p>However, it is important to note that record expressions are translated to tuple expressions during compilation. Due to this, record expressions are not understood by the shell in both Erlang and LFE. The examples in this section, therefore, will assume that you are saving the code to a file.</p>

<p>Let&#8217;s start by defining a record. Save this in a file named <code>record.lfe</code>:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nv'>defmodule</span> <span class='nv'>rec</span><span class='p'>)</span>

<span class='p'>(</span><span class='nv'>defrecord</span> <span class='nv'>person</span>
  <span class='nv'>name</span>
  <span class='nv'>address</span>
  <span class='nv'>age</span><span class='p'>)</span>
</code></pre></div>
<p>Then load it up in the REPL:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>slurp</span> <span class='o'>&#39;</span><span class='s'>&quot;record.lfe&quot;</span><span class='p'>)</span>
<span class='o'>#(</span><span class='nv'>ok</span> <span class='nv'>rec</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Now let&#8217;s create some people:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>ford</span>
    <span class='p'>(</span><span class='nv'>make-person</span> <span class='nv'>name</span> <span class='o'>&#39;</span><span class='s'>&quot;Ford Prefect&quot;</span>
                 <span class='nv'>address</span> <span class='o'>&#39;</span><span class='s'>&quot;Betelgeuse Seven&quot;</span>
                 <span class='nv'>age</span> <span class='mi'>234</span><span class='p'>))</span>
<span class='o'>#(</span><span class='nv'>person</span> <span class='s'>&quot;Ford Prefect&quot;</span> <span class='s'>&quot;Betelgeuse Seven&quot;</span> <span class='mi'>234</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>trillian</span>
    <span class='p'>(</span><span class='nv'>make-person</span> <span class='nv'>name</span> <span class='o'>&#39;</span><span class='s'>&quot;Tricia Marie McMillan&quot;</span>
                 <span class='nv'>age</span> <span class='mi'>60</span><span class='p'>))</span>
<span class='o'>#(</span><span class='nv'>person</span> <span class='s'>&quot;Tricia Marie McMillan&quot;</span> <span class='nv'>undefined</span> <span class='mi'>60</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Let&#8217;s define a non-person, too:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>zaphod</span> <span class='o'>#(</span><span class='s'>&quot;Zaphod Beeblebrox&quot;</span><span class='p'>))</span>
<span class='o'>#(</span><span class='s'>&quot;Zaphod Beeblebrox&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Some quick checks:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>is-person</span> <span class='nv'>ford</span><span class='p'>)</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>is-person</span> <span class='nv'>zaphod</span><span class='p'>)</span>
<span class='nv'>false</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>If you remember working with the tuples, property lists, and dictionaries, then you will enjoy the relative succinctness of the following usages:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>person-name</span> <span class='nv'>ford</span><span class='p'>)</span>
<span class='s'>&quot;Ford Prefect&quot;</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>person-address</span> <span class='nv'>ford</span><span class='p'>)</span>
<span class='s'>&quot;Betelgeuse Seven&quot;</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>person-age</span> <span class='nv'>ford</span><span class='p'>)</span>
<span class='mi'>234</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Let&#8217;s make some changes to our data:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>ford</span>
    <span class='p'>(</span><span class='nv'>set-person-age</span> <span class='nv'>ford</span> <span class='mi'>244</span><span class='p'>))</span>
<span class='o'>#(</span><span class='nv'>person</span> <span class='s'>&quot;Ford Prefect&quot;</span> <span class='s'>&quot;Betelgeuse Seven&quot;</span> <span class='mi'>244</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>person-age</span> <span class='nv'>ford</span><span class='p'>)</span>
<span class='mi'>244</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Just as we saw with the <code>dict</code> examples, <code>set-person-age</code> doesn&#8217;t modify the data in-place, but rather returns a new record. If we want to use that data in the future, we&#8217;ll need to assign it to a variable (sensibly, we re-use the <code>ford</code> variable here).</p>

<p>Also, note that there are also <code>set-person-name</code> and <code>set-person-address</code>.</p>
<a name='352_records_and_ets' />
<h3 id='352_records_and_ets'>3.5.2 Records and ETS</h3>

<p>Additional convenience functions for records are provided by LFE, but some of these will only make sense in the context of ETS (Erlang Term Storage), when when the ability to store large amounts of data in memory becomes important. We will be discussing this in detail later, but this section provides a quick preview.</p>

<p>Let&#8217;s create an ETS table:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>people</span>
    <span class='p'>(</span><span class='err'>:</span> <span class='nv'>ets</span> <span class='nv'>new</span> <span class='ss'>&#39;people-table</span> <span class='o'>&#39;</span><span class='p'>(</span><span class='o'>#(</span><span class='nv'>keypos</span> <span class='mi'>2</span><span class='p'>)</span> <span class='nb'>set</span><span class='p'>)))</span>
<span class='mi'>16401</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Now let&#8217;s insert the two <code>person</code> records that we created above:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>ets</span> <span class='nv'>insert</span> <span class='nv'>people</span> <span class='nv'>ford</span><span class='p'>)</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>ets</span> <span class='nv'>insert</span> <span class='nv'>people</span> <span class='nv'>trillian</span><span class='p'>)</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Now that we have a table with some data in it, we can do some querying. Let&#8217;s start with the <code>emp-match</code> LFE macro. Here&#8217;s how we can get the name for every record in the table:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>ets</span> <span class='nv'>match</span> <span class='nv'>people</span> <span class='p'>(</span><span class='nv'>emp-person</span> <span class='nv'>name</span> <span class='ss'>&#39;$1</span><span class='p'>))</span>
<span class='p'>((</span><span class='s'>&quot;Ford Prefect&quot;</span><span class='p'>)</span> <span class='p'>(</span><span class='s'>&quot;Tricia Marie McMillan&quot;</span><span class='p'>))</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Or, we can adjust that to return the name and address:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>ets</span> <span class='nv'>match</span> <span class='nv'>people</span> <span class='p'>(</span><span class='nv'>emp-person</span> <span class='nv'>name</span> <span class='ss'>&#39;$1</span> <span class='nv'>address</span> <span class='ss'>&#39;$2</span><span class='p'>))</span>
<span class='p'>((</span><span class='s'>&quot;Ford Prefect&quot;</span> <span class='s'>&quot;Betelgeuse Seven&quot;</span><span class='p'>)</span> <span class='p'>(</span><span class='s'>&quot;Tricia Marie McMillan&quot;</span> <span class='nv'>undefined</span><span class='p'>))</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>With the <code>match-person</code> LFE macro, we can do more sophisticated querying</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>ets</span> <span class='nv'>select</span> <span class='nv'>people</span>
    <span class='p'>(</span><span class='nv'>match-spec</span> <span class='p'>(((</span><span class='nv'>match-person</span> <span class='nv'>name</span> <span class='nv'>found-name</span> <span class='nv'>age</span> <span class='nv'>found-age</span><span class='p'>))</span>
                 <span class='p'>(</span><span class='nb'>when</span> <span class='p'>(</span><span class='nb'>&gt;</span> <span class='mi'>100</span> <span class='nv'>found-age</span><span class='p'>))</span>
                 <span class='nv'>found-name</span><span class='p'>)))</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='s'>&quot;Tricia Marie McMillan&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>Here we&#8217;ve done a select in the &#8220;people&#8221; table for any person whose age is less than 100.</p>

<p>Here&#8217;s what it looks like when multiple records are returned:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>ets</span> <span class='nv'>select</span> <span class='nv'>people</span>
    <span class='p'>(</span><span class='nv'>match-spec</span> <span class='p'>(((</span><span class='nv'>match-person</span> <span class='nv'>name</span> <span class='nv'>found-name</span> <span class='nv'>age</span> <span class='nv'>found-age</span><span class='p'>))</span>
                 <span class='p'>(</span><span class='nb'>when</span> <span class='p'>(</span><span class='nb'>&lt;</span> <span class='mi'>21</span> <span class='nv'>found-age</span><span class='p'>))</span>
                 <span class='nv'>found-name</span><span class='p'>)))</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='s'>&quot;Ford Prefect&quot;</span> <span class='s'>&quot;Tricia Marie McMillan&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>This should be enough of an ETS taste to last until you get to the dedicated tutorial ;-)</p>
<a name='36_hrl_header_files' />
<h2 id='36__header_files'>3.6 <code>.hrl</code> Header Files</h2>
<a name='4_functions_and_modules' />
<h1 id='4_functions_and_modules'>4 Functions and Modules</h1>
<a name='41_functions' />
<h2 id='41_functions'>4.1 Functions</h2>
<a name='411_intro_and_recap' />
<h3 id='411_intro_and_recap'>4.1.1 Intro and Recap</h3>
<a name='412_parity' />
<h3 id='412_parity'>4.1.2 Parity</h3>
<a name='413_more_patterns' />
<h3 id='413_more_patterns'>4.1.3 More Patterns</h3>
<a name='414_anonymouns_functions' />
<h3 id='414_anonymouns_functions'>4.1.4 Anonymouns Functions</h3>
<a name='415_higher-order_functions' />
<h3 id='415_higherorder_functions'>4.1.5 Higher-Order Functions</h3>
<a name='4151_as_input' />
<h4 id='4151_as_input'>4.1.5.1 As Input</h4>
<a name='4152_as_output' />
<h4 id='4152_as_output'>4.1.5.2 As Output</h4>
<a name='42_lfe-specific_functions_and_macros' />
<h2 id='42_lfespecific_functions_and_macros'>4.2 LFE-Specific Functions and Macros</h2>
<a name='421_core_forms' />
<h3 id='421_core_forms'>4.2.1 Core Forms</h3>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='k'>quote</span> <span class='nv'>e</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>cons</span> <span class='nv'>head</span> <span class='nv'>tail</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>car</span> <span class='nv'>e</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>cdr</span> <span class='nv'>e</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>list</span> <span class='nv'>e</span> <span class='o'>...</span> <span class='p'>)</span>
<span class='p'>(</span><span class='nv'>tuple</span> <span class='nv'>e</span> <span class='o'>...</span> <span class='p'>)</span>
<span class='p'>(</span><span class='nv'>binary</span> <span class='nv'>seg</span> <span class='o'>...</span> <span class='p'>)</span>
<span class='p'>(</span><span class='k'>lambda</span> <span class='p'>(</span><span class='nv'>arg</span> <span class='o'>...</span><span class='p'>)</span> <span class='o'>...</span><span class='p'>)</span>
<span class='p'>(</span><span class='nv'>match-lambda</span>
  <span class='p'>((</span><span class='nv'>arg</span> <span class='o'>...</span> <span class='p'>)</span> <span class='p'>(</span><span class='nb'>when</span> <span class='nv'>e</span> <span class='o'>...</span><span class='p'>)</span> <span class='o'>...</span><span class='p'>)</span>
  <span class='o'>...</span> <span class='p'>)</span>
<span class='p'>(</span><span class='k'>let</span> <span class='p'>((</span><span class='nv'>pat</span> <span class='p'>(</span><span class='nb'>when</span> <span class='nv'>e</span> <span class='o'>...</span><span class='p'>)</span> <span class='nv'>e</span><span class='p'>)</span>
      <span class='o'>...</span><span class='p'>)</span>
  <span class='o'>...</span> <span class='p'>)</span>
<span class='p'>(</span><span class='nv'>let-function</span> <span class='p'>((</span><span class='nv'>name</span> <span class='k'>lambda</span><span class='nv'>|match-lambda)</span>
<span class='nv'>               ... )</span>
<span class='nv'>  ... )</span>
<span class='nv'>(letrec-function ((name lambda|match-lambda</span><span class='p'>)</span>
                  <span class='o'>...</span> <span class='p'>)</span>
  <span class='o'>...</span> <span class='p'>)</span>
<span class='p'>(</span><span class='nv'>let-macro</span> <span class='p'>((</span><span class='nv'>name</span> <span class='nv'>lambda-match-lambda</span><span class='p'>)</span>
            <span class='o'>...</span><span class='p'>)</span>
  <span class='o'>...</span><span class='p'>)</span>
<span class='p'>(</span><span class='k'>progn</span> <span class='o'>...</span> <span class='p'>)</span>
<span class='p'>(</span><span class='k'>if</span> <span class='nv'>test</span> <span class='nv'>true-expr</span> <span class='nv'>false-expr</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>case</span> <span class='nv'>e</span>
  <span class='p'>(</span><span class='nv'>pat</span> <span class='p'>(</span><span class='nb'>when</span> <span class='nv'>e</span> <span class='o'>...</span><span class='p'>)</span> <span class='o'>...</span><span class='p'>)</span>
   <span class='o'>...</span> <span class='p'>))</span>
<span class='p'>(</span><span class='nv'>receive</span>
  <span class='p'>(</span><span class='nv'>pat</span> <span class='p'>(</span><span class='nb'>when</span> <span class='nv'>e</span> <span class='o'>...</span><span class='p'>)</span> <span class='o'>...</span> <span class='p'>)</span>
  <span class='o'>...</span>
  <span class='p'>(</span><span class='nv'>after</span> <span class='nv'>timeout</span> <span class='o'>...</span> <span class='p'>))</span>
<span class='p'>(</span><span class='k'>catch</span> <span class='o'>...</span> <span class='p'>)</span>
<span class='p'>(</span><span class='nv'>try</span>
  <span class='nv'>e</span>
  <span class='p'>(</span><span class='nb'>case</span> <span class='p'>((</span><span class='nv'>pat</span> <span class='p'>(</span><span class='nb'>when</span> <span class='nv'>e</span> <span class='o'>...</span><span class='p'>)</span> <span class='o'>...</span> <span class='p'>)</span>
          <span class='o'>...</span> <span class='p'>))</span>
  <span class='p'>(</span><span class='k'>catch</span>
     <span class='p'>(((</span><span class='nv'>tuple</span> <span class='k'>type</span> <span class='nv'>value</span> <span class='k'>ignore</span><span class='p'>)</span> <span class='p'>(</span><span class='nb'>when</span> <span class='nv'>e</span> <span class='o'>...</span><span class='p'>)</span>

      <span class='o'>...</span> <span class='p'>)</span>
     <span class='o'>...</span> <span class='p'>)</span>
  <span class='p'>(</span><span class='nv'>after</span> <span class='o'>...</span> <span class='p'>))</span>
<span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>func</span> <span class='nv'>arg</span> <span class='o'>...</span> <span class='p'>)</span>
<span class='p'>(</span><span class='nv'>call</span> <span class='nb'>mod</span> <span class='nv'>func</span> <span class='nv'>arg</span> <span class='o'>...</span> <span class='p'>)</span>

<span class='p'>(</span><span class='nv'>define-function</span> <span class='nv'>name</span> <span class='k'>lambda</span><span class='nv'>|match-lambda)</span>
<span class='nv'>(define-macro name lambda|match-lambda</span><span class='p'>)</span>
</code></pre></div><a name='422_macro_forms' />
<h3 id='422_macro_forms'>4.2.2 Macro Forms</h3>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='err'>:</span> <span class='nb'>mod</span> <span class='nv'>func</span> <span class='nv'>arg</span> <span class='o'>...</span> <span class='p'>)</span> <span class='nv'>=&gt;</span>
        <span class='p'>(</span><span class='nv'>call</span> <span class='ss'>&#39;mod</span> <span class='ss'>&#39;func</span> <span class='nv'>arg</span> <span class='o'>...</span> <span class='p'>)</span>
<span class='p'>(</span><span class='nv'>?</span> <span class='nv'>timeout</span> <span class='nv'>default</span> <span class='p'>)</span>

<span class='p'>(</span><span class='nv'>++</span> <span class='o'>...</span> <span class='p'>)</span>
<span class='p'>(</span><span class='nb'>list*</span> <span class='o'>...</span><span class='p'>)</span>
<span class='p'>(</span><span class='k'>let*</span> <span class='p'>(</span><span class='o'>...</span><span class='p'>)</span> <span class='o'>...</span> <span class='p'>)</span>
<span class='p'>(</span><span class='k'>flet</span> <span class='p'>((</span><span class='nv'>name</span> <span class='p'>(</span><span class='nv'>arg</span> <span class='o'>...</span><span class='p'>)</span> <span class='o'>...</span><span class='p'>)</span>
       <span class='o'>...</span><span class='p'>)</span>
  <span class='o'>...</span><span class='p'>)</span>
<span class='p'>(</span><span class='nv'>flet*</span> <span class='p'>(</span><span class='o'>...</span><span class='p'>)</span> <span class='o'>...</span> <span class='p'>)</span>
<span class='p'>(</span><span class='nv'>fletrec</span> <span class='p'>((</span><span class='nv'>name</span> <span class='p'>(</span><span class='nv'>arg</span> <span class='o'>...</span><span class='p'>)</span> <span class='o'>...</span><span class='p'>)</span>
          <span class='o'>...</span><span class='p'>)</span>
  <span class='o'>...</span><span class='p'>)</span>

<span class='p'>(</span><span class='nb'>cond</span> <span class='o'>...</span> <span class='p'>)</span>
<span class='p'>(</span><span class='nv'>andalso</span> <span class='o'>...</span> <span class='p'>)</span>
<span class='p'>(</span><span class='nv'>orelse</span> <span class='o'>...</span> <span class='p'>)</span>
<span class='p'>(</span><span class='nv'>fun</span> <span class='nv'>func</span> <span class='nv'>arity</span><span class='p'>)</span>
<span class='p'>(</span><span class='nv'>fun</span> <span class='nb'>mod</span> <span class='nv'>func</span> <span class='nv'>arity</span><span class='p'>)</span>
<span class='p'>(</span><span class='nv'>lc</span> <span class='p'>(</span><span class='nv'>qual</span> <span class='o'>...</span><span class='p'>)</span> <span class='o'>...</span><span class='p'>)</span>
<span class='p'>(</span><span class='nv'>bc</span> <span class='p'>(</span><span class='nv'>qual</span> <span class='o'>...</span><span class='p'>)</span> <span class='o'>...</span><span class='p'>)</span>
<span class='p'>(</span><span class='nv'>match-spec</span> <span class='o'>...</span><span class='p'>)</span>
</code></pre></div><a name='423_common_lisp_inspired_macros' />
<h3 id='423_common_lisp_inspired_macros'>4.2.3 Common Lisp Inspired Macros</h3>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>name</span> <span class='p'>(</span><span class='nv'>arg</span> <span class='o'>...</span><span class='p'>)</span> <span class='o'>...</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>name</span>
  <span class='p'>((</span><span class='nv'>argpat</span> <span class='o'>...</span><span class='p'>)</span> <span class='o'>...</span><span class='p'>)</span>
  <span class='o'>...</span><span class='p'>)</span>

<span class='p'>(</span><span class='nb'>defmacro</span> <span class='nv'>name</span> <span class='p'>(</span><span class='nv'>arg</span> <span class='o'>...</span><span class='p'>)</span> <span class='o'>...</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>defmacro</span> <span class='nv'>name</span> <span class='nv'>arg</span> <span class='o'>...</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>defmacro</span> <span class='nv'>name</span>
  <span class='p'>((</span><span class='nv'>argpat</span> <span class='o'>...</span><span class='p'>)</span> <span class='o'>...</span><span class='p'>)</span>
  <span class='o'>...</span><span class='p'>)</span>

<span class='p'>(</span><span class='nv'>defsyntax</span> <span class='nv'>name</span>
  <span class='p'>(</span><span class='nv'>pat</span> <span class='nb'>exp</span><span class='p'>)</span>
  <span class='o'>...</span><span class='p'>)</span>

<span class='p'>(</span><span class='k'>macrolet</span> <span class='p'>((</span><span class='nv'>name</span> <span class='p'>(</span><span class='nv'>arg</span> <span class='o'>...</span><span class='p'>)</span> <span class='o'>...</span><span class='p'>)</span>
           <span class='o'>...</span><span class='p'>)</span>
  <span class='o'>...</span><span class='p'>)</span>
<span class='p'>(</span><span class='nv'>syntaxlet</span> <span class='p'>((</span><span class='nv'>name</span> <span class='p'>(</span><span class='nv'>pat</span> <span class='nb'>exp</span><span class='p'>)</span> <span class='o'>...</span><span class='p'>)</span>
            <span class='o'>...</span><span class='p'>)</span>
  <span class='o'>...</span><span class='p'>)</span>

<span class='p'>(</span><span class='nv'>defmodule</span> <span class='nv'>name</span> <span class='o'>...</span><span class='p'>)</span>
<span class='p'>(</span><span class='nv'>defrecord</span> <span class='nv'>name</span> <span class='o'>...</span><span class='p'>)</span>
</code></pre></div><a name='424_scheme_inspired_macros' />
<h3 id='424_scheme_inspired_macros'>4.2.4 Scheme Inspired Macros</h3>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nv'>define</span> <span class='p'>(</span><span class='nv'>name</span> <span class='nv'>arg</span> <span class='o'>...</span><span class='p'>)</span> <span class='o'>...</span><span class='p'>)</span>
<span class='p'>(</span><span class='nv'>define</span> <span class='nv'>name</span> <span class='k'>lambda</span><span class='nv'>|match-lambda)</span>
<span class='nv'>(define-syntax name</span>
<span class='nv'>  (syntax-rules (pat exp) ...)|</span><span class='p'>(</span><span class='nv'>macro</span> <span class='p'>(</span><span class='nv'>pat</span> <span class='nv'>body</span><span class='p'>)</span> <span class='o'>...</span><span class='p'>))</span>
<span class='p'>(</span><span class='nv'>let-syntax</span> <span class='p'>((</span><span class='nv'>name</span> <span class='o'>...</span><span class='p'>)</span>
             <span class='o'>...</span><span class='p'>)</span>
  <span class='o'>...</span><span class='p'>)</span>
<span class='p'>(</span><span class='nv'>begin</span> <span class='o'>...</span><span class='p'>)</span>
<span class='p'>(</span><span class='nv'>define-module</span> <span class='nv'>name</span> <span class='o'>...</span><span class='p'>)</span>
<span class='p'>(</span><span class='nv'>define-record</span> <span class='nv'>name</span> <span class='o'>...</span><span class='p'>)</span>
</code></pre></div><a name='425_additional_lisp_functions' />
<h3 id='425_additional_lisp_functions'>4.2.5 Additional Lisp Functions</h3>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nv'>&lt;arith_op&gt;</span> <span class='nv'>expr</span> <span class='o'>...</span><span class='p'>)</span>
<span class='p'>(</span><span class='nv'>&lt;comp_op&gt;</span> <span class='nv'>expr</span> <span class='o'>...</span><span class='p'>)</span>
        <span class='nv'>The</span> <span class='nv'>standard</span> <span class='nv'>arithmentic</span> <span class='nv'>operators,</span> <span class='nb'>+</span> <span class='nb'>-</span> <span class='nb'>*</span> <span class='nv'>/,</span> <span class='nb'>and</span> <span class='nv'>comparison</span>
        <span class='nv'>operators,</span> <span class='nb'>&gt;</span> <span class='nb'>&gt;=</span> <span class='nb'>&lt;</span> <span class='nv'>=&lt;</span> <span class='nv'>==</span> <span class='nb'>/=</span> <span class='nv'>=:=</span> <span class='nv'>=/=</span> <span class='o'>,</span> <span class='nv'>can</span> <span class='nv'>take</span> <span class='nv'>multiple</span>
        <span class='nv'>arguments</span> <span class='k'>the</span> <span class='nv'>same</span> <span class='nv'>as</span> <span class='nv'>their</span> <span class='nv'>standard</span> <span class='nv'>lisp</span> <span class='nv'>counterparts.</span> <span class='nv'>This</span>
        <span class='nv'>is</span> <span class='nv'>still</span> <span class='nv'>experimental</span> <span class='nb'>and</span> <span class='nv'>implemented</span> <span class='nv'>using</span> <span class='nv'>macros.</span> <span class='nv'>They</span> <span class='nv'>do,</span>
        <span class='nv'>however,</span> <span class='nv'>behave</span> <span class='nv'>like</span> <span class='nv'>normal</span> <span class='nv'>functions</span> <span class='nb'>and</span> <span class='nv'>evaluate</span> <span class='nv'>ALL</span> <span class='nv'>their</span>
        <span class='nv'>arguments</span> <span class='nv'>before</span> <span class='nv'>doing</span> <span class='k'>the</span> <span class='nv'>arithmetic/comparisons</span> <span class='nv'>operations.</span>

<span class='p'>(</span><span class='nb'>acons</span> <span class='nv'>key</span> <span class='nv'>value</span> <span class='nb'>list</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>pairlis</span> <span class='nv'>keys</span> <span class='nb'>values</span> <span class='nb'>list</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>assoc</span> <span class='nv'>key</span> <span class='nb'>list</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>assoc-if</span> <span class='nv'>test</span> <span class='nb'>list</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>assoc-if-not</span> <span class='nv'>test</span> <span class='nb'>list</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>rassoc</span> <span class='nv'>value</span> <span class='nb'>list</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>rassoc-if</span> <span class='nv'>test</span> <span class='nb'>list</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>rassoc-if-not</span> <span class='nv'>test</span> <span class='nb'>list</span><span class='p'>)</span>
        <span class='nv'>The</span> <span class='nv'>standard</span> <span class='nv'>association</span> <span class='nb'>list</span> <span class='nv'>functions.</span>

<span class='p'>(</span><span class='nb'>subst</span> <span class='nv'>new</span> <span class='nv'>old</span> <span class='nv'>tree</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>subst-if</span> <span class='nv'>new</span> <span class='nv'>test</span> <span class='nv'>tree</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>subst-if-not</span> <span class='nv'>new</span> <span class='nv'>test</span> <span class='nv'>tree</span><span class='p'>)</span>
<span class='p'>(</span><span class='nb'>sublis</span> <span class='nv'>alist</span> <span class='nv'>tree</span><span class='p'>)</span>
        <span class='nv'>The</span> <span class='nv'>standard</span> <span class='nv'>substituition</span> <span class='nv'>functions.</span>

<span class='p'>(</span><span class='nb'>macroexpand-1</span> <span class='nv'>expr</span> <span class='nv'>environment</span><span class='p'>)</span>
        <span class='nv'>If</span> <span class='nv'>Expr</span> <span class='nv'>is</span> <span class='nv'>a</span> <span class='nv'>macro</span> <span class='nv'>call,</span> <span class='nv'>does</span> <span class='nv'>one</span> <span class='nb'>round</span> <span class='nv'>of</span> <span class='nv'>expansion,</span>
        <span class='nv'>otherwise</span> <span class='nv'>returns</span> <span class='nv'>Expr.</span>

<span class='p'>(</span><span class='nb'>macroexpand</span> <span class='nv'>expr</span> <span class='nv'>environment</span><span class='p'>)</span>
        <span class='nv'>Returns</span> <span class='k'>the</span> <span class='nv'>expansion</span> <span class='nv'>returned</span> <span class='nv'>by</span> <span class='nv'>calling</span> <span class='nb'>macroexpand-1</span>
        <span class='nv'>repeatedly,</span> <span class='nv'>starting</span> <span class='nv'>with</span> <span class='nv'>Expr,</span> <span class='nv'>until</span> <span class='k'>the</span> <span class='nv'>result</span> <span class='nv'>is</span> <span class='nv'>no</span> <span class='nv'>longer</span>
        <span class='nv'>a</span> <span class='nv'>macro</span> <span class='nv'>call.</span>

<span class='p'>(</span><span class='nv'>macroexpand-all</span> <span class='nv'>expr</span> <span class='nv'>environment</span><span class='p'>)</span>
        <span class='nv'>Returns</span> <span class='k'>the</span> <span class='nv'>expansion</span> <span class='nv'>from</span> <span class='k'>the</span> <span class='nv'>expression</span> <span class='nv'>where</span> <span class='nv'>all</span> <span class='nv'>macro</span>
        <span class='nv'>calls</span> <span class='nv'>have</span> <span class='nv'>been</span> <span class='nv'>expanded</span> <span class='nv'>with</span> <span class='nv'>macroexpand.</span>

        <span class='nv'>NOTE</span> <span class='nv'>that</span> <span class='nb'>when</span> <span class='nv'>no</span> <span class='nv'>explicit</span> <span class='nv'>environment</span> <span class='nv'>is</span> <span class='nv'>given</span> <span class='k'>the</span>
        <span class='nb'>macroexpand</span> <span class='nv'>functions</span> <span class='nv'>then</span> <span class='nv'>only</span> <span class='k'>the</span> <span class='nv'>default</span> <span class='nv'>built-in</span> <span class='nv'>macros</span>
        <span class='nv'>will</span> <span class='nv'>be</span> <span class='nv'>expanded.</span> <span class='nv'>Inside</span> <span class='nv'>macros</span> <span class='nb'>and</span> <span class='nv'>in</span> <span class='k'>the</span> <span class='nv'>shell</span> <span class='k'>the</span> <span class='nv'>variable</span>
        <span class='nv'>$ENV</span> <span class='nv'>is</span> <span class='nv'>bound</span> <span class='nv'>to</span> <span class='k'>the</span> <span class='nv'>current</span> <span class='nv'>macro</span> <span class='nv'>environment.</span>

<span class='p'>(</span><span class='nb'>eval</span> <span class='nv'>expr</span> <span class='nv'>environment</span><span class='p'>)</span>
        <span class='nv'>Evaluate</span> <span class='k'>the</span> <span class='nv'>expression</span> <span class='nv'>expr.</span> <span class='nv'>Note</span> <span class='nv'>that</span> <span class='nv'>only</span> <span class='k'>the</span> <span class='nv'>pre-defined</span>
        <span class='nv'>lisp</span> <span class='nv'>functions,</span> <span class='nv'>erlang</span> <span class='nv'>BIFs</span> <span class='nb'>and</span> <span class='nv'>exported</span> <span class='nv'>functions</span> <span class='nv'>can</span> <span class='nv'>be</span>
        <span class='nv'>called.</span> <span class='nv'>Also</span> <span class='nv'>no</span> <span class='nv'>local</span> <span class='nv'>variables</span> <span class='nv'>can</span> <span class='nv'>be</span> <span class='nv'>accessed.</span> <span class='nv'>To</span> <span class='nv'>access</span>
        <span class='nv'>local</span> <span class='nv'>variables</span> <span class='k'>the</span> <span class='nv'>expr</span> <span class='nv'>to</span> <span class='nv'>be</span> <span class='nv'>evaluated</span> <span class='nv'>can</span> <span class='nv'>be</span> <span class='nv'>wrapped</span> <span class='nv'>in</span> <span class='nv'>a</span>
        <span class='k'>let</span> <span class='nv'>defining</span> <span class='nv'>these.</span>

        <span class='nv'>For</span> <span class='nv'>example</span> <span class='k'>if</span> <span class='k'>the</span> <span class='nv'>data</span> <span class='nv'>we</span> <span class='nv'>wish</span> <span class='nv'>to</span> <span class='nv'>evaluate</span> <span class='nv'>is</span> <span class='nv'>in</span> <span class='k'>the</span> <span class='nv'>variable</span>
        <span class='nv'>expr</span> <span class='nb'>and</span> <span class='nv'>it</span> <span class='nv'>assumes</span> <span class='nv'>there</span> <span class='nv'>is</span> <span class='nv'>a</span> <span class='nv'>local</span> <span class='nv'>variable</span> <span class='s'>&quot;foo&quot;</span> <span class='nv'>which</span> <span class='nv'>it</span>
        <span class='nv'>needs</span> <span class='nv'>to</span> <span class='nv'>access</span> <span class='nv'>then</span> <span class='nv'>we</span> <span class='nv'>could</span> <span class='nv'>evaluate</span> <span class='nv'>it</span> <span class='nv'>by</span> <span class='nv'>calling:</span>

        <span class='p'>(</span><span class='nb'>eval</span> <span class='o'>`</span><span class='p'>(</span><span class='k'>let</span> <span class='p'>((</span><span class='nv'>foo</span> <span class='o'>,</span><span class='nv'>foo</span><span class='p'>))</span> <span class='o'>,</span><span class='nv'>expr</span><span class='p'>))</span>
</code></pre></div><a name='43_modules' />
<h2 id='43_modules'>4.3 Modules</h2>
<a name='431_what_modules_do' />
<h3 id='431_what_modules_do'>4.3.1 What Modules Do</h3>
<a name='432_what_modules_dont_do' />
<h3 id='432_what_modules_dont_do'>4.3.2 What Modules Don&#8217;t Do</h3>
<a name='433_creating_a_module' />
<h3 id='433_creating_a_module'>4.3.3 Creating a Module</h3>
<a name='434_parameterized_modules' />
<h3 id='434_parameterized_modules'>4.3.4 Parameterized Modules</h3>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nv'>defmodule</span> <span class='p'>(</span><span class='nv'>zaphod-rest-api</span> <span class='nv'>request</span><span class='p'>)</span>
  <span class='p'>(</span><span class='nb'>export</span> <span class='p'>(</span><span class='nv'>get-greeting</span> <span class='mi'>2</span><span class='p'>)))</span>

<span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>get-greeting</span>
  <span class='p'>((</span><span class='ss'>&#39;GET</span> <span class='p'>())</span>
   <span class='p'>(</span><span class='nv'>tuple</span> <span class='ss'>&#39;output</span> <span class='o'>&#39;</span><span class='s'>&quot;Zaphod says &#39;hello!&#39;&quot;</span><span class='p'>))</span>
  <span class='p'>((</span><span class='ss'>&#39;GET</span> <span class='nv'>_</span><span class='p'>)</span>
   <span class='p'>(</span><span class='nv'>tuple</span> <span class='ss'>&#39;output</span> <span class='o'>&#39;</span><span class='s'>&quot;Zaphod says &#39;hello&#39; to anything...&quot;</span><span class='p'>)))</span>
</code></pre></div><div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>set</span> <span class='nv'>req</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>zaphod-rest-api</span> <span class='nv'>new</span> <span class='o'>&#39;</span><span class='s'>&quot;a request&quot;</span><span class='p'>))</span>
<span class='o'>#(</span><span class='nv'>zaphod-rest-api</span> <span class='s'>&quot;a request&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>call</span> <span class='nv'>req</span> <span class='ss'>&#39;get-greeting</span> <span class='ss'>&#39;GET</span> <span class='p'>())</span>
<span class='o'>#(</span><span class='nv'>output</span> <span class='s'>&quot;Zaphod says &#39;hello!&#39;&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>call</span> <span class='nv'>req</span> <span class='ss'>&#39;get-greeting</span> <span class='ss'>&#39;GET</span> <span class='o'>&#39;</span><span class='s'>&quot;stuff&quot;</span><span class='p'>)</span>
<span class='o'>#(</span><span class='nv'>output</span> <span class='s'>&quot;Zaphod says &#39;hello&#39; to anything...&quot;</span><span class='p'>)</span>
<span class='nb'>&gt;</span>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><a name='44_projects_with_rebar' />
<h2 id='44_projects_with_rebar'>4.4 Projects with Rebar</h2>

<p>In this section we&#8217;ll be exploring how rebar can be used to manage LFE projects.</p>

<p>This section will make use of two example projects on github:</p>

<ul>
<li />

<li />
</ul>
<a name='441_collections_of_modules' />
<h3 id='441_collections_of_modules'>4.4.1 Collections of Modules</h3>

<p>The first question we should probably address is this: How are we defining a project?</p>

<p>An LFE project is a set of modules developed and distributed to accomplish a particular goal. The project should have a rebar configuration file, a source directory with <code>.lfe</code> files in it, possibly an include directory, andn ideally unit tests in a <code>test</code> directory.</p>
<a name='442_project_structure' />
<h3 id='442_project_structure'>4.4.2 Project Structure</h3>

<p>Let&#8217;s expand upon the project definition given above, focusing on the directory structure of a prototypical project and some of the files one might find in an LFE project.</p>
<div class='highlight'><pre><code class='text'>├── ebin
│   └── libexample.app
├── src
│   └── libexample.lfe
├── Makefile
├── README.md
└── rebar.config
</code></pre></div>
<p>This is from a sample project whose purpose is to provide a library for use by other LFE (or Erlang!) projects. More on that below.</p>

<p>Rebar supports LFE files. All that it needs is the standard <code>rebar.config</code> and an <code>.app</code> file in the <code>ebin</code> directory. With these, Rebar will be able to download the project dependencies and compile the <code>*.lfe</code> files in <code>src</code> to the <code>ebin</code> directory as <code>*.beam</code> files.</p>
<a name='443_dependencies' />
<h3 id='443_dependencies'>4.4.3 Dependencies</h3>

<p>Dependencies are handled very nicely with Rebar: just add a git repo in your <code>rebar.config</code> file like so:</p>
<div class='highlight'><pre><code class='erlang'><span class='p'>{</span><span class='n'>deps</span><span class='p'>,</span> <span class='p'>[</span>
    <span class='p'>{</span><span class='n'>lfe</span><span class='p'>,</span> <span class='s'>&quot;.*&quot;</span><span class='p'>,</span> <span class='p'>{</span><span class='n'>git</span><span class='p'>,</span> <span class='s'>&quot;git://github.com/rvirding/lfe.git&quot;</span><span class='p'>,</span> <span class='s'>&quot;develop&quot;</span><span class='p'>}}</span>
  <span class='p'>]}.</span>
</code></pre></div>
<p>Any dependencies listed here will be downloaded with the <code>rebar get-deps</code> command. Once downloaded, issuing the <code>rebar compile</code> command will not only compile your project&#8217;s <code>src/*</code> files into its <code>ebin</code> directory, but will compile all dependency project source code as well.</p>
<a name='444_defining_a_library_project' />
<h3 id='444_defining_a_library_project'>4.4.4 Defining a Library Project</h3>

<p>We&#8217;ve seen the directory structure above for a library project. We&#8217;re defining a &#8220;library&#8221; project as one that doesn&#8217;t start up any services as part of its basic operations. Instead, it provides code that other projects make use of.</p>

<p>In particular, in a library project, you do not need to define <code>mod</code> in your <code>ebin/libname.app</code> file. Similarly, in your <code>src</code> directory, you do not need to create application nor supervisor files.</p>

<p>We&#8217;re making a rather arbitrary distinction here (between &#8220;library&#8221; projects and &#8220;service&#8221; projects, and one with undoubtedly many blurry lines. Regardless, it may be instructive or useful as a guideline.</p>
<a name='445_defining_a_service_project' />
<h3 id='445_defining_a_service_project'>4.4.5 Defining a Service Project</h3>
<a name='446_distributing_a_project' />
<h3 id='446_distributing_a_project'>4.4.6 Distributing A Project</h3>
<a name='447_installing_projects' />
<h3 id='447_installing_projects'>4.4.7 Installing Projects</h3>
<a name='5_recursion' />
<h1 id='5_recursion'>5 Recursion</h1>
<a name='51_see_section_5' />
<h2 id='51_see_section_5'>5.1 See Section 5</h2>

<p>Sorry, couldn&#8217;t resist.</p>
<a name='52_a_brief_history' />
<h2 id='52_a_brief_history'>5.2 A Brief History</h2>

<p>In functional languages, recursion plays an important role. For Erlang in particular, recursion is important because variables can&#8217;t be changed. It is therefor often very useful to take advantage of recursion in order to work with changing values (examples are given in the latter half of this chapter).</p>

<p>However, recursion is interesting in and of itself. The roots of functional programming languages such as Lisp, ML, Erlang, Haskell and others, can be traced to the concept of recursion in general and the λ-calculus in particular.</p>

<p>The Italian mathematician Giuseppe Peano seems to have been one of the first to have made prominent use of recursion when defining his axioms for the natural numbers. Furthermore, Peano gave Bertrand Russell a copy of his &#8220;Formulario&#8221; (in fact, he gave Russell <em>all</em> of his published works!). This impacted Russell hugely and quite possibly influenced his work on the &#8220;Principia Mathematica&#8221; which he coauthored several years later.</p>

<p>It was from the Principia that Alonzo Church derived his lambda notation. When Church&#8217;s student, John McCarthy, created Lisp, he used both the lambda notation and the related concept of recursion in his new language. (Interestingly enough, McCarthy and Dijkstra both advocated for the inclusions of recursion in ALGOL.) From John McCarthy&#8217;s work onward, the lambda and recursion have been our constant companions.</p>
<a name='53_a_preview' />
<h2 id='53_a_preview'>5.3 A Preview</h2>

<p>In the sections of the user guide, we explore various aspects of recursion as they can be formulated in Lisp Flavored Erlang. We will cover the following:</p>

<ul>
<li>The Dedekind-Peano Axioms</li>

<li>Primitive Recursive Functions</li>

<li>Total Recursive Functions</li>

<li>The λ-Calculus</li>

<li>Practical Examples in Computing</li>

<li>Tail-Calls</li>
</ul>

<p>If you just want to jump to the practical examples, please do so! You should feel no guilt when enjoying LFE or reading about LFE :-) The other sections are provided simply because it is very rare to find a practical coverage of the foundations of recursion and the λ-Calculus. There may be readers out there who want to know this reasons and history behind the concepts studied; most of this chapter is for them.</p>
<a name='54_the_dedekind-peano_axioms' />
<h2 id='54_the_dedekindpeano_axioms'>5.4 The Dedekind-Peano Axioms</h2>

<p>For those that are math-averse, don&#8217;t let this frighten you &#8211; this will be a peaceful journey that should not leave you bewildered. Rather, it will provide some nice background for how recursion came to be used. With the history reviewed, we&#8217;ll make our way into practical implementations.</p>
<a name='541_foundations' />
<h3 id='541_foundations'>5.4.1 Foundations</h3>

<p>Despite the fluorescence of maths in the 17th and 18th centuries and the growing impact of number theory, the ground upon which mathematics were built was shaky at best. Indeed, what we now consider to be the foundations of mathematics had not even been agreed upon (and this didn&#8217;t happen until the first half of the 20th century with the maturation of logic and rise of axiomatic set theory).</p>

<p>One of the big problems facing mathematicians and one that also prevented the clarification of the foundations, was this: a thorough, precise, and consistent definition of the natural numbers as well as operations that could be performed on them (e.g., addition, multiplication, etc.). There was a long-accepted intuitive understanding, however, this was insufficient for complete mathematical rigor.</p>

<p>Richard Dedekind addressed this with his method of cuts, but it was Giuseppe Peano that supplied us with the clearest, most easily described axioms defining the natural numbers and arithmetic, wherein he made effective use of recursion. His definitions can be easily found in text books and on the Internet; we will take a slightly unique approach, however, and cast them in terms of LFE.</p>
<a name='542_a_constant_and_equality' />
<h3 id='542_a_constant_and_equality'>5.4.2 A Constant and Equality</h3>

<p>The first five Peano axioms deal with the constant (often written as &#8220;0&#8221;) and the reflexive, symmetric, transitive and closed equality relations. These don&#8217;t relate recursion directly, so we&#8217;re going to skip them ;-)</p>
<a name='543_successor_function' />
<h3 id='543_successor_function'>5.4.3 Successor Function</h3>

<p>The concept of the &#8220;successor&#8221; in the Peano axioms is a primitive; it is taken as being true without having been proved. It is informally defined as being the next number following a given number &#8220;n&#8221;.</p>

<p>In LFE:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>successor</span> <span class='p'>(</span><span class='nv'>n</span><span class='p'>)</span>
  <span class='p'>(</span><span class='nb'>+</span> <span class='nv'>n</span> <span class='mi'>1</span><span class='p'>))</span>
</code></pre></div>
<p>The things to keep in mind here are that 1) we haven&#8217;t defined addition yet, and 2) you must not interpret &#8221;+&#8221; as addition in this context, rather as the operator that allows for succession to occur. In the world of the Peano axioms, &#8221;+&#8221; is only validly used with &#8220;n&#8221; and &#8220;1&#8221;.</p>

<p>This function is defined as being &#8220;basic primitive recursive&#8221;. The basic primitive recursives are defined by axioms; the term was coined by Rózsa Péter.</p>
<a name='544_the_remaining_axioms' />
<h3 id='544_the_remaining_axioms'>5.4.4 The Remaining Axioms</h3>

<p>The remaining three Peano axioms do not touch upon recursion directly, so we leave them to your own research and reading pleasure.</p>
<a name='55_primitive_recursive_functions' />
<h2 id='55_primitive_recursive_functions'>5.5 Primitive Recursive Functions</h2>

<p>In the previous section, we leaned about the primitive recursive function called the &#8220;successor&#8221;, one that was used by Peano in his axioms. There are other primitive recursive functions as well, and these are usually given as axioms (i.e., without proof):</p>

<ul>
<li>the &#8220;zero function&#8221;</li>

<li>the &#8220;projection function&#8221;</li>

<li>&#8220;identity function&#8221;</li>
</ul>

<p>These combined with the Peano axioms allow us to define other primitive recursive functions.</p>
<a name='551_addition' />
<h3 id='551_addition'>5.5.1 Addition</h3>

<p>In the literature, the definition for Peano addition is done in the following manner:</p>

<pre><code>a + 0 = a,
a + S(b) = S(a + b)</code></pre>

<p>where <code>S</code> is the successor function defined in the previous section.</p>

<p>First we have an identity function: any number that has zero added to it yields the result of the number itself.</p>

<p>Secondly, a number, when added with the successor of another number is equal to the successor of the two numbers combined. Let&#8217;s take a look at an example:</p>

<ul>
<li>The number 0, when applied to the successor function yields 1 (<code>S(0) = 1</code>)</li>

<li>Therefore, <code>a + S(0) = a + 1</code></li>

<li>By Peano&#8217;s definition of addition then, we have <code>a + 1 = S(a + 0)</code></li>

<li>Which then gives <code>a + 1 = S(a)</code></li>
</ul>

<p>In other words, the successor of <code>a</code> is <code>a + 1</code>.</p>

<p>These rules for addition are sometimes given in the following pseudo code:</p>

<pre><code>add(0, x) = x
add(succ(n), x) = succ(add(n, x))</code></pre>

<p>In LFE, we&#8217;d like to maintain symmetry with this. We could try to construct a function that had both definitions as pattern arguments, thus alleviating the need for two function definitions. However, to perfectly map the pseudo code to LFE, we&#8217;d have to put a function call in our pattern&#8230; and that&#8217;s not possible.</p>

<p>If, though, we do a little algebraic juggling, we can work around this. In our pseudo code we have two parameters: <code>succ(n)</code> and <code>x</code>. If we apply a &#8220;predecessor&#8221; function to <code>succ(n)</code>, we&#8217;ll just have <code>n</code> &#8211; which would do nicely for a matched function argument in LFE. But we&#8217;ll also need to apply this predecessor function to the <code>n</code> on the other side of the equation.</p>

<p>Let&#8217;s create such a &#8220;predecessor&#8221; function:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>predecessor</span>
  <span class='p'>((</span><span class='mi'>0</span><span class='p'>)</span> <span class='mi'>0</span><span class='p'>)</span>
  <span class='p'>((</span><span class='nv'>n</span><span class='p'>)</span> <span class='p'>(</span><span class='nb'>-</span> <span class='nv'>n</span> <span class='mi'>1</span><span class='p'>)))</span>
</code></pre></div>
<p>Now, we can recast the canonical form above using the workaround of the <code>predecessor</code> primitive recursive function, allowing us to use one function to define Peano&#8217;s addition axiom:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>add</span>
  <span class='p'>((</span><span class='mi'>0</span> <span class='nv'>x</span><span class='p'>)</span> <span class='nv'>x</span><span class='p'>)</span>
  <span class='p'>((</span><span class='nv'>n</span> <span class='nv'>x</span><span class='p'>)</span> <span class='p'>(</span><span class='nv'>successor</span> <span class='p'>(</span><span class='nv'>add</span> <span class='p'>(</span><span class='nv'>predecessor</span> <span class='nv'>n</span><span class='p'>)</span> <span class='nv'>x</span><span class='p'>))))</span>
</code></pre></div>
<p>All of this may seem rather absurd, given what we do in every-day programming. Remember, though: the verbosity of these axioms and their derived definitions serves to explicitly show that no assumptions are being made. With a foundation of no assumption, we can be certain that each brick we lay on top of this sound (if possibly baroque) basis will be unshakable (baring the random proof by Gödel, of course).</p>
<a name='552_subtraction' />
<h3 id='552_subtraction'>5.5.2 Subtraction</h3>

<p>Next up, let&#8217;s take a look at subtraction:</p>

<pre><code>sub(0, x) = x
sub(pred(n), x) = pred(sub(n, x))</code></pre>

<p>Similar to addition above, we make some adjustments for the convenience of pattern matching:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>subtract</span>
  <span class='p'>((</span><span class='mi'>0</span> <span class='nv'>x</span><span class='p'>)</span> <span class='nv'>x</span><span class='p'>)</span>
  <span class='p'>((</span><span class='nv'>n</span> <span class='nv'>x</span><span class='p'>)</span> <span class='p'>(</span><span class='nv'>predecessor</span> <span class='p'>(</span><span class='nv'>subtract</span> <span class='p'>(</span><span class='nv'>predecessor</span> <span class='nv'>n</span><span class='p'>)</span> <span class='nv'>x</span><span class='p'>))))</span>
</code></pre></div>
<p>Due to the manner in which we have defined our functions, the usual usage is reversed for our <code>subtract</code> function. The first operand is not the number that is being subtracted from, but rather the number that is being <em>subtracted</em>.</p>

<p>We can see this in action if we put our definitions in a file called <code>prf.lfe</code> (named for &#8220;primitive recursive functions&#8221;) and <code>slurp</code> it in the LFE REPL:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>slurp</span> <span class='o'>&#39;</span><span class='s'>&quot;prf.lfe&quot;</span><span class='p'>)</span>
<span class='o'>#(</span><span class='nv'>ok</span> <span class='nv'>prf</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>subtract</span> <span class='mi'>1</span> <span class='mi'>100</span><span class='p'>)</span>
<span class='mi'>99</span>
<span class='nb'>&gt;</span>
</code></pre></div><a name='553_multiplication' />
<h3 id='553_multiplication'>5.5.3 Multiplication</h3>

<p>The last one of these that we will look at is multiplication, and then we&#8217;ll move on to something a little more complicated :-)</p>

<pre><code>mult(0, x) = 0
mult(succ(n), x) = x + (x * n)</code></pre>

<p>Again, using our pattern workaround:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>multiply</span>
  <span class='p'>((</span><span class='mi'>0</span> <span class='nv'>x</span><span class='p'>)</span> <span class='mi'>0</span><span class='p'>)</span>
  <span class='p'>((</span><span class='nv'>n</span> <span class='nv'>x</span><span class='p'>)</span> <span class='p'>(</span><span class='nv'>add</span> <span class='nv'>x</span> <span class='p'>(</span><span class='nv'>multiply</span> <span class='nv'>x</span> <span class='p'>(</span><span class='nv'>predecessor</span> <span class='nv'>n</span><span class='p'>)))))</span>
</code></pre></div><a name='56_partial_recursive_functions' />
<h2 id='56_partial_recursive_functions'>5.6 Partial Recursive Functions</h2>

<p>We&#8217;ve covered primitive recursive functions in the previous section; now we&#8217;ll take a brief look at what are called &#8220;partial recursive functions&#8221;. These are functions that provide an output for given input but which may not be defined for <em>every</em> possible input.</p>

<p>Partial recursive functions are also referred to as &#8220;computable functions&#8221; and can be defined using Turing machines or the λ-calculus (among others). In fact, an equivalent definition of partial recursive function is actually a function that can be computed by a Turing machine.</p>
<a name='57_total_recursive_functions' />
<h2 id='57_total_recursive_functions'>5.7 Total Recursive Functions</h2>

<p>As opposed to a partial recursive function, a <em>total</em> recursive function is one that is defined for all possible function inputs. Every primitive recursive function is total recursive. There are, however, total recursive functions that are <em>not</em> primitive recursive. The Ackermann function is one such.</p>
<a name='571_the_ackermann_function' />
<h3 id='571_the_ackermann_function'>5.7.1 The Ackermann Function</h3>

<p>The Ackermann function is one of the simplest and earliest-discovered examples of a total recursive function that is not primitive recursive. The variant of the function that we present below is the two-variable version developed by Rózsa Péter and Raphael Robinson (the original was more verbose and with three variables).</p>

<p>Here is the function in LFE</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>ackermann</span>
  <span class='p'>((</span><span class='mi'>0</span> <span class='nv'>n</span><span class='p'>)</span> <span class='p'>(</span><span class='nb'>+</span> <span class='nv'>n</span> <span class='mi'>1</span><span class='p'>))</span>
  <span class='p'>((</span><span class='nv'>m</span> <span class='mi'>0</span><span class='p'>)</span> <span class='p'>(</span><span class='nv'>ackermann</span> <span class='p'>(</span><span class='nb'>-</span> <span class='nv'>m</span> <span class='mi'>1</span><span class='p'>)</span> <span class='mi'>1</span><span class='p'>))</span>
  <span class='p'>((</span><span class='nv'>m</span> <span class='nv'>n</span><span class='p'>)</span> <span class='p'>(</span><span class='nv'>ackermann</span> <span class='p'>(</span><span class='nb'>-</span> <span class='nv'>m</span> <span class='mi'>1</span><span class='p'>)</span> <span class='p'>(</span><span class='nv'>ackermann</span> <span class='nv'>m</span> <span class='p'>(</span><span class='nb'>-</span> <span class='nv'>n</span> <span class='mi'>1</span><span class='p'>)))))</span>
</code></pre></div>
<p>As we can see, this function quite clearly calls itself ;-)</p>

<p>Here&#8217;s some example usage:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>c</span> <span class='o'>&#39;</span><span class='s'>&quot;prf&quot;</span><span class='p'>)</span>
<span class='o'>#(</span><span class='nv'>module</span> <span class='nv'>prf</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>prf</span> <span class='nv'>ackermann</span> <span class='mi'>0</span> <span class='mi'>0</span><span class='p'>)</span>
<span class='mi'>1</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>prf</span> <span class='nv'>ackermann</span> <span class='mi'>0</span> <span class='mi'>1</span><span class='p'>)</span>
<span class='mi'>2</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>prf</span> <span class='nv'>ackermann</span> <span class='mi'>1</span> <span class='mi'>0</span><span class='p'>)</span>
<span class='mi'>2</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>prf</span> <span class='nv'>ackermann</span> <span class='mi'>1</span> <span class='mi'>1</span><span class='p'>)</span>
<span class='mi'>3</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>prf</span> <span class='nv'>ackermann</span> <span class='mi'>1</span> <span class='mi'>2</span><span class='p'>)</span>
<span class='mi'>4</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>prf</span> <span class='nv'>ackermann</span> <span class='mi'>2</span> <span class='mi'>2</span><span class='p'>)</span>
<span class='mi'>7</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>prf</span> <span class='nv'>ackermann</span> <span class='mi'>2</span> <span class='mi'>4</span><span class='p'>)</span>
<span class='mi'>11</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='err'>:</span> <span class='nv'>prf</span> <span class='nv'>ackermann</span> <span class='mi'>4</span> <span class='mi'>1</span><span class='p'>)</span>
<span class='mi'>65533</span>
<span class='nb'>&gt;</span>
</code></pre></div><a name='58_the_λ-calculus' />
<h2 id='58_the_calculus'>5.8 The λ-Calculus</h2>

<p>Oh, yeah. We just went there: the λ-calculus.</p>

<p>Take heart, though&#8230; this is going to be fun. And after this bit, we&#8217;ll finally get to the practical coding bits :-)</p>

<p>Keep in mind that the Peano axioms made use of recursion, that Giuseppe Peano played a key role in Bertrand Russell&#8217;s development of the Principia, that Alonzo Church sought to make improvements on the Principia, and the lambda calculus eventually arose from these efforts.</p>

<p>Church realized when creating the λ-calculus that with only a lambda at his disposal, he could define numbers and perform arithmetic upon them. This is known as &#8220;Church encoding&#8221;. Using what we have defined above, we should be able to peer into this forest of lambdas and perhaps perceive some trees.</p>

<p>Church, with his now-famous students Stephen Kleene and J. Barkley Rosser, established the λ-calculus as equivalent to a Turing machine for determining the computability of a given function. In particular, the Church-Turing Thesis states that the class of functions which are partial recursive functions has the same members as the class of functions which are computable functions.</p>

<p>Previously, we examined natural numbers and operations such as addition in the context of positive integers. However, in the sections below, we will be leaving behind the comfort of the familiar. The λ-calculus does not concern itself with natural numbers per se; rather the ability to do something a given number of times.</p>
<a name='581_a_quick_primer' />
<h3 id='581_a_quick_primer'>5.8.1 A Quick Primer</h3>

<p>In the literature, you will see such things as:</p>

<pre><code>λx.x</code></pre>

<p>or</p>

<pre><code>(λx.x)y</code></pre>

<p>or</p>

<pre><code>(λwyx.y(wyx))(λsz.z)</code></pre>

<p>This is standard notation for the λ-calculus, and here&#8217;s how you read it:</p>

<ul>
<li>an expression can be a name, a function, or an application, e.g.: <code>x</code> or <code>λx.x</code> or <code>(λx.x)3</code></li>

<li>a function is represented by a lambda followed by a name, a dot, and an expression, e.g.: <code>λx.x</code></li>

<li>an application is represented as two expressions right next to each other, e.g.: <code>(λx.x)3</code></li>
</ul>

<p>As such, one says that <code>λx.x</code> is a function that takes one parameter, <code>x</code>, and produces one output, <code>x</code>. <code>λxy.y</code> takes two parameters, <code>x</code> and <code>y</code> and produces one output, <code>y</code>.</p>
<a name='582_church_encoding' />
<h3 id='582_church_encoding'>5.8.2 Church Encoding</h3>

<p>Let&#8217;s get our feet wet with figuring out how we can define the natural numbers under Church encoding, starting with <code>zero</code>. In the standard λ-calculus, this is done in the following manner:</p>

<pre><code>λs.λx.x</code></pre>

<p>We are defining the successor function from above as <code>s</code>. We are also defining <code>x</code> as &#8220;that which represents zero&#8221;. So this reads something like &#8220;We pass our counting function represented as <code>s</code> as the first parameter; there&#8217;s nothing to do but then pass the second parameter <code>x</code> to the next function, which returns <code>x</code>&#8221;. We never do anything with <code>s</code> and only return <code>x</code> itself.</p>

<p>In the λ-calculus, zero is defined as taking the successor function, doing nothing with it, and returning the value for zero from the identify function. In LFE, this is simple:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>zero</span> <span class='p'>()</span>
  <span class='p'>(</span><span class='k'>lambda</span> <span class='p'>(</span><span class='nv'>s</span><span class='p'>)</span>
    <span class='p'>(</span><span class='k'>lambda</span> <span class='p'>(</span><span class='nv'>x</span><span class='p'>)</span> <span class='nv'>x</span><span class='p'>)))</span>
</code></pre></div>
<p>We&#8217;ve got some nested functions that represent &#8220;zero&#8221;; now what? Well, we didn&#8217;t use the successor inside the zero function, if we <em>do</em>, we should get &#8220;one&#8221;, yes? But how? Well, we&#8217;ll &#8220;apply&#8221; the successor function that is passed in, as opposed to ignoring it like we did in <code>zero</code>. Here&#8217;s the Church numeral definition for <code>one</code>:</p>

<pre><code>λs.λx.s x</code></pre>

<p>Let&#8217;s try that in LFE:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>one</span> <span class='p'>()</span>
  <span class='p'>(</span><span class='k'>lambda</span> <span class='p'>(</span><span class='nv'>s</span><span class='p'>)</span>
    <span class='p'>(</span><span class='k'>lambda</span> <span class='p'>(</span><span class='nv'>x</span><span class='p'>)</span>
      <span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>s</span> <span class='nv'>x</span><span class='p'>))))</span>
</code></pre></div>
<p>Congratulations, you&#8217;ve written your second Church numeral in LFE now :-) Successive numbers are very similar: an additional <code>(funcall s</code> before the <code>(funcall s x</code>.</p>

<p>A small but significant caveat: technically speaking, the functions <code>zero</code> and <code>one</code> are not actual Church numerals, rather they wrap the Church numberals. Once you call these functions, you will have the Church numberals themselves (the lambda that is returned when the numberal functions are called).</p>

<p>Now that we see Church numerals are nested <code>lambda</code>s with nested calls on the successor function, we want to peek inside. How does one convert a Church numeral to, say, an interger representation? Looking at the <code>one</code> function, we can make an educated guess:</p>

<ol>
<li>We will need to call <code>one</code> so that the top-most lambda is &#8220;exposed&#8221;.</li>

<li>We will need to apply (<code>funcall</code>; it&#8217;s more convenient) our choice of successor function to that top-most lambda.</li>

<li>We will need to apply our representation of &#8220;zero&#8221; to the next lambda.</li>
</ol>

<p>With each of those done we end up with a solution that&#8217;s actually quite general and can be used on any of our Church numerals. Here&#8217;s a practical demonstration:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>slurp</span> <span class='o'>&#39;</span><span class='s'>&quot;church.lfe&quot;</span><span class='p'>)</span>
<span class='o'>#(</span><span class='nv'>ok</span> <span class='nv'>church</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>one</span><span class='p'>)</span>
<span class='err'>#</span><span class='nv'>Fun&lt;lfe_eval.10.53503600&gt;</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nb'>funcall</span> <span class='p'>(</span><span class='nb'>funcall</span> <span class='p'>(</span><span class='nv'>one</span><span class='p'>)</span> <span class='nf'>#&#39;</span><span class='nv'>successor/1</span><span class='p'>)</span> <span class='mi'>0</span><span class='p'>)</span>
<span class='mi'>1</span>
</code></pre></div>
<p>Typing that into the REPL whenever we want to check our Church numeral will be tedious. Let&#8217;s write a function that allows us to get the integer representation of a Church numeral more easily. There are a couple ways to do this. First:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>church-&gt;int1</span> <span class='p'>(</span><span class='nv'>church-numeral</span><span class='p'>)</span>
  <span class='p'>(</span><span class='nb'>funcall</span> <span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>church-numeral</span> <span class='nf'>#&#39;</span><span class='nv'>successor/1</span><span class='p'>)</span> <span class='mi'>0</span><span class='p'>))</span>
</code></pre></div>
<p>This would require that we call our Church numeral in the following manner (assuming that we&#8217;ve re-<code>slurp</code>ed the <code>church.lfe</code> file):</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>church-&gt;int1</span> <span class='p'>(</span><span class='nv'>one</span><span class='p'>))</span>
<span class='mi'>1</span>
</code></pre></div>
<p>Alternatively, we could do this:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>church-&gt;int2</span> <span class='p'>(</span><span class='nv'>church-numeral</span><span class='p'>)</span>
  <span class='p'>(</span><span class='nb'>funcall</span> <span class='p'>(</span><span class='nb'>funcall</span> <span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>church-numeral</span><span class='p'>)</span> <span class='nf'>#&#39;</span><span class='nv'>successor/1</span><span class='p'>)</span> <span class='mi'>0</span><span class='p'>))</span>
</code></pre></div>
<p>This second approach lets us pass the Church numeral without calling it:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>church-&gt;int2</span> <span class='nf'>#&#39;</span><span class='nv'>one/0</span><span class='p'>)</span>
</code></pre></div>
<p>As mentioned earlier, we know that we can get successive Church numerals by adding more <code>(funcall s</code> applications (i.e., incrementing with a successor function). For instance, here is the Church numeral <code>four</code>:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>four</span> <span class='p'>()</span>
  <span class='p'>(</span><span class='k'>lambda</span> <span class='p'>(</span><span class='nv'>s</span><span class='p'>)</span>
    <span class='p'>(</span><span class='k'>lambda</span> <span class='p'>(</span><span class='nv'>x</span><span class='p'>)</span>
      <span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>s</span>
        <span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>s</span>
          <span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>s</span>
            <span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>s</span> <span class='nv'>x</span><span class='p'>)))))))</span>
</code></pre></div>
<p>Using this method of writing out Church numerals is going to be more tedious that putting beans in a pile to represent integers. What can we do? Well, we need a general (i.e., non-integer) λ-calculus representation for a successor function. Then we need to be able to apply that to <code>zero</code> <code>n</code> times in order to get the desired Church numeral. Let&#8217;s start with a Church numeral successor function:</p>

<pre><code>λn.λs.λx. s (n s x)</code></pre>

<p>We translate that to LFE with the following:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>church-successor</span> <span class='p'>(</span><span class='nv'>n</span><span class='p'>)</span>
  <span class='p'>(</span><span class='k'>lambda</span> <span class='p'>(</span><span class='nv'>s</span><span class='p'>)</span>
    <span class='p'>(</span><span class='k'>lambda</span> <span class='p'>(</span><span class='nv'>x</span><span class='p'>)</span>
      <span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>s</span>
        <span class='p'>(</span><span class='nb'>funcall</span>
          <span class='p'>(</span><span class='nb'>funcall</span> <span class='nv'>n</span> <span class='nv'>s</span><span class='p'>)</span> <span class='nv'>x</span><span class='p'>)))))</span>
</code></pre></div>
<p>Next we need a function that can give us a Church numeral for a given number of applications of the <code>church-successor</code>:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>get-church</span> <span class='p'>(</span><span class='nv'>church-numeral</span> <span class='nb'>count</span> <span class='nv'>limit</span><span class='p'>)</span>
  <span class='p'>(</span><span class='nb'>cond</span> <span class='p'>((</span><span class='nv'>==</span> <span class='nb'>count</span> <span class='nv'>limit</span><span class='p'>)</span> <span class='nv'>church-numeral</span><span class='p'>)</span>
        <span class='p'>((</span><span class='nb'>/=</span> <span class='nb'>count</span> <span class='nv'>limit</span><span class='p'>)</span>
         <span class='p'>(</span><span class='nv'>get-church</span> <span class='p'>(</span><span class='nv'>church-successor</span> <span class='nv'>church-numeral</span><span class='p'>)</span> <span class='p'>(</span><span class='nb'>+</span> <span class='mi'>1</span> <span class='nb'>count</span><span class='p'>)</span> <span class='nv'>limit</span><span class='p'>))))</span>
</code></pre></div>
<p>We&#8217;re getting a little bit ahead of ourselves, since we haven&#8217;t yet talked about countdown or countup recursive functions in LFE; consider this a teaser ;-)</p>

<p>Our <code>get-church</code> function keeps track of how many times it is recursed and returns the appropriate Church numeral when the limit has been reached. However, it&#8217;s a bit cumbersome to use. Let&#8217;s see if we can do better:</p>
<div class='highlight'><pre><code class='cl'><span class='p'>(</span><span class='nb'>defun</span> <span class='nv'>get-church</span> <span class='p'>(</span><span class='nc'>integer</span><span class='p'>)</span>
  <span class='p'>(</span><span class='nv'>get-church</span> <span class='p'>(</span><span class='nv'>zero</span><span class='p'>)</span> <span class='mi'>0</span> <span class='nc'>integer</span><span class='p'>))</span>
</code></pre></div>
<p>Now we&#8217;ve got two <code>get-church</code> functions, each with different arity. <code>get-church/1</code> calls <code>get-church/3</code> with the appropriate initial arguments, at which point <code>get-church/3</code> calls itself until the limit is reached and returns a Church numeral.</p>

<p>Let&#8217;s take a look:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>slurp</span> <span class='o'>&#39;</span><span class='s'>&quot;examples/church.lfe&quot;</span><span class='p'>)</span>
<span class='o'>#(</span><span class='nv'>ok</span> <span class='nv'>church</span><span class='p'>)</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>get-church</span> <span class='mi'>0</span><span class='p'>)</span>
<span class='err'>#</span><span class='nv'>Fun&lt;lfe_eval.10.53503600&gt;</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>==</span> <span class='p'>(</span><span class='nv'>zero</span><span class='p'>)</span> <span class='p'>(</span><span class='nv'>get-church</span> <span class='mi'>0</span><span class='p'>))</span>
<span class='nv'>true</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>get-church</span> <span class='mi'>1000</span><span class='p'>)</span>
<span class='err'>#</span><span class='nv'>Fun&lt;lfe_eval.10.53503600&gt;</span>
</code></pre></div>
<p>Looks good so far. Let&#8217;s check out the values:</p>
<div class='highlight'><pre><code class='cl'><span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>church-&gt;int1</span> <span class='p'>(</span><span class='nv'>get-church</span> <span class='mi'>1</span><span class='p'>)))</span>
<span class='mi'>1</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>church-&gt;int1</span> <span class='p'>(</span><span class='nv'>get-church</span> <span class='mi'>50</span><span class='p'>)))</span>
<span class='mi'>50</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>church-&gt;int1</span> <span class='p'>(</span><span class='nv'>get-church</span> <span class='mi'>100</span><span class='p'>)))</span>
<span class='mi'>100</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>church-&gt;int1</span> <span class='p'>(</span><span class='nv'>get-church</span> <span class='mi'>2000</span><span class='p'>)))</span>
<span class='mi'>2000</span>
<span class='nb'>&gt;</span> <span class='p'>(</span><span class='nv'>church-&gt;int1</span> <span class='p'>(</span><span class='nv'>get-church</span> <span class='mi'>10000</span><span class='p'>)))</span>
<span class='mi'>10000</span>
<span class='nb'>&gt;</span>
</code></pre></div>
<p>That last one caused a little lag in the LFE REPL, but still quite impressive given the fact that it just applied so many thousands of lambdas!</p>

<p>How fortunate that we didn&#8217;t have to type 10,000 <code>funcall</code>s (and the corresponding set of opening and closing parentheses 10,000 times).</p>
<a name='583_arithmetic' />
<h3 id='583_arithmetic'>5.8.3 Arithmetic</h3>
<div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><a name='584_logic' />
<h3 id='584_logic'>5.8.4 Logic</h3>
<div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><a name='59_practical_examples_in_computing' />
<h2 id='59_practical_examples_in_computing'>5.9 Practical Examples in Computing</h2>
<div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><a name='591_a_simple_example' />
<h3 id='591_a_simple_example'>5.9.1 A Simple Example</h3>
<div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><a name='592_with_an_accumulator' />
<h3 id='592_with_an_accumulator'>5.9.2 With an Accumulator</h3>
<div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><a name='593_with_return_values' />
<h3 id='593_with_return_values'>5.9.3 With Return Values</h3>
<div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><a name='594_with_lists' />
<h3 id='594_with_lists'>5.9.4 With Lists</h3>
<div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><a name='510_tail_calls_in_lfe' />
<h2 id='510_tail_calls_in_lfe'>5.10 Tail Calls in LFE</h2>
<div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><a name='5101_tail_call_optimization' />
<h3 id='5101_tail_call_optimization'>5.10.1 Tail Call Optimization</h3>
<div class='highlight'><pre><code class='cl'>
</code></pre></div><div class='highlight'><pre><code class='cl'>
</code></pre></div><a name='6_checks,_errors,_and_tests' />
<h1 id='6_checks_errors_and_tests'>6 Checks, Errors, and Tests</h1>
<a name='61_guards' />
<h2 id='61_guards'>6.1 Guards</h2>
<a name='62_exception_handling' />
<h2 id='62_exception_handling'>6.2 Exception Handling</h2>

<p>Erlang, and thus LFE, provide a means of evaluating expressions and not only handling normal results, but abnormal termination as well. This is done with <code>(try ... (catch ... ))</code>.</p>

<p>Note that <code>(try ... )</code> doesn&#8217;t need to have a <code>(catch ...)</code>, however, since we will be exploring exception handling in this section, all of our examples will be using <code>(catch ...)</code>.</p>
<a name='621_a_simple_case' />
<h3 id='621_a_simple_case'>6.2.1 A Simple Case</h3>

<p>TBD</p>
<a name='63_eunit' />
<h2 id='63_eunit'>6.3 EUnit</h2>
<a name='631_the_face_of_a_unit_test' />
<h3 id='631_the_face_of_a_unit_test'>6.3.1 The Face of a Unit Test</h3>
<a name='632_mixed_tests_or_separate_modules?' />
<h3 id='632_mixed_tests_or_separate_modules'>6.3.2 Mixed Tests or Separate Modules?</h3>
<a name='633_running_unit_tests' />
<h3 id='633_running_unit_tests'>6.3.3 Running Unit Tests</h3>
<a name='634_distributing_code_with_unit_tests' />
<h3 id='634_distributing_code_with_unit_tests'>6.3.4 Distributing Code with Unit Tests</h3>
<a name='635_a_unit_test_in_detail' />
<h3 id='635_a_unit_test_in_detail'>6.3.5 A Unit Test in Detail</h3>
<a name='6351_erlang_eunit_assert_macros' />
<h4 id='6351_erlang_eunit_assert_macros'>6.3.5.1 Erlang EUnit Assert Macros</h4>
<a name='6352_fixtures:_setup_and_cleanup' />
<h4 id='6352_fixtures_setup_and_cleanup'>6.3.5.2 Fixtures: Setup and Cleanup</h4>
<a name='6353_generating_tests' />
<h4 id='6353_generating_tests'>6.3.5.3 Generating Tests</h4>
<a name='636_mocking_with_meck' />
<h3 id='636_mocking_with_meck'>6.3.6 Mocking with Meck</h3>
<a name='64_tdd' />
<h2 id='64_tdd'>6.4 TDD</h2>
<a name='641_creating_an_api_and_writing_tests' />
<h3 id='641_creating_an_api_and_writing_tests'>6.4.1 Creating an API and Writing Tests</h3>
<a name='642_making_tests_pass' />
<h3 id='642_making_tests_pass'>6.4.2 Making Tests Pass</h3>
<a name='6421_factoring_out_common_test_logic' />
<h4 id='6421_factoring_out_common_test_logic'>6.4.2.1 Factoring Out Common Test Logic</h4>
<a name='643_testing_the_server' />
<h3 id='643_testing_the_server'>6.4.3 Testing the Server</h3>
<a name='644_testing_the_client' />
<h3 id='644_testing_the_client'>6.4.4 Testing the Client</h3>
<a name='645_cleaning_up_after_tests' />
<h3 id='645_cleaning_up_after_tests'>6.4.5 Cleaning Up After Tests</h3>
<a name='646_handling_logged_errors' />
<h3 id='646_handling_logged_errors'>6.4.6 Handling Logged Errors</h3>
<a name='647_resolving_a_bug' />
<h3 id='647_resolving_a_bug'>6.4.7 Resolving a Bug</h3>
<a name='648_code_coverage' />
<h3 id='648_code_coverage'>6.4.8 Code Coverage</h3>
<a name='7_processes_and_servers' />
<h1 id='7_processes_and_servers'>7 Processes and Servers</h1>
<a name='8_external_data' />
<h1 id='8_external_data'>8 External Data</h1>
<a name='9_additional_topics' />
<h1 id='9_additional_topics'>9 Additional Topics</h1>
<a name='91_macros' />
<h2 id='91_macros'>9.1 Macros</h2>
<a name='92_writing_for_multi-core' />
<h2 id='92_writing_for_multicore'>9.2 Writing for Multi-Core</h2>
  </body>
</html>